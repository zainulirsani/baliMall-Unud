{% extends '@__main__/public/base/layouts/default.html.twig' %}

{% block stylesheets %}
    <style>
        .preview-img-upload {
            object-fit: fill;
            width: 65%;
        }

        .containers {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .disable-click {
            pointer-events: none;
        }

        .editor {
            position: fixed;
            width: 50%;
            height: 50%;
            margin: auto;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            z-index: 9999;
            background-color: #000;
            visibility: hidden;
        }

        .wrapper-editor {
            position: fixed;
            top: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            height: 100vmax !important;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9998;
        }

        .upBtn {
            position: absolute;
            bottom: 5px;
            z-index: 9999;
            min-width: 20px;
            min-height: 10px;
        }

        .left {
            left: 10px;
        }

        .right {
            right: 10px;
        }

        @media screen and (max-width: 450px) {
            .tablinks {
                font-size: 2vw !important;
            }
        }

        @media screen and (max-width: 320px) {
            .tablinks > i {
                font-size: 2vw;
            }

            .tablinks {
                display: block !important;
                left: 0 !important;
            }
        }

        @media screen and (max-width: 480px) {
            .upBtn {
                width: 15vw;
                font-size: 2vw;
                margin-bottom: 0;
                text-align: center;
            }

            .left {
                left: 1vw;
            }

            .right {
                right: 1vw;

            }
        }

        @media screen and (max-width: 400px) {
            .right {
                right: -5vw;
            }
        }

        .sub-menu {
            width: 100%;
            left: -7vw;
            padding-right: 1vw;
        }

        .sub-menu button {
            left: 1vw;
        }

        .preview-file {
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
            height: 500px;
            overflow-y: scroll;
        }

        td,th {
            padding: 10px;
        }

        .error {
            padding-top: 6px;
        }

        .hide {
            display: none;
        }

        .input-bg-white > input {
            background-color: #fff !important;
            border: 1px solid #ddd !important;
        }

        @media screen and (max-width: 463px) {
            .textTerm {
                font-size: 10px;
            }
        }

        #addressMap {
            height: 350px;
            z-index: 99;
        }

        .btn-search-ppk,.btn-search-ppk:hover {
            background-color: #4b85cc;
            font-size: 14px;
            padding: 14px 18px;
            text-align: center;
            border-radius: 5px;
            color: #fff;
            border: 1px solid #4b85cc;
            cursor: pointer;
            text-decoration: none;
        }

        .btn-ppk-red-border{
            background-color: transparent;
            font-size: 14px;
            padding: 14px 18px;
            text-align: center;
            border-radius: 5px;
            color: #4b85cc;
            border: 1px solid #4b85cc;
            margin: 2px;
            cursor: pointer;
            text-decoration: none;
            transition: 0.5s;
        }

        .btn-ppk-red-border:hover {
            background-color: #4b85cc;
            color: #fff;
            transition: 0.5s;
        }

        .table_spk tr td,th {
            border: 1px solid #000;
        }

        .spinner {
            animation: spin 2s infinite linear;
            -webkit-animation: spin2 2s infinite linear;
        }

        @keyframes spin {
            from { transform: scale(1) rotate(0deg); }
            to { transform: scale(1) rotate(360deg); }
        }

        @-webkit-keyframes spin2 {
            from { -webkit-transform: rotate(0deg); }
            to { -webkit-transform: rotate(360deg); }
        }

        .d-none {
            display: none;
        }
        
        .btn-download-document:disabled {
            cursor: not-allowed !important;
            pointer-events: all !important;
        },

        .text-center{
            text-align: center;
        }

           .temp-btn {
        min-width: 120px;
        text-align: center;
        height: 24px;
        line-height: 24px;
        border-radius: 8px;
    }
    .styled-table {
        border-collapse: collapse;
        margin: 25px 0;
        font-size: 0.9em;
        font-family: sans-serif;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
    }
    .styled-table thead tr {
        background-color: #4b85cc;
        color: #ffffff;
        text-align: left;
    }
    .styled-table th,
    .styled-table td {
        padding: 12px 15px;
    }
    .styled-table tbody tr {
        border-bottom: 1px solid #dddddd;
    }

    .styled-table tbody tr:nth-of-type(even) {
        background-color: #f3f3f3;
    }

    .styled-table tbody tr:last-of-type {
        border-bottom: 2px solid #4b85cc;
    }
    .styled-table tbody tr.active-row {
        font-weight: bold;
        color: #4b85cc;
    }
    .badge-orange {
        background-color: #FEF2E5;
        font-size: 12px;
        padding: 5px 10px;
        text-align: center;
        border-radius: 10px;
        color: #CD6200;
        border: 1px solid #CD6200;
    }
    .badge-green {
        background-color: #EBF9F1;
        font-size: 12px;
        padding: 5px 10px;
        text-align: center;
        border-radius: 10px;
        color: #1F9254;
        border: 1px solid #1F9254;
    }
    .badge-red {
        background-color: #ffa5a582;
        font-size: 12px;
        padding: 5px 10px;
        text-align: center;
        border-radius: 10px;
        color: #4b85cc;
        border: 1px solid #4b85cc;
    }
    .badge-blue {
        background-color: #008ae838;
        font-size: 12px;
        padding: 5px 10px;
        text-align: center;
        border-radius: 10px;
        color: #008ae8;
        border: 1px solid #008ae8;
    }
    .btn-send-red,.btn-send-red:hover {
        background-color: #4b85cc;
        font-size: 14px;
        padding: 5px 10px;
        text-align: center;
        border-radius: 5px;
        color: #fff;
        border: 1px solid #4b85cc;
        margin: 2px;
        cursor: pointer;
        text-decoration: none;
    }
    .btn-send-red-border,.btn-send-red-border:hover {
        background-color: transparent;
        font-size: 14px;
        padding: 5px 10px;
        text-align: center;
        border-radius: 5px;
        color: #4b85cc;
        border: 1px solid #4b85cc;
        margin: 2px;
        cursor: pointer;
        text-decoration: none;
    }

    .input input[type=text] {
        background-color: #FFF;
        border: 1.5px solid #ededed;
    }

    .btn-search-ppk,.btn-search-ppk:hover {
        background-color: #4b85cc;
        font-size: 14px;
        padding: 14px 18px;
        text-align: center;
        border-radius: 5px;
        color: #fff;
        border: 1px solid #4b85cc;
        cursor: pointer;
        text-decoration: none;
    }

    .btn-info-ppk,.btn-info-ppk:hover {
        background-color: #0dcaf0;
        font-size: 14px;
        padding: 14px 18px;
        text-align: center;
        border-radius: 5px;
        color: #fff;
        border: 1px solid #0dcaf0;
        cursor: pointer;
        text-decoration: none;
    }

    .table_ppk_status tr,.table_ppk_status td {
        padding: 10px;
    }

    .text-center {text-align:center;}
    ::-webkit-scrollbar {
    -webkit-appearance: none;
        width: 7px;
    }

    ::-webkit-scrollbar-thumb {
        border-radius: 4px;
        background-color: rgba(0, 0, 0, .5);
        box-shadow: 0 0 1px rgba(255, 255, 255, .5);
    }
    .fake-scroll-div {
        overflow-x: scroll !important;
        height: 20px !important;
        margin-bottom: 0px !important;
    }

    .btn-search-ppk,.btn-search-ppk:hover {
        background-color: #4b85cc;
        font-size: 14px;
        padding: 14px 18px;
        text-align: center;
        border-radius: 5px;
        color: #fff;
        border: 1px solid #4b85cc;
        cursor: pointer;
        text-decoration: none;
    }

    .btn-send-red-border{
        background-color: transparent;
        font-size: 14px;
        padding: 14px 18px;
        text-align: center;
        border-radius: 5px;
        color: #4b85cc;
        border: 1px solid #4b85cc;
        margin: 2px;
        cursor: pointer;
        text-decoration: none;
        transition: 0.5s;
    }

    .btn-send-red-border:hover {
        background-color: #4b85cc;
        color: #fff;
        transition: 0.5s;
    }

    .text-note {
        margin-top: 10px;
        border: 1px solid #dcdcdc;
        padding: 10px;
        font-size: 14px;
        border-radius: 4px;
        overflow-y: auto;
        height: 100px; /* or any desired height */
        width: 100%; /* or any desired width */
        resize: vertical; /* allows vertical resizing */
    }

    </style>
{% endblock %}

{% block content %}
    {% set data_order = order_master is not empty ? order_master : order  %}

    <main class="pdl dbu">
        <section>
            <div class="container">
                <div class="box">
                    <div class="row">

                        {% if order_partials|length > 0 %}
                            {# <h3 style="text-align: center;">Detail Pengiriman</h3> #}
                            {# {% if order['o_batch'] is not empty %}
                                <h6 style="text-align: center;">PARSIAL {{ order['o_batch'] }}</h6>
                            {% endif %} #}
                            <hr>
                        {% endif %}
                        <div class="dc4 tc4 mc4">
                            <div class="tab">
                                {% set all_rating = true %}
                                {% for index, product in order['o_products'] %}
                                    {% set data_review = product_review(order['o_id']|to_int, product['p_id']|to_int, order['o_ppkId']|to_int) %}
                                    {% if data_review['pr_id'] is not defined %}
                                        {% set all_rating = false %}
                                    {% endif %}
                                {% endfor %}
                                {% set set_display_order = 'active' %}
                                {% set set_display_order_tab = '' %}

                                {% set set_display_pajak = '' %}
                                {% set set_display_pajak_tab = 'display: none;' %}

                                {% set set_display_rating = '' %}
                                {% set set_display_rating_tab = 'display: none;' %}

                                {% set set_display_nego = '' %}
                                {% set set_display_nego_tab = 'display: none;' %}

                                {% set set_display_confirm_ppk = '' %}
                                {% set set_display_confirm_ppk_tab = 'display: none;' %}

                                {% set set_display_doc = '' %}
                                {% set set_display_doc_tab = 'display: none;' %}

                                {% set set_display_process = '' %}
                                {% set set_display_process_tab = 'display: none;' %}


                                {% set set_display_shipping = '' %}
                                {% set set_display_shipping_tab = 'display: none;' %}


                                {% if app.user.subRole == 'TREASURER' %}
                                    {% if order['o_status'] == 'pending_payment' or order['o_status'] == 'paid' or order['o_status'] == 'payment_process' or order['o_status'] == 'pending_payment' %}
                                        {% if backQRIS == 1 %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                            {% set set_display_nego = 'active' %}
                                            {% set set_display_nego_tab = '' %}
                                        {% elseif order['o_status'] == 'confirm_order_ppk' %}
                                            {% set set_display_order = 'active' %}
                                            {% set set_display_order_tab = '' %}
                                            {# {% set set_display_confirm_ppk = 'active' %}
                                            {% set set_display_confirm_ppk_tab = '' %} #}
                                        {% else %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                            {% if order['o_withholdingTaxSlipFile'] is empty and order['o_taxInvoiceFile'] is not empty %}
                                                {% set set_display_doc = 'active' %}
                                                {% set set_display_doc_tab = '' %}
                                            {% else %}
                                                {% set set_display_pajak = 'active' %}
                                                {% set set_display_pajak_tab = '' %}
                                            {% endif %}
                                        {% endif %}
                                    {% else %}
                                        {% set set_display_pajak = '' %}
                                        {% set set_display_pajak_tab = 'display: none;' %}
                                        {% set set_display_order = 'active' %}
                                        {% set set_display_order_tab = '' %}
                                    {% endif %}
                                {% elseif app.user.subRole == 'PPK' %}
                                    {% if order['o_isApprovedPPK'] == true and all_rating == false %}
                                        {% set set_display_order = '' %}
                                        {% set set_display_order_tab = 'display: none;' %}
                                        {% set set_display_rating = 'active' %}
                                        {% set set_display_rating_tab = '' %}
                                    {% elseif (order['o_status'] == 'confirmed' or order['o_status'] == 'new_order') %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                            {% set set_display_confirm_ppk = 'active' %}
                                            {% set set_display_confirm_ppk_tab = '' %}
                                    {% elseif order['o_status'] == 'approved_order' %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                             {% set set_display_shipping = 'active' %}
                                            {% set set_display_shipping_tab = '' %}
                                    {% endif %}
                                {% else %}
                                    {% if app.user.role == 'ROLE_USER_SELLER' %}
                                        {% if order['o_status'] == 'confirm_order_ppk' %}
                                            {% set set_display_order = 'active' %}
                                            {% set set_display_order_tab = '' %}
                                            {# {% set set_display_confirm_ppk = 'active' %}
                                            {% set set_display_confirm_ppk_tab = '' %} #}
                                        {% elseif order['o_status'] == 'confirmed' or order['o_status'] == 'new_order' %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                            {% set set_display_nego = 'active' %}
                                            {% set set_display_nego_tab = '' %}
                                        {% elseif order['o_status'] == 'processed' %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                            {% set set_display_process = 'active' %}
                                            {% set set_display_process_tab = '' %}
                                        {% elseif ((order['o_status'] == 'paid' or order['o_status'] == 'payment_process' or order['o_status'] == 'pending_payment') and order['o_withholdingTaxSlipFile'] is empty and order['o_taxType'] == '59') %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                            {% set set_display_doc = 'active' %}
                                            {% set set_display_doc_tab = '' %}
                                        {# {% elseif ((order['o_status'] == 'paid' or order['o_status'] == 'payment_process' or order['o_status'] == 'pending_payment') and order['o_withholdingTaxSlipFile'] is empty ) %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                            {% set set_display_doc = 'active' %}
                                            {% set set_display_doc_tab = '' %} #}
                                        {% endif %}
                                    {% else %}
                                        {% if order['o_status'] == 'confirm_order_ppk' %}
                                            {% set set_display_order = 'active' %}
                                            {% set set_display_order_tab = '' %}
                                            {# {% set set_display_confirm_ppk = 'active' %}
                                            {% set set_display_confirm_ppk_tab = '' %} #}
                                        {% elseif order['o_status'] == 'confirmed' or order['o_status'] == 'new_order' %}
                                            {% set set_display_order = '' %}
                                            {% set set_display_order_tab = 'display: none;' %}
                                            {% set set_display_nego = 'active' %}
                                            {% set set_display_nego_tab = '' %}
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                                <div>
                                    <div>
                                        <button class="tablinks {{set_display_order}}" onclick="tabDetailOrder(event, 'tab-order')" id="tab-order">
                                            Data Order
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <div>
                                        <button class="tablinks" onclick="tabDetailOrder(event, 'tab-pengadaan')" id="tab-pengadaan">
                                            Data Pengadaan
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <div>
                                        <button class="tablinks {{set_display_nego}}" onclick="tabDetailOrder(event, 'tab-produk')" id="tab-produk">
                                            Data Produk & Negosiasi
                                        </button>
                                    </div>
                                </div>

                                {% if data_order['o_status'] == 'confirm_order_ppk' %}
                                    <div>
                                        <div>
                                            <button class="tablinks {{set_display_confirm_ppk}}" onclick="tabDetailOrder(event, 'tab-confirmppk')" id="tab-confirmppk">
                                                Data Konfirmasi Order
                                            </button> 
                                        </div>
                                    </div>
                                {% endif %}
                                
                                {% if app.user.subRole == 'PPK' and data_order['o_status'] == 'approved_order' %}
                                    <div>
                                        <div>
                                            <button class="tablinks {{set_display_shipping}}" onclick="tabDetailOrder(event, 'tab-shipping')" id="tab-shipping">
                                                Data SPP
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}

                                <div>
                                    <div>
                                        <button class="tablinks {{set_display_process}}" onclick="tabDetailOrder(event, 'tab-pengiriman')" id="tab-pengiriman">
                                            Data Pengiriman
                                        </button>
                                    </div>
                                </div>
                                
                                <div>
                                    <div>
                                        <button class="tablinks" onclick="tabDetailOrder(event, 'tab-pembayaran')" id="tab-pembayaran">
                                            Data Pembayaran
                                        </button>
                                    </div>
                                </div>
                                {% set hide_doc = '' %}
                                {% if (order['o_status'] == 'cancel' or order['o_status'] == 'confirmed' or order['o_status'] == 'new_order')  %}
                                    {% set hide_doc = 'display:none;' %}
                                {% endif %}
                                
                                <div style="{{hide_doc}}">
                                    <div>
                                        <button class="tablinks {{set_display_doc}}" onclick="tabDetailOrder(event, 'tab-dokumen')" id="tab-dokumen">
                                            Data Dokumen
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <div>
                                        <button class="tablinks {{set_display_pajak}}" onclick="tabDetailOrder(event, 'tab-pajak')" id="tab-pajak">
                                            Data Pajak
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <div>
                                        <button class="tablinks {{set_display_rating}}" onclick="tabDetailOrder(event, 'tab-rating')" id="tab-rating">
                                            Data Rating
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <div>
                                        <button class="tablinks" onclick="tabDetailOrder(event, 'tab-komplain')" id="tab-komplain">
                                            Data Komplain
                                        </button>
                                    </div>
                                </div>
                                
                                
                                <div>
                                    <div>
                                        <button class="tablinks" onclick="tabDetailOrder(event, 'tab-log')" id="tab-log">
                                            Data Log
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <div style="text-align:center;padding:30px 10px;">
                                        {% if app.user.subRole == 'TREASURER' or app.user.subRole == 'PPK' %}
                                            {% set redirect_dashboard = 'user_ppktreasurer_dashboard' %}
                                        {% else %}
                                            {% set redirect_dashboard = 'user_dashboard' %}
                                        {% endif %}

                                        {% if order['o_type_order'] == 'master' %}
                                            {% set redirect_dashboard = 'user_ppktreasurer_dashboard' %}
                                        {% endif %}
                                        <a href="{{ path(redirect_dashboard) }}" id="btn-kembali-dashboard">
                                            <button style="background: #4b85cc;color: #fff;padding: 10px 15px;border-radius: 5px;border: 0;" type="button">Kembali ke Dashboard</button>
                                        </a>
                                    </div>
                                </div>
                                
                                <input type="hidden" id="store_umkm_category_percentage"
                                   value="{{ get_ppn_percentage(order['s_umkm_category']) }}"/>
                                
                            </div>
                        </div>
                        <div class="dc8 tc8 mc8">

                            <div id="tabOrder" class="tabcontent" style="{{set_display_order_tab}}">
                            {% set execution_options = get_parameter('execution_time_options') %}
                            {% set nego_price = 0 %}
                            {% set nego_batch = 0 %}
                            {% set nego_is_approve = false %}
                            {% set tax_value = order['o_products'][0]['op_taxValue']|to_int %}
                            {% set sub_total_nego_price = 0 %}
                            {% set sub_total_ppn_price = 0 %}
                            {% set nego_shipping = 0 %}

                            {% if order['o_negotiatedProducts']|length > 0 %}
                                {% for temp_nego_data in order['o_negotiatedProducts'] %}
                                    {% set nego_batch = temp_nego_data['on_batch'] %}
                                    {% set nego_is_approve = temp_nego_data['on_isApproved'] %}
                                    {% set nego_on_merchant_approve = temp_nego_data['on_merchantApproval'] %}
                                    {% set nego_on_buyer_approve = temp_nego_data['on_customerApproval'] %}
                                    {% set nego_shipping = temp_nego_data['on_negotiatedShippingPrice'] %}
                                {% endfor %}
                            {% endif %}
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Order</h4>
                                    </div>
                                    
                                    <div class="dc12">
                                    <table class="table_spk">
                                        <tr>
                                            <td rowspan="8">Surat Pesanan</td>
                                            <td>Nama Instansi</td>
                                            <td>
                                            {% if data_order['o_institution_name'] is empty and data_order['o_work_unit_name'] is empty %}
                                                -
                                            {% else %}
                                                {{ data_order['o_institution_name']|default() ~ ', ' ~ data_order['o_work_unit_name']|default() }}
                                            {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>No. Order</td>
                                            <td>{{ data_order['o_id'] }}</td>
                                        </tr>
                                        <tr>
                                            <td>No. Invoice</td>
                                            <td>{{ data_order['o_invoice'] }}</td>
                                        </tr>
                                        <tr>
                                        {% set waktu_persetujuan = null %}
                                        {% for product_nego in data_order['o_negotiatedProducts'] %}
                                            {% set waktu_persetujuan = product_nego['on_updatedAt'] %}
                                        {% endfor %}
                                            <td>Tanggal Transaksi</td>
                                            <td>
                                                {{ waktu_persetujuan|date("d")|to_int }} {{ get_parameter('indonesian_months_name')[waktu_persetujuan|date("m")|to_int]|capitalize }} {{ waktu_persetujuan|date("Y") }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Nama Paket Pekerjaan</td>
                                            <td>{{ data_order['o_jobPackageName'] }}</td>
                                        </tr>
                                        <tr>
                                            <td>Tahun Anggaran</td>
                                            <td>{{ data_order['o_fiscalYear'] }}</td>
                                        </tr>
                                        <tr>
                                            <td>Sumber Dana</td>
                                            <td>{{ data_order['o_sourceOfFund'] }}</td>
                                        </tr>
                                        <tr>
                                            <td>Pagu Anggaran</td>
                                            <td>{{ data_order['o_budgetCeiling']|number_format }}</td>
                                        </tr>
                                        {# <tr>
                                            <td>Jenis Pembayaran</td>
                                            {% set jenis_pembayaran = order['o_ppk_payment_method']|default('uang_persediaan') %}
                                            <td>{{ get_parameter('ppk_method_options')[jenis_pembayaran] }}</td>
                                        </tr> #}
                                        <tr>
                                            <td colspan="3">Surat pesanan ini mulai berlaku efektif terhitung sejak tanggal ditetapkan dan penyelesaian keseluruhan pekerjaan sebagaimana dimaksud dalam surat pesanan ini.</td>
                                        </tr>
                                        <tr>
                                            {# <td colspan="3">Waktu Pelaksanaan Pekerjaan : {{ execution_options[order['o_executionTime']] is defined ? execution_options[order['o_executionTime']]|trans : order['o_executionTime'] }}</td> #}
                                            <td colspan="3">Waktu Pelaksanaan Pekerjaan : {{ data_order['o_executionTime'] }} ( {{ data_order['o_executionTime']|number_format_to_words|capitalize }} ) Hari Kerja</td>                        
                                        </tr>
                                    </table>
                                    <br>
                                    <div style="text-align: center;">
                                        <caption><h4>Rincian pekerjaan</h4></caption><br>
                                    </div>
                                    <table class="table_spk">
                                        <thead>
                                            <tr>
                                                <th>No.</th>
                                                <th>Uraian Barang / Jasa</th>
                                                <th>Jumlah (qty)</th>
                                                <th>Satuan</th>
                                                <th>Harga Satuan</th>
                                                <th>Total Harga</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {# {% for index, product in order['o_products'] %}
                                                <tr>
                                                    <td>{{ index+1 }}</td>
                                                    <td>{{ product['p_name'] }}</td>
                                                    <td>{{ product['op_quantity'] }}</td>
                                                    <td>Unit</td>
                                                    <td>{{ product['op_price']|number_format }}</td>
                                                    <td>{{ (product['op_totalPrice'] + product['op_taxNominal'])|number_format }}</td>
                                                </tr>
                                            {% endfor %} #}

                                            {% set initial_with_shipping = true %}
                                            {% set total_ppn = 0 %}
                                            {% set dpp_ppn_pph = 0 %}
                                            {% set order_shipping_price = 0 %}
                                            {% for index, product in data_order['o_products'] %}
                                                {% set order_shipping_price = product['op_priceShippingNegotiation'] %}
                                                {% set ppn_product = product['op_withTax'] == true ? product['op_taxNominal'] : 0 %}
                                                {% set total_ppn = total_ppn + (ppn_product) %}
                                                {% set dpp_ppn_pph = dpp_ppn_pph + (product['op_withTax'] == true ? product['op_totalPrice'] : 0) %}
                                                {% for product_nego in data_order['o_negotiatedProducts'] %}
                                                    {% if (product_nego['p_id'] == product['p_id']) and (product_nego['on_batch'] == nego_batch) %}
                                                        {% set nego_price = (product_nego['on_negotiatedPrice'] * product['op_quantity']) %}
                                                        {% set sub_total_nego_price = sub_total_nego_price + (product_nego['on_negotiatedPrice'] * product['op_quantity']) %}

                                                        {% if initial_with_shipping == true %}
                                                            {% set sub_total_ppn_price = sub_total_ppn_price + ((product_nego['on_negotiatedPrice'] * (product_nego['on_taxValue']/100)) * product['op_quantity']) + product_nego['on_taxNominalShipping'] %}
                                                        {% else %}
                                                            {% set sub_total_ppn_price = sub_total_ppn_price + ((product_nego['on_negotiatedPrice'] * (product_nego['on_taxValue']/100)) * product['op_quantity']) %}
                                                        {% endif %}
                                                        {% set initial_with_shipping = false %}
                                                        {% set nego_shipping = product_nego['on_negotiatedShippingPrice'] %}
                                                        <tr>
                                                            <td>{{ index+1 }}</td>
                                                            <td>{{ product['p_name'] }}</td>
                                                            <td style="text-align: center;">{{ product['op_quantity'] }}</td>
                                                            <td>{{ product['p_unit']|default('Unit') }}</td>
                                                            <td style="text-align: right;">{{ product_nego['on_negotiatedPrice']|number_format }}</td>
                                                            <td style="text-align: right;">{{ nego_price|number_format }}</td>
                                                        </tr>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endfor %}
                                            <tr>
                                                <td colspan="5" style="text-align: right;">Biaya Kirim (Rp)</td>
                                                <td style="text-align: right;">{{ nego_shipping|number_format }}</td>
                                            </tr>
                                            <tr>
                                                <td colspan="5" style="text-align: right;">Total PPN (Rp)</td>
                                                <td style="text-align: right;">{{ sub_total_ppn_price|round|number_format }}</td>
                                            </tr>
                                            <tr>
                                                {% set order_grand_total = sub_total_nego_price + nego_shipping + sub_total_ppn_price %}
                                                <td colspan="5" style="text-align: right;">Total (Rp)</td>
                                                <td style="text-align: right;">{{ order_grand_total|round|number_format }}</td>
                                            </tr>
                                            {#<tr>
                                                <td colspan="6">Terbilang : ?</td>
                                            </tr>#}
                                            <tr>
                                                <td colspan="6">INSTRUKSI KE PENYEDIA :</td>
                                            </tr>
                                            <tr>
                                                <td colspan="6">Penagihan hanya dapat dilakukan setelah penyelesaian pekerjaan yang diperintahkan dalam surat pesanan ini dan dibuktikan dengan Tanda Terima</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    </div>
                                </div>
                            </div>

                            <div id="tabPengadaan" class="tabcontent" style="display: none;">
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Pengadaan</h4>
                                    </div>
                                    <div class="dc6">
                                        <div class="input form-group">
                                            <label for="">Satker</label>
                                            <input type="text" class="form-control" value="{{data_order['o_work_unit_name']}}" readonly>
                                        </div>
                                        <div class="input form-group">
                                            <label for="">Paket Pekerjaan</label>
                                            <input type="text" class="form-control" value="{{data_order['o_jobPackageName']}}" readonly>
                                        </div>
                                        <div class="input form-group">
                                            <label for="">Sumber Dana</label>
                                            <input type="text" class="form-control" value="{{ data_order['o_sourceOfFund'] }}" readonly>
                                        </div>
                                        <div class="input form-group">
                                            <label for="">Pagu Anggaran</label>
                                            <input type="text" class="form-control" value="{{ data_order['o_budgetCeiling']|number_format }}">
                                        </div>
                                    </div>
                                    <div class="dc6">
                                        <div class="input form-group">
                                            <label for="">K/L/PD</label>
                                            <input type="text" class="form-control" value="{{data_order['o_institution_name']}}" readonly>
                                        </div>
                                        <div class="input form-group">
                                            <label for="">Tahun Anggaran</label>
                                            <input type="text" class="form-control" value="{{data_order['o_fiscalYear']}}" readonly>
                                        </div>
                                        <div class="input form-group">
                                            <label for="">Kode RUP</label>
                                            <input type="text" class="form-control" value="{{data_order['o_rupCode']}}" readonly>
                                        </div>
                                        <div class="input form-group">
                                            <label for="">Kode Rekening Anggaran</label>
                                            <input type="text" class="form-control" value="{{ data_order['o_budget_account'] }}" readonly>
                                        </div>
                                        {# <div class="input form-group">
                                            <label for="">Metode Pembayaran</label>
                                            <input type="text" class="form-control" value="{{ get_parameter('ppk_method_options')[order['o_ppk_payment_method']] }}" readonly>
                                        </div> #}
                                    </div>
                                </div>
                            </div>

                            <div id="tabProduk" class="tabcontent" style="{{set_display_nego_tab}}">
                                {% set user_type = app.user.role == 'ROLE_USER_SELLER' ? 'seller' : 'buyer' %}
                                
                                {% include '@__main__/public/user/user_ppk_treasurer/partial/data_produk_nego.html.twig' %}

                            </div>
                            {# KonfirmOrder #}
                            <div id="tabConfirmppk" class="tabcontent" style="{{set_display_confirm_ppk_tab}}">
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Konfirmasi Order</h4>
                                    </div>

                                    <div class="dc12">
                                        <div class="ccp__section ccp__box">
                                            <div class="row">
                                                {% if app.user.getRole != 'ROLE_USER_SELLER' %}
                                                <div class="dc12 tc12">
                                                    <h5>{{ 'label.store'|trans }}</h5>
                                                    <p>{{ order['s_name'] }}</p>
                                                </div>
                                                {% endif %}
                                                <div class="dc6 tc12">
                                                    <h5>{{ 'label.delivery_address'|trans }}</h5>
                                                    <p>{{ order['o_address'] }}</p>
                                                    <p>{{ order['o_city'] ~ ', ' ~ order['o_province'] ~ ' - ' ~ order['o_postCode'] }}</p>
                                                    {% if order['o_note'] is not empty %}
                                                        <h5>{{ 'label.note'|trans }}</h5><p>{{ order['o_note'] }}</p>
                                                    {% endif %}
                                                </div>
                                                <div class="dc6 tc12">
                                                    {# <div>
                                                        <h5>{{ 'label.ppk_payment_method'|trans }}</h5>
                                                        {% set ppk_payment_method = order['o_ppk_payment_method']|default('uang_persediaan') %}
                                                        <p>{{ 'label.ppk_payment_method'|trans }} : {{get_parameter('ppk_method_options')[ppk_payment_method]}}</p>
                                                    </div> #}
                                                    <h5>{{ 'label.order_status'|trans }}</h5>
                                                    <div id="order-content-status">
                                                        {% if order['o_status'] == 'pending' %}
                                                            <p><span>{{ 'label.pending'|trans }}</span>
                                                                ({{ order['o_createdAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'pending_approve' %}
                                                            <p><span>{{ 'label.pending_approve'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'pending_payment' %}
                                                            <p><span>{{ 'label.pending_payment'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'paid' %}
                                                            <p><span>{{ 'label.paid'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'payment_process' %}
                                                            <p><span>{{ 'label.payment_process'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'confirm_order_ppk' %}
                                                            <p><span>{{ 'label.confirm_order_ppk'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'approved_order' %}
                                                            <p><span>{{ 'label.approved_order'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'confirmed' %}
                                                            <p><span>{{ 'label.confirmed'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'processed' %}
                                                            <p><span>{{ 'label.processed'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'partial_delivery' %}
                                                            <p>
                                                                <span>{{ 'label.partial_delivery'|trans }}</span>
                                                                <span>({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</span>
                                                            </p>

                                                            {% if delivery_detail is not empty %}
                                                                {% for item in delivery_detail %}
                                                                    <p>-
                                                                        <span>{{ ('label.batch'|trans) }} {{ item['batch'] }},</span>
                                                                        <span>{{ 'label.tracking_code'|trans }}: </span>
                                                                        <span>{{ item['tracking_code'] }}</span>
                                                                        <span>({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</span>
                                                                    </p>
                                                                {% endfor %}
                                                            {% endif %}
                                                        {% elseif order['o_status'] == 'shipped' %}
                                                            <p>
                                                                <span>{{ 'label.shipped'|trans }}</span>

                                                                {% if delivery_detail is defined and delivery_detail is empty %}
                                                                    ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})
                                                                {% endif %}
                                                            </p>

                                                            {% if delivery_detail is defined and delivery_detail is not empty %}
                                                                {% for item in delivery_detail %}
                                                                    <p>-
                                                                        <span>{{ ('label.batch'|trans) }} {{ item['batch'] }},</span>
                                                                        <span>{{ 'label.tracking_code'|trans }}: </span>
                                                                        <span>{{ item['tracking_code'] }}</span>
                                                                        <span>({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</span>
                                                                    </p>
                                                                {% endfor %}
                                                            {% elseif order['o_shippingCourier'] != 'gosend' %}
                                                                <h6>{{ 'label.tracking_code'|trans ~ ': ' ~ order['o_trackingCode'] }}</h6>
                                                            {% endif %}
                                                        {% elseif order['o_status'] == 'received' %}
                                                            <p><span>{{ 'label.received'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'cancel' %}
                                                            <p><span>{{ 'label.cancelled'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'document' %}
                                                            <p><span>{{ 'label.document'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'tax_invoice' %}
                                                            <p><span>{{ 'label.tax_invoice'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% elseif order['o_status'] == 'cancel_request' %}
                                                            <p><span>{{ 'label.cancel_request'|trans }}</span></p>
                                                        {% elseif order['o_status'] == 'new_order' %}
                                                            <p><span>{{ 'label.new_order'|trans }}</span>
                                                                ({{ order['o_updatedAt']|date('d/m/Y - H:i') }})</p>
                                                        {% endif %}
                                                    </div>

                                                    {% set data_nego_detail_2 = null %}
                                                    {% set nego_batch_2 = 0 %}
                                                    {% set can_approve_negotiation_2 = false %}
                                                    {% set allow_negotiation_2 = false %}
                                                    {% set is_nego_seller = false %}
                                                    {% set is_nego_buyer = false %}
                                                    {% if order['o_negotiatedProducts']|length > 0 %}
                                                        {% for temp_nego_data in order['o_negotiatedProducts'] %}
                                                            {% set data_nego_detail_2 = temp_nego_data %}
                                                            {% set nego_batch_2 = temp_nego_data['on_batch'] %}

                                                            {% if user_type == 'buyer' and data_nego_detail_2['on_customerApproval'] == false %}
                                                                {% set allow_negotiation_2 = true %}
                                                            {% endif %}

                                                            {% if user_type == 'seller' and data_nego_detail_2['on_merchantApproval'] == false %}
                                                                {% set allow_negotiation_2 = true %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% endif %}

                                                    {% if user_type == 'seller' %}
                                                        {% set seller_attempt = 0 %}
                                                        {% set seller_batch = [] %}
                                                        {% for product in order['o_negotiatedProducts'] %}
                                                            {% if product['on_submittedAs'] == 'seller' and product['on_batch'] not in seller_batch %}
                                                                {% set seller_attempt = seller_attempt + 1 %}
                                                                {% set seller_batch = seller_batch|merge([product['on_batch']]) %}
                                                            {% endif %}
                                                        {% endfor %}

                                                        {% if data_nego_detail_2['on_merchantApproval'] == false %}
                                                            {% set can_approve_negotiation_2 = true %}
                                                            {% if (nego_batch_2 % 2) != 0 and allow_negotiation_2 == true %}
                                                                {% set is_nego_seller = true %}
                                                            {% endif %}
                                                        {% endif %}
                                                    {% elseif user_type == 'buyer' %}
                                                        {% set buyer_attempt = 0 %}
                                                        {% set buyer_batch = [] %}
                                                        {% for product in order['o_negotiatedProducts'] %}
                                                            {% if product['on_submittedAs'] == 'buyer' and product['on_batch'] not in buyer_batch %}
                                                                {% set buyer_attempt = buyer_attempt + 1 %}
                                                                {% set buyer_batch = buyer_batch|merge([product['on_batch']]) %}
                                                            {% endif %}
                                                        {% endfor %}
                                                        {% if data_nego_detail_2['on_customerApproval'] == false %}

                                                            {% if nego_batch_2 == 1 and data_nego_detail_2['on_merchantApproval'] == false %}
                                                                {% set can_approve_negotiation_2 = false %}
                                                                {# No action needed #}
                                                            {% else %}
                                                                {% set can_approve_negotiation_2 = true %}
                                                                {% if (nego_batch_2 % 2) != 0 and data_nego_detail_2['on_merchantApproval'] == false %}
                                                                {% elseif nego_batch_2 >= 5 and data_nego_detail_2['on_merchantApproval'] == true %}
                                                                    {% set is_nego_buyer = true %}
                                                                {% else %}
                                                                    {% set is_nego_buyer = true %}
                                                                {% endif %}
                                                            {% endif %}
                                                        {% endif %}
                                                    {% endif %}
                                                    <div>
                                                        <h5>Keterangan</h5>

                                                        {% if user_type == 'seller' %}
                                                            {% if is_nego_buyer != true and is_nego_seller == true %}
                                                                {% set nego_type = 'nego_on_seller' %}
                                                            {% else %}
                                                                {% set nego_type = 'nego_on_buyer' %}
                                                            {% endif %}
                                                        {% else %}
                                                            {% if is_nego_buyer == true and is_nego_seller != true %}
                                                                {% if data_nego_detail_2['on_merchantApproval'] == true %}
                                                                    {% set nego_type = 'nego_on_buyer_approve_seller' %}
                                                                {% else %}
                                                                    {% set nego_type = 'nego_on_buyer' %}
                                                                {% endif %}
                                                            {% else %}
                                                                {% set nego_type = 'nego_on_seller' %}
                                                            {% endif %}
                                                        {% endif %}
                                                        
                                                        
                                                        {% if order['o_status'] == 'confirmed' or order['o_status'] == 'new_order' %}
                                                            <p>{{ get_parameter('ket_order_statuses')[nego_type][user_type] }}</p>
                                                        {% elseif order['o_status'] == 'paid' %}
                                                            {% if disbursement_data is not empty and disbursement_data.getStatus() != 'pending' %}
                                                                {% set status_disbursement = 'disbursement_' ~ disbursement_data.getStatus() %}
                                                            {% else %}
                                                                {% set status_disbursement = order['o_status'] %}
                                                            {% endif %}
                                                            <p>{{ get_parameter('ket_order_statuses')[status_disbursement][user_type] }} </p>
                                                        {% else %}
                                                            <p>
                                                                {{ get_parameter('ket_order_statuses')[order['o_status']][user_type] }} 
                                                                {% if order['o_status'] == 'cancel' or order['o_status'] == 'cancel_request' %}
                                                                    {{ order['o_cancel_reason']|default()}}
                                                                {% endif %}
                                                            </p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="dc12">
                                        <div class="ccp ccp__box" style="padding-bottom: 60px;">
                                            <div class="ccp__section">
                                                <p class="ccp__price">
                                                    {% if order['o_shippingCourier'] == 'free_delivery' %}
                                                        {{ 'label.self_pick_up_alt'|trans }}
                                                        {% if order['o_shippingService'] == 'self_pick_up_2' %}
                                                            <b>[{{ 'message.info.self_pick_up_address_2'|trans }}]</b>
                                                        {% elseif order['o_shippingService'] == 'self_pick_up_3' %}
                                                            <b>[{{ 'message.info.self_pick_up_address_3'|trans }}]</b>
                                                        {% else %}
                                                            <b>[{{ 'message.info.self_pick_up_address'|trans }}]</b>
                                                        {% endif %}
                                                        Rp. 0
                                                    {% else %}
                                                        {% if order['u_role'] == 'ROLE_USER_GOVERNMENT' %}
                                                            {% set nego_batch = 0 %}
                                                            {% set nego_shipping_price = 0 %}
                                                            {% if order['o_negotiatedProducts']|length > 0 %}
                                                                {% for temp_nego_data in order['o_negotiatedProducts'] %}
                                                                    {% set nego_batch = temp_nego_data['on_batch'] %}
                                                                {% endfor %}

                                                                {% for product in order['o_products'] %}
                                                                    {% for product_nego in order['o_negotiatedProducts'] %}
                                                                        {% if (product_nego['p_id'] == product['p_id']) and (product_nego['on_batch'] == nego_batch) %}
                                                                            {% set nego_shipping_price = product_nego['on_negotiatedShippingPrice'] %}
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                {% endfor %}
                                                            {% endif %}

                                                            {% if order['o_negotiationStatus'] == 'none' %}
                                                                {% set initial_shipping_cost = order['o_shippingPrice'] %}
                                                            {% else %}
                                                                {% set initial_shipping_cost = get_base_price(order['o_shippingPriceBackup'], tax_value) %}
                                                            {% endif %}

                                                            {% if order['o_shipped_method'] == 'self_courier' %}
                                                                <b>{{ get_parameter('shipped_method_options')['self_courier'] }}</b>
                                                            {% else %}
                                                            {{ 'label.courier'|trans }}
                                                                <b>{{ order['o_shippingCourier'] }} [{{ order['o_shippingService'] }}]</b>
                                                            {% endif %}

                                                            <div style="float: right;">
                                                                <table>
                                                                    <tr>
                                                                        <td>{{ 'label.initial_shipping_costs'|trans }}</td>
                                                                        <td>:&nbsp;</td>
                                                                        <td> Rp. {{ initial_shipping_cost|number_format }}</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>{{ 'label.negotiation_shipping'|trans }}</td>
                                                                        <td>:&nbsp;</td>
                                                                        <td> Rp. {{ nego_shipping_price|number_format }}</td>
                                                                    </tr>
                                                                </table>
                                                            </div>
                                                            <br>

                                                        {% else %}
                                                            {% if order['o_shipped_method'] == 'self_courier' %}
                                                                <b>{{ get_parameter('shipped_method_options')['self_courier'] }}</b>
                                                            {% else %}
                                                                {{ 'label.courier'|trans }}
                                                                <b>{{ order['o_shippingCourier'] }} [{{ order['o_shippingService'] }}]</b>
                                                            {% endif %}
                                                            Rp. {{ order['o_shippingPrice']|number_format }}
                                                        {% endif %}

                                                    {% endif %}
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="dc12">
                                        <div class="table-wrapper">
                                            <div class="inner">
                                                <table class="nego">
                                                    <tr class="thead_n">
                                                        <td colspan="7" class="c">
                                                            <b>{{ 'label.last_negotiation_data'|trans }}</b>
                                                        </td>
                                                    </tr>
                                                    <tr class="thead">
                                                        <td>{{ 'label.number'|trans }}</td>
                                                        <td>{{ 'label.sku'|trans }}</td>
                                                        <td>{{ 'label.product_name'|trans }}</td>
                                                        <td>{{ 'label.qty'|trans }}</td>
                                                        <td>{{ 'label.unit_alt'|trans }}</td>
                                                        <td>{{ 'label.selling_price'|trans }}
                                                            (Rp.)</td>
                                                        <td>{{ 'label.count'|trans }}</td>
                                                    </tr>
                                                    {% set numbering = 1 %}
                                                    {% set sub_total_nego_price = 0 %}
                                                    {% set initial_with_shipping = true %}
                                                    {% for product in order['o_products'] %}
                                                        {% for product_nego in order['o_negotiatedProducts'] %}
                                                            {% if (product_nego['p_id'] == product['p_id']) and (product_nego['on_batch'] == nego_batch) %}
                                                                {% set nego_price = (product_nego['on_negotiatedPrice'] * product['op_quantity'])|number_format %}
                                                                {% set sub_total_nego_price = sub_total_nego_price + (product_nego['on_negotiatedPrice'] * product['op_quantity']) %}
                                                                {# {{ dump(sub_total_ppn_price) }} #}
                                                                {# {% if initial_with_shipping == true %}
                                                                    {% set sub_total_ppn_price = sub_total_ppn_price + (product_nego['on_taxNominalPrice'] * product['op_quantity']) + product_nego['on_taxNominalShipping'] %}
                                                                {% else %}
                                                                    {% set sub_total_ppn_price = sub_total_ppn_price + (product_nego['on_taxNominalPrice'] * product['op_quantity']) %}
                                                                {% endif %} #}
                                                                {% set initial_with_shipping = false %}
                                                                {% set nego_shipping_price = product_nego['on_negotiatedShippingPrice'] %}
                                                                {% set product_url = 'javascript:void(0);' %}

                                                                {% if product['p_slug'] is not empty and product['s_slug'] is not empty %}
                                                                    {% set product_url = path('store_product_page', {
                                                                        'store': product['s_slug'],
                                                                        'product': product['p_slug'],
                                                                    }) %}
                                                                {% endif %}
                                                                <tr>
                                                                    <td class="number">
                                                                        <b>{{ numbering }}</b>
                                                                    </td>
                                                                    <td>{{ product['p_sku'] }}</td>
                                                                    <td>
                                                                        <b><a href="{{product_url}}" target="blank">{{ product['p_name'] }}</a></b>
                                                                    </td>
                                                                    <td class="c">
                                                                        <b>{{ product['op_quantity'] }}</b>
                                                                    </td>
                                                                    <td class="c">{{ product['p_unit'] }}</td>
                                                                    <td class="text_r">Rp.
                                                                        {{ product_nego['on_negotiatedPrice']|number_format }}</td>
                                                                    <td class="text_r">Rp.
                                                                        {{ nego_price }}</td>
                                                                </tr>
                                                                {% set numbering = numbering + 1 %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% endfor %}
                                                    <tr>
                                                        <td colspan="5" rowspan="5"></td>
                                                        <td class="t_price">
                                                            <b>{{ 'label.total_price_of_goods'|trans }}</b>
                                                        </td>
                                                        <td class="text_r">Rp.
                                                            {{ sub_total_nego_price|number_format }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="t_price">
                                                            <b>{{ 'label.delivery_fee'|trans }}</b>
                                                        </td>
                                                        <td class="text_r">Rp.
                                                            {{ nego_shipping_price|number_format }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="t_price">
                                                            <b>{{ 'label.sub_total'|trans }}</b>
                                                        </td>
                                                        <td class="text_r">Rp.
                                                            {{ (sub_total_nego_price + nego_shipping_price)|number_format }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="t_price">
                                                            <b>{{ 'label.ppn'|trans }}</b>
                                                        </td>
                                                        {# {% set sub_total_ppn_price = sub_total_nego_price >= 2000000 ? (sub_total_nego_price + nego_shipping_price) * (11 / 100) : 0 %} #}
                                                        <td class="text_r">Rp.
                                                            {{ sub_total_ppn_price|round|number_format }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="t_price">
                                                            <b>{{ 'label.total'|trans }}</b>
                                                        </td>
                                                        <td class="text_r">Rp.
                                                            {{ (sub_total_nego_price + nego_shipping_price + sub_total_ppn_price)|round|number_format }}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>

                                        
                                        
                                    </div>

                                    

                                    {% if order['o_status'] == 'confirm_order_ppk' and app.user.subRole == 'PPK' %}
                                        <div class="dc12 containers" >

                                            {% if is_granted('order.order_confirmation' , 'permission')  %}
                                                <button id="popup-approve-ppk-btn" type="submit" class="sBtn red mt-3">
                                                    {{ 'button.approve_order'|trans }}
                                                </button>
                                            {% endif %}


                                            {% if is_granted('order.cancel_order' , 'permission') %}
                                                <button id="btn-negotiate" type="submit" class="sBtn red mt-3">
                                                    Batal
                                                </button>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div id="tabVoucher" class="tabcontent" style="display: none;">

                                {% set order_vouchers_list = order_vouchers(order['o_sharedId']) %}
                                {% set order_vouchers_lists = order_vouchers(order['o_sharedId'], 'no') %}
                                {% set shared_voucher = order['o_sharedId'] is not empty and reduce_order_by_id[order['o_id']] is defined %}
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Voucher</h4>
                                    </div>
                                    <div class="dc12">
                                        <div class="row">
                                            {% if order_vouchers_list|length > 0 %}
                                                {% set v_lists = [] %}
                                                {% for voucher_list in order_vouchers_lists %}
                                                    {% if voucher_list['v_code'] not in v_lists %}
                                                        <div class="dc6">
                                                            <div class="input form-group">
                                                                <label>{{ 'label.code'|trans ~ ': ' ~ voucher_list['v_code'] }}</label>
                                                                <input class="form-control" type="text" value="{{ voucher_list['v_amount']|number_format }}" readonly>
                                                            </div>
                                                        </div>
                                                        {% set v_lists = v_lists|merge([voucher_list['v_code']]) %}
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        {% if shared_voucher %}
                                            <div class="dc12">
                                                <div class="input form-group">
                                                    <label>{{ 'menu.voucher_used'|trans }}</label>
                                                    <input class="form-control" type="text" value="{{ reduce_order_by_id[order['o_id']]|number_format }}" readonly>
                                                </div>
                                            </div>
                                        {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="tabRating" class="tabcontent" style="{{set_display_rating_tab}}">
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Rating Produk</h4>
                                    </div>
                                    <div class="dc12">
                                        {% include '@__main__/public/user/order/fragments/product_rating.html.twig' %}
                                    </div>
                                </div>
                            </div>

                            <div id="tabPengiriman" class="tabcontent" style="{{set_display_process_tab}}">
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Produk Pengiriman</h4>
                                    </div>
                                    {% set kurir = order['o_shipped_method'] == 'self_courier' ? 'Mandiri' : order['o_shippingCourier'] ~ '(' ~ order['o_shippingService'] ~ ')' %}
                                    {# <div class="dc6">
                                        <div class="input form-group">
                                            <label for="">Kurir Pengiriman</label>
                                            <input type="text" class="form-control" value="{{ kurir }}" readonly>
                                        </div>
                                    </div>
                                    <div class="dc6">
                                        <div class="input form-group">
                                            <label for="">Kode Track</label>
                                            <input type="text" class="form-control" value="{{ order['o_trackingCode'] }}" readonly>
                                        </div>
                                    </div>
                                    <div class="dc12">
                                        <div class="input form-group">
                                            <label for="">Catatan Pengiriman</label>
                                            <textarea class="form-control" readonly>{{ order['o_note'] }}</textarea>
                                        </div>
                                    </div> #}

                                    <div class="dc12">
                                        <div class="ccp__section ccp__box">
                                            <div class="row">
                                                <div class="dc6 tc12">
                                                    <h5>Kurir Pengiriman</h5>
                                                    <p> {{ kurir }} </p>
                                                </div>
                                                <div class="dc6 tc12">
                                                    <h5>Kode Track</h5>
                                                    <p> {{ order['o_trackingCode'] is not empty ? order['o_trackingCode'] : '-' }}</p>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="dc12">
                                                    <h5>Catatan Pengiriman</h5>
                                                    <p> {{ order['o_note'] }} </p>
                                                </div>
                                            </div>

                                            <div class="row">
                                                {% if order['o_state_img'] %}
                                                    <div class="dc12">
                                                        <h5>Foto Pengiriman</h5>
                                                        <img src="{{ asset('sftp/file/uploads/' ~ order['o_state_img']) }}" style="width: 200px;">
                                                    </div>
                                                {% endif %}
                                                {% if order['o_shipped_method'] == 'self_courier' %}
                                                    <div class="dc12">
                                                        <h5>Foto Pengiriman</h5>
                                                       {% if order['o_shippedFiles'] %}
                                                            {% for item in order['o_shippedFiles'] %}
                                                                <div class="dc4">
                                                                    <img src="{{ asset('sftp/file/uploads/' ~ item['os_filepath']) }}" style="width: 200px;">
                                                                </div>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {# {% if order['o_state_img'] %}
                                        <div class="dc12">
                                            <div class="input form-group">
                                                <label for="">Foto Pengiriman</label>
                                            </div>
                                        </div>
                                        <div class="dc4">
                                            <img src="{{ asset('sftp/file/uploads/' ~ order['o_state_img']) }}" style="width: 200px;">
                                        </div>
                                    {% endif %}
                                    {% if order['o_shipped_method'] == 'self_courier' %}
                                        <div class="dc12">
                                            <div class="input form-group">
                                                <label for="">Foto Pengiriman</label>
                                            </div>
                                        </div>
                                        {% if order['o_shippedFiles'] %}
                                            {% for item in order['o_shippedFiles'] %}
                                                <div class="dc4">
                                                    <img src="{{ asset('sftp/file/uploads/' ~ item['os_filepath']) }}" style="width: 200px;">
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    {% endif %} #}
                                    {% if order['o_status'] == 'processed' %}
                                        <div class="dc12">
                                            {% include '@__main__/public/user/order/fragments/order_action.html.twig' %}
                                        </div>
                                    {% endif %}

                                    {% if order['o_master_id'] is not empty and order['o_type_order'] == 'partial' %}
                                        <div class="dc12 mt-5" style="margin-top: 50px; padding-top: 25px; border-top: 1px solid #f3f3f3; ">
                                            <h4>Riwayat Pengiriman</h4>

                                            {% for order_partial in order_partials %}
                                                {% set sub_total_nego_price = 0 %}
                                                {% set numbering = 1 %}
                                                {% set initial_with_shipping = false %}
                                                <div class="table-wrapper">
                                                    <div class="inner">
                                                        <table class="nego">
                                                            <tr class="thead_n">
                                                                <td colspan="7" class="c">
                                                                    <b> Pengiriman Parsial {{ order_partial['o_batch'] }} - ({{ order_partial['date_format'] }}) </b>
                                                                </td>
                                                            </tr>
                                                            <tr class="thead">
                                                                <td>{{ 'label.number'|trans }}</td>
                                                                <td>{{ 'label.sku'|trans }}</td>
                                                                <td>{{ 'label.product_name'|trans }}</td>
                                                                <td>{{ 'label.qty'|trans }}</td>
                                                                <td>{{ 'label.unit_alt'|trans }}</td>
                                                                <td>{{ 'label.selling_price'|trans }}
                                                                    (Rp.)</td>
                                                                <td>{{ 'label.count'|trans }}</td>
                                                            </tr>
                                                            
                                                            
                                                            {% set sub_total_nego_price = 0 %}
                                                            {% set sub_total_ppn_price = 0 %}
                                                            {% set numbering = 1 %}
                                                            {% set initial_with_shipping = true %}
                                                            {% for product in order_partial['o_products'] %}
                                                                {% for product_nego in order_partial['o_negotiatedProducts'] %}
                                                                    {% if (product_nego['p_id'] == product['p_id']) and (product_nego['on_batch'] == nego_batch) %}
                                                                        {% set nego_price = (product_nego['on_negotiatedPrice'] * product['op_quantity'])|number_format %}
                                                                        {% set sub_total_nego_price = sub_total_nego_price + (product_nego['on_negotiatedPrice'] * product['op_quantity']) %}
                                                                        {% if initial_with_shipping == true %}
                                                                            {% set sub_total_ppn_price = sub_total_ppn_price + (product_nego['on_taxNominalPrice'] * product['op_quantity']) + product_nego['on_taxNominalShipping'] %}
                                                                        {% else %}
                                                                            {% set sub_total_ppn_price = sub_total_ppn_price + (product_nego['on_taxNominalPrice'] * product['op_quantity']) %}
                                                                        {% endif %}
                                                                        {% set initial_with_shipping = false %}

                                                                        {% set nego_shipping_price = product_nego['on_negotiatedShippingPrice'] %}
                                                                        {% set product_url = 'javascript:void(0);' %}

                                                                        {% if product['p_slug'] is not empty and product['s_slug'] is not empty %}
                                                                            {% set product_url = path('store_product_page', {
                                                                                'store': product['s_slug'],
                                                                                'product': product['p_slug'],
                                                                            }) %}
                                                                        {% endif %}
                                                                        <tr>
                                                                            <td class="number">
                                                                                <b>{{ numbering }}</b>
                                                                            </td>
                                                                            <td>{{ product['p_sku'] }}</td>
                                                                            <td>
                                                                                <b><a href="{{product_url}}" target="blank">{{ product['p_name'] }}</a></b>
                                                                            </td>
                                                                            <td class="c">
                                                                                <b>{{ product['op_quantity'] }}</b>
                                                                            </td>
                                                                            <td class="c">{{ product['p_unit'] }}</td>
                                                                            <td class="text_r">Rp.
                                                                                {{ product_nego['on_negotiatedPrice']|number_format }}</td>
                                                                            <td class="text_r">Rp.
                                                                                {{ nego_price }}</td>
                                                                        </tr>
                                                                        {% set numbering = numbering + 1 %}
                                                                    {% endif %}
                                                                {% endfor %}
                                                            {% endfor %}
                                                            <tr>
                                                                <td colspan="5" rowspan="5"></td>
                                                                <td class="t_price">
                                                                    <b>{{ 'label.total_price_of_goods'|trans }}</b>
                                                                </td>
                                                                <td class="text_r">Rp.
                                                                    {{ sub_total_nego_price|number_format }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td class="t_price">
                                                                    <b>{{ 'label.delivery_fee'|trans }}</b>
                                                                </td>
                                                                <td class="text_r">Rp.
                                                                    {{ nego_shipping_price|number_format }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td class="t_price">
                                                                    <b>{{ 'label.sub_total'|trans }}</b>
                                                                </td>
                                                                <td class="text_r">Rp.
                                                                    {{ (sub_total_nego_price + nego_shipping_price)|number_format }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td class="t_price">
                                                                    <b>{{ 'label.ppn'|trans }}</b>
                                                                </td>
                                                                {# {% set sub_total_ppn_price = sub_total_nego_price >= 2000000 ? (sub_total_nego_price + nego_shipping_price) * (11 / 100) : 0 %} #}
                                                                <td class="text_r">Rp.
                                                                    {{ sub_total_ppn_price|round|number_format }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td class="t_price">
                                                                    <b>{{ 'label.total'|trans }}</b>
                                                                </td>
                                                                <td class="text_r">Rp.
                                                                    {{ (sub_total_nego_price + nego_shipping_price + sub_total_ppn_price)|round|number_format }}</td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}

                                </div>
                            </div>


                            <div id="tabPembayaran" class="tabcontent" style="display: none;">
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Pembayaran</h4>
                                    </div>
                                    <div class="dc6">
                                        <div class="input form-group">
                                            <label for="">Tipe Pembayaran</label>
                                            <input type="text" class="form-control" value="{{ order['op_type'] }}" readonly>
                                            {% if order['o_status'] == 'confirmed' or order['o_status'] == 'new_order' %}
                                                <p style="font-size: 10px;color: white;">.</p>
                                            {% endif %}
                                            
                                        </div>
                                        <div class="input form-group">
                                            <label for="">Bank</label>
                                            <input type="text" class="form-control" value="{{ order['op_bankName'] }}" readonly>
                                        </div>
                                    </div>
                                    <div class="dc6">
                                        <div class="input form-group">
                                            {% set voucher_value = 0 %}
                                            {% set ov_lists = [] %}
                                            {% if order['o_isB2gTransaction'] %}
                                                {% if order['o_negotiationStatus'] == 'finish' or order['o_status'] == 'processed' or nego_is_approve == true %}
                                                    {% set grand_total = order['o_total'] + order['o_shippingPrice'] %}
                                                {% else %}
                                                    {% set set_ppn = order['s_pkp'] == 0 ? 0 : generate_tax(order['o_total'], tax_value) %}
                                                    {% set grand_total = order['o_total'] + order['o_shippingPrice'] + set_ppn %}
                                            {#		{% set grand_total = order['o_total'] + order['o_shippingPrice'] %}#}

                                            {#        {% for product in order['o_products'] %}#}
                                            {#            {% set grand_total = grand_total + product['op_taxNominal'] %}#}
                                            {#        {% endfor %}#}
                                                {% endif %}
                                            {% else %}
                                                {% set grand_total = order['o_total'] + order['o_shippingPrice'] %}

                                                {% for product in order['o_products'] %}
                                                    {% set grand_total = grand_total + product['op_taxNominal'] %}
                                                {% endfor %}
                                            {% endif %}


                                            {% if order_vouchers_list|length > 0 %}
                                                {% set v_lists = [] %}
                                                {% set temp_voucher_shared = 0 %}
                                                {% for voucher_list in order_vouchers_lists %}
                                                    {% if voucher_list['v_code'] not in v_lists %}
                                                        {% set amount_with_voucher = amount_with_voucher - voucher_list['v_amount'] %}
                                                        {% set v_lists = v_lists|merge([voucher_list['v_code']]) %}
                                                        {% set temp_voucher_shared = temp_voucher_shared + voucher_list['v_amount'] %}
                                                    {% endif %}

                                                    {% if voucher_list['vul_orderId'] not in ov_lists %}
                                                        {% set ov_lists = ov_lists|merge([voucher_list['vul_orderId']]) %}
                                                    {% endif %}
                                                {% endfor %}

                                                {% if ov_lists|length > 1 %}
                                                    {% set voucher_value = (temp_voucher_shared / ov_lists|length)|round(0, 'floor') %}
                                                {% else %}
                                                    {% set voucher_value = temp_voucher_shared %}
                                                {% endif %}
                                            {% endif %}

                                            {% set order_paid_nominal = order['op_nominal']|default(0) %}
                                            {% set amount_with_voucher = grand_total %}

                                            {% if shared_voucher %}
                                                {% set order_paid_nominal = (grand_total - reduce_by_order_id[order['o_id']]) %}
                                            {% else %}
                                                {% if amount_with_voucher > 0 %}
                                                    {% set order_paid_nominal = amount_with_voucher %}
                                                {% endif %}
                                                {% if voucher_value > 0 %}
                                                    {% set order_paid_nominal = grand_total - voucher_value %}
                                                {% endif %}
                                            {% endif %}
                                            <label for="">Nominal</label>
                                            <input type="text" class="form-control" value="{{ order_paid_nominal > 0 ? order_paid_nominal|round|number_format : '' }}" readonly>
                                            {% if order['o_status'] == 'confirmed' or order['o_status'] == 'new_order' %}
                                                <p style="font-size: 10px;color: #999;"><i>Nominal ini akan berubah setelah negosiasi sepakat</i></p>
                                            {% endif %}
                                        </div>
                                        <div class="input form-group">
											{% set order_paid_at = order['op_createdAt']|default() %}
                                            <label for="">Tanggal Bayar</label>
                                            <input type="text" class="form-control" value="{{ order_paid_at is not empty ? order_paid_at|date('d F Y, H:i') : '' }}" readonly>
                                        </div>
                                    </div>
                                    {% if order['op_type'] == 'doku' %}
                                        <div class="dc6">
                                            <div class="input form-group">
                                                <label for="">Doku Invoice</label>
                                                <input type="text" class="form-control" value="{{ order['o_dokuInvoiceNumber'] }}" readonly>
                                            </div>
                                        </div>
                                        {% if order['od_status'] is defined and order['od_status'] == 'SUCCESS' %}
                                            <div class="dc6">
                                                <div class="input form-group">
                                                    <label for="">No Virtual Account</label>
                                                    <input type="text" class="form-control" value="{{ order['od_response']['virtual_account_info'] is defined ? order['od_response']['virtual_account_info']['virtual_account_number'] : '' }}" readonly>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                    {% if order['op_attachment'] is not empty %}
                                        <div class="dc12">
                                            <figure>
                                                {% if order['op_type'] == 'doku' %}
                                                    <a href="{{ order['op_attachment'] }}" title="{{ 'button.download'|trans }}" target="_blank">
                                                        <img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">
                                                    </a>
                                                {% else %}
                                                    {% if '.pdf' in order['op_attachment'] %}
                                                        <a href="{{ site_url(order['op_attachment']) }}" title="{{ 'button.download'|trans }}" target="_blank">
                                                            <img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">
                                                        </a>
                                                    {% else %}
                                                        <a href="{{ site_url(order['op_attachment']) }}" title="{{ 'button.view'|trans }}" class="cbox-gallery">
                                                            <img class="img-responsive" src="{{ site_url(order['op_attachment']) }}" alt="" style="width: 120px;">
                                                        </a>
                                                    {% endif %}
                                                {% endif %}
                                            </figure>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            {% set total_order = order['o_total'] + order['o_shippingPrice'] %}
                            {% set limit_dokumen = get_parameter('limit_trx_50') %}
                            <div id="tabDokumen" class="tabcontent" style="{{set_display_doc_tab}}">
                            
                                    <div class="row">
                                        <div class="dc12">
                                            <h4>DOKUMEN SEDERHANA</h4>
                                        </div>  

                                        {% if data_order['o_type_order'] == 'partial' and data_order['o_master_id'] is not empty %}
                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Label
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': order['o_id'], 'type': 'label'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'label'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type="label" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': order['o_id'], 'type': 'label'}) }}" data-filename="Label">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>

                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    {{ 'label.bast'|trans }}
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type='bast' type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}" data-filename="{{ 'label.bast'|trans }}">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div> 
                                        {% endif %} 

                                        <div class="dc3" style="text-align:center">
                                            <h6>
                                                {{ 'button.print.spk_label'|trans }}
                                            </h6><br>

                                        {% if data_order['o_status'] == 'confirm_order_ppk' %}
                                            <figure>
                                                <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'spk_non_ttd'}) }}">
                                                    <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                </a>
                                            </figure>

                                            <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'spk_non_ttd'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                            
                                            <button data-type='spk' type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'spk'}) }}" data-filename="{{ 'button.print.spk'|trans }}">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                                <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                            </button>
                                        {% else %}
                                             <figure>
                                                <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'spk'}) }}">
                                                    <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                </a>
                                            </figure>

                                            <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'spk'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                            
                                            <button data-type='spk' type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'spk'}) }}" data-filename="{{ 'button.print.spk'|trans }}">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                                <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                            </button>
                                        {% endif %}
                                        </div>


                                        {# <div class="dc3" style="text-align:center">
                                            <h6>
                                                Surat Tagihan
                                            </h6><br>
                                        
                                            <figure>
                                                <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}">
                                                    <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                </a>
                                            </figure>

                                            <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                            <button data-type="performa_invoice" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}" data-filename="{{ 'label.invoice'|trans }}">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                                <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                            </button>
                                        </div> #}

                                        {% if data_order['o_status'] == 'paid' and data_order['o_taxType'] == '58' %}
                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    {{ 'label.surat_tagihan'|trans }} 
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'invoice'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'invoice'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'invoice'}) }}" data-filename="{{ 'label.invoice'|trans }}">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        {% endif %}

                                        

                                        <div class="dc3" style="text-align:center">
                                            <h6>
                                                {{ 'label.receipt'|trans }}
                                            </h6><br>
                                            <figure>
                                                <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'receipt_ls'}) }}">
                                                    <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                </a>
                                            </figure>

                                            <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'receipt_ls'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                            <button data-type="receipt_ls" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'receipt_ls'}) }}" data-filename="{{ 'label.receipt'|trans }}">
                                                <i class="fa fa-download" aria-hidden="true"></i>
                                                <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                            </button>
                                        </div>

                                         {% if data_order['o_type_order'] == 'master' and data_order['o_master_id'] is empty and data_order['o_shipping_type'] == 'direct' %}
                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Label
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'label'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'label'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type="label" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'label'}) }}" data-filename="Label">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>

                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    {{ 'label.bast'|trans }}
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type='bast' type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}" data-filename="{{ 'label.bast'|trans }}">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>  

                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Surat Tagihan
                                                </h6><br>
                                            
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>

                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type="performa_invoice" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}" data-filename="{{ 'label.invoice'|trans }}">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>

                                            {# {% if data_order['o_status'] == 'paid' and data_order['o_taxType'] == '58' %}
                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        {{ 'label.surat_tagihan'|trans }} Test 2
                                                    </h6><br>
                                                    <figure>
                                                        <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'invoice'}) }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>
                                                    <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'invoice'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                    <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'invoice'}) }}" data-filename="{{ 'label.invoice'|trans }}">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>
                                            {% endif %} #}
                                        {% endif %}

                                        {% if data_order['o_type_order'] == 'partial' and data_order['o_master_id'] is empty %}
                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Label
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'label'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'label'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type="label" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'label'}) }}" data-filename="Label">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>

                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    {{ 'label.bast'|trans }}
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type='bast' type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}" data-filename="{{ 'label.bast'|trans }}">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>  

                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Surat Tagihan
                                                </h6><br>
                                            
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>

                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type="performa_invoice" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'performa_invoice'}) }}" data-filename="{{ 'label.invoice'|trans }}">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>

                                            {# {% if data_order['o_status'] == 'paid' and data_order['o_taxType'] == '58' %}
                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        {{ 'label.surat_tagihan'|trans }} Test 2
                                                    </h6><br>
                                                    <figure>
                                                        <a href="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'invoice'}) }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>
                                                    <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'invoice'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                    <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'invoice'}) }}" data-filename="{{ 'label.invoice'|trans }}">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>
                                            {% endif %} #}
                                        {% endif %}
                                    </div>

                                    {# Parsial accordion #}
                                    {% if data_order['o_type_order'] == 'partial' and data_order['o_master_id'] is not empty %}
                                        <div class="row">
                                            <div class="dc12" style="margin: 0;">
                                                <h4 style="margin: 0;">DOKUMEN PARSIAL</h4>
                                            </div> 
                                        </div>
                                    {% endif %}

                                    {% for key, item  in order_partials %}
                                        <div class="ccp__section ccp__box">
                                            <div class="row">
                                                <div class="dc12">
                                                    <h6>Invoice : {{ item['o_invoice'] }}</h6>
                                                </div> 
                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Surat Pengiriman Parsial
                                                    </h6><br>
                                                    <figure>
                                                        <a href="{{ path('user_order_print', {'id': item['o_id'], 'type': 'surat-pengiriman-parsial'}) }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>
                                                    
                                                    <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': item['o_id'], 'type': 'surat-pengiriman-parsial'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                    <button data-type="label" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': item['o_id'], 'type': 'surat-pengiriman-parsial'}) }}" data-filename="Label">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>
                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Label
                                                    </h6><br>
                                                    <figure>
                                                        <a href="{{ path('user_order_print', {'id': item['o_id'], 'type': 'label'}) }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>
                                                    
                                                    <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': item['o_id'], 'type': 'label'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                    <button data-type="label" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': item['o_id'], 'type': 'label'}) }}" data-filename="Label">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>

                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        {{ 'label.bast'|trans }}
                                                    </h6><br>
                                                    <figure>
                                                        <a href="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>
                                                    <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                    <button data-type='bast' type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast'}) }}" data-filename="{{ 'label.bast'|trans }}">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>  

                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Surat Tagihan
                                                    </h6><br>
                                                
                                                    <figure>
                                                        <a href="{{ path('user_order_print', {'id': item['o_id'], 'type': 'performa_invoice'}) }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>

                                                    <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': item['o_id'], 'type': 'performa_invoice'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                    <button data-type="performa_invoice" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': item['o_id'], 'type': 'performa_invoice'}) }}" data-filename="{{ 'label.invoice'|trans }}">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>

                                                {% if item['o_status'] == 'paid' and item['o_taxType'] == '58' %}
                                                    <div class="dc3" style="text-align:center">
                                                        <h6>
                                                            {{ 'label.surat_tagihan'|trans }}
                                                        </h6><br>
                                                        <figure>
                                                            <a href="{{ path('user_order_print', {'id': item['o_id'], 'type': 'invoice'}) }}">
                                                                <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                            </a>
                                                        </figure>
                                                        <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': item['o_id'], 'type': 'invoice'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                        <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': item['o_id'], 'type': 'invoice'}) }}" data-filename="{{ 'label.invoice'|trans }}">
                                                            <i class="fa fa-download" aria-hidden="true"></i>
                                                            <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                        </button>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endfor %}

                                    {% if total_order > limit_dokumen %} 
                                        <div class="row" style="margin-top: 30px;">
                                    
                                            <div class="dc12">
                                                <h4>DOKUMEN PERJANJIAN</h4>
                                            </div>

                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Surat Perintah Kerja
                                                </h6><br>
                                                <figure>
                                                    {# {% set type_spk = order['o_ppk_payment_method'] == 'pembayaran_langsung' ? 'spk_new' : 'spk_new_ls' %} #}
                                                    <a href="{{ path('user_order_print', {'id': order['o_id'], 'type': 'spk_new_ls'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                            <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'spk_new_ls'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type="spk_new_ls" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': order['o_id'], 'type': 'spk_new_ls'}) }}" data-filename="SPK">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>

                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Berita Acara Serah Terima
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast_ls'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast_ls'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type="bast_ls" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bast_ls'}) }}" data-filename="BAST">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>

                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Berita Acara Pembayaran
                                                </h6><br>
                                                <figure>
                                                    {# {% set type_bapd = order['o_ppk_payment_method'] == 'pembayaran_langsung' ? 'bapd' : 'bapd_ls' %} #}
                                                    <a href="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bapd_ls'}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                <button class="btn-viewdoc" data-path="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bapd_ls'}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button data-type="bapd_ls" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print', {'id': order['o_id'], 'type': 'bapd_ls'}) }}" data-filename="BAPD">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>

                                        </div>
                                    {% endif %}

                                    {# <div class="row" style="margin-top: 30px;">
                                        <div class="dc12">
                                            <h4>DOKUMEN ADDENDUM</h4>
                                        </div>

                                        <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Surat Addendum
                                                    </h6><br>
                                                
                                                    <figure>
                                                        <a href="{{ asset('assets/dummy/addendum_surat_pesanan.pdf') }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>

                                                    <button class="btn-viewdoc" data-path="{{ asset('assets/dummy/addendum_surat_pesanan.pdf') }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                    <button data-type="performa_invoice" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ asset('assets/dummy/addendum_surat_pesanan.pdf') }}" data-filename="{{ 'label.invoice'|trans }}">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>

                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Surat Perintah Pengiriman Addendum
                                                    </h6><br>
                                                
                                                    <figure>
                                                        <a href="{{ asset('assets/dummy/surat_perintah_pengiriman.pdf') }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>

                                                    <button class="btn-viewdoc" data-path="{{ asset('assets/dummy/surat_perintah_pengiriman.pdf') }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                    <button data-type="performa_invoice" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ asset('assets/dummy/surat_perintah_pengiriman.pdf') }}" data-filename="{{ 'label.invoice'|trans }}">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>
                                    </div> #}

                                
                                    <div class="row" style="margin-top: 30px;">
                                        <div class="dc12">
                                            <h4>DOKUMEN TAMBAHAN</h4>
                                        </div>
                                            
                                        {% if order['o_taxInvoiceFile'] is not empty  %}
                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Faktur Pajak
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ asset('uploads/' ~ order['o_taxInvoiceFile']) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                {# <a href="{{ asset('uploads/' ~ order['o_taxInvoiceFile']) }}">
                                                    <button style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                                </a> #}
                                                <button class="btn-viewdoc" data-path="{{ asset('uploads/' ~ order['o_taxInvoiceFile']) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>

                                                <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ asset('uploads/' ~ order['o_taxInvoiceFile']) }}" data-filename="FakturPajak">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        {% endif %}
                                        
                                    
                                        
                                        {% if order['o_withholdingTaxSlipFile'] is not empty %}
                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    Bukti Potong dan Bukti Bayar Pajak
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ asset('uploads/' ~ order['o_withholdingTaxSlipFile']) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                {# <a href="{{ asset('uploads/' ~ order['o_withholdingTaxSlipFile']) }}">
                                                    <button style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                                </a> #}
                                                <button class="btn-viewdoc" data-path="{{ asset('uploads/' ~ order['o_withholdingTaxSlipFile']) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                                <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ asset('uploads/' ~ order['o_withholdingTaxSlipFile']) }}" data-filename="BuktiPotong">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        {% endif %}                                  
                                                                              
                                       
                                        {% if order['o_other_document'] is not empty %}
                                            <div class="dc3" style="text-align:center">
                                                <h6>
                                                    {{order['o_other_document_name'] is not empty ? order['o_other_document_name'] : 'Dokumen Lainnya'}}
                                                </h6><br>
                                                <figure>
                                                    <a href="{{ path('sftp_show_file', {'path': 'uploads/' ~ order['o_other_document']}) }}">
                                                        <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                    </a>
                                                </figure>
                                                {# <a href="{{ asset('uploads/' ~ order['o_other_document']) }}">
                                                    <button style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                                </a> #}
                                                <button class="btn-viewdoc" data-path="{{ path('sftp_show_file', {'path': 'uploads/' ~ order['o_other_document']}) }}" type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                                <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('sftp_show_file', {'path': 'uploads/' ~ order['o_other_document']}) }}" data-filename="DokumenLainnya">
                                                    <i class="fa fa-download" aria-hidden="true"></i>
                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        {% endif %}    
                                                               
                                        {% if (app.user.subRole == 'TREASURER' and order['o_withholdingTaxSlipFile'] is empty and order['o_taxInvoiceFile'] is not empty) and (order['o_status'] == 'paid' or order['o_status'] == 'payment_process' or order['o_status'] == 'pending_payment') %}
                                            <form action="{{ path('user_ppktreasurer_other_document', {'id': order['o_id']}) }}" method="POST" enctype="multipart/form-data" accept-charset="UTF-8">
                                                <input type="hidden" name="_csrf_token" value="{{ csrf_token(token_id) }}">
                                                <input type="hidden" name="_csrf_token_id" value="{{ token_id }}">
                                                <input type="hidden" name="order_id" value="{{ order['o_id'] }}">
                                                <div class="dc3" style="text-align:center"> 
                                                    <h6>
                                                        Bukti Potong dan Bukti Bayar Pajak
                                                    </h6><br>
                                                    <figure>
                                                        <i class="fa fa-upload" style="font-size: 100px;color: #999;"></i>
                                                    </figure>
                                                    <input type="file" name="withholding_tax_file" id="withholding_tax_file" style="display: none;">
                                                    <button type="button" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn_unggah_other" data-input="withholding_tax_file">
                                                        Unggah
                                                    </button>
                                                    <button type="button" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #198754;cursor: pointer;" class="btn_unggah_success hide">
                                                        <i class="fa fa-check" aria-hidden="true"></i>
                                                    </button>
                                                    <button type="submit" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn_save_other hide">
                                                        Save
                                                    </button>
                                                </div>
                                            </form>
                                        {% elseif (app.user.role == 'ROLE_USER_SELLER' and order['o_taxInvoiceFile'] is empty) and (order['o_status'] == 'paid' or order['o_status'] == 'payment_process' or order['o_status'] == 'pending_payment') and order['o_taxType'] == '59' %}
                                            <form action="{{ path('user_ppktreasurer_other_document', {'id': order['o_id']}) }}" method="POST" enctype="multipart/form-data" accept-charset="UTF-8">
                                                <input type="hidden" name="_csrf_token" value="{{ csrf_token(token_id) }}">
                                                <input type="hidden" name="_csrf_token_id" value="{{ token_id }}">
                                                <input type="hidden" name="order_id" value="{{ order['o_id'] }}">
                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Faktur Pajak
                                                    </h6><br>
                                                    <figure>
                                                        <i class="fa fa-upload" style="font-size: 100px;color: #999;"></i>
                                                    </figure>
                                                    <input type="file" name="faktur_pajak" id="faktur_pajak" style="display: none;">
                                                    <button type="button" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn_unggah_other" data-input="faktur_pajak">
                                                        Unggah
                                                    </button>
                                                    <button type="button" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #198754;cursor: pointer;" class="btn_unggah_success hide">
                                                        <i class="fa fa-check" aria-hidden="true"></i>
                                                    </button>
                                                    <button type="submit" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn_save_other hide">
                                                        Save
                                                    </button>
                                                </div>
                                            </form>
                                        {% endif %}
                                        {% if app.user.role == 'ROLE_USER_SELLER' or app.user.subRole == 'TREASURER' %}
                                            <form action="{{ path('user_ppktreasurer_other_document', {'id': order['o_id']}) }}" method="POST" enctype="multipart/form-data" accept-charset="UTF-8">
                                                <input type="hidden" name="_csrf_token" value="{{ csrf_token(token_id) }}">
                                                <input type="hidden" name="_csrf_token_id" value="{{ token_id }}">
                                                <input type="hidden" name="order_id" value="{{ order['o_id'] }}">
                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Upload Dokumen Lainnya
                                                    </h6><br>
                                                    <figure>
                                                        <i class="fa fa-upload" style="font-size: 100px;color: #999;"></i>
                                                    </figure>
                                                    <input type="file" name="other_document" id="other_document_file" style="display: none;">
                                                    <button type="button" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn_unggah_other" data-input="other_document_file">
                                                        Unggah
                                                    </button>
                                                     
                                                    {# <button type="button" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #198754;cursor: pointer;" class="btn_unggah_success hide">
                                                        <i class="fa fa-check" aria-hidden="true"></i>
                                                    </button> #}
                                                    {# <button type="submit" style="border: 0;font-size: 16px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn_save_other hide">
                                                        Save
                                                    </button> #}
                                                </div>

                                                <div id="popup-other-document" class="popup general" title="other_document">
                                                    <div class="wh100">
                                                        <div class="popup-wrapper">
                                                            <div class="inner">
                                                                    <a href="javascript:void(0);" class="close-btn"
                                                                    onclick="$(this).parents('.popup').fadeOut();"></a>
                                                                    <h3 class="popup-other-document-title">Nama Document Lainnya</h3>
                                                                    <div class="input">
                                                                        <input type="text" name="other_document_name" id="other_document_file_name" placeholder="Nama Dokumen Lainnya" required>
                                                                    </div>
                                                                    <div class="btn-wrapper">
                                                                        <input id="popup-other-document-btn" type="submit" class="sBtn red"
                                                                            value="{{ 'button.submit'|trans }}">
                                                                        <a href="javascript:void(0);" class="gBtn red"
                                                                        onclick="$(this).parents('.popup').fadeOut();">
                                                                            {{ 'button.close'|trans }}
                                                                        </a>
                                                                    </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        {% endif %}

                                        <div id="popup-viewdoc" class="popup general" title="viewdoc-label">
                                                <div class="wh100">
                                                    <div class="popup-wrapper">
                                                         <div class="inner">
                                                            <a href="javascript:void(0);" class="close-btn"
                                                            onclick="$(this).parents('.popup').fadeOut();"></a>
                                                            <div class="row" style="text-align: center;">
                                                                <div class="col-md-12">
                                                                    <iframe id="iframe-viewdoc" frameborder="0" style="width:100%;height:500px;"></iframe>
                                                                    <br>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="btn-wrapper">
                                                                <a href="javascript:void(0);" class="gBtn red"
                                                                onclick="$(this).parents('.popup').fadeOut();">
                                                                    {{ 'button.close'|trans }}
                                                                </a>
                                                            </div>
                                                         </div>
                                                    </div>
                                                </div>
                                        </div>
                                        
                                    </div>

                                    {% if app.user.role == 'ROLE_USER_SELLER' %}
                                        <div class="row" style="margin-top: 30px;">
                                            <div class="dc12">
                                                <h4>DOKUMEN DISBURSEMENT</h4>
                                            </div>

                                            {% if order['d_status'] == 'done' or order['d_status'] == 'processed' %}
                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Rincian Disbursement
                                                    </h6><br>
                                                    <figure>
                                                        <a href="{{ path('user_order_print_disbursement', {'orderId': order['o_id']}) }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>
                                                    <a href="{{ path('user_order_print_disbursement', {'orderId': order['o_id']}) }}">
                                                        <button style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                                    </a>
                                                    <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ path('user_order_print_disbursement', {'orderId': order['o_id']}) }}" data-filename="BuktiPotong">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>
                                            {% endif %}

                                            {% if order['d_status'] == 'done' %}
                                                <div class="dc3" style="text-align:center">
                                                    <h6>
                                                        Bukti Pembayaran Disbursement
                                                    </h6><br>
                                                    <figure>
                                                        <a href="{{ asset(order['d_payment_proof']) }}">
                                                            <i class="fa fa-print" style="font-size: 100px;color: #72afd2;"></i>
                                                        </a>
                                                    </figure>
                                                    <a href="{{ asset(order['d_payment_proof']) }}">
                                                        <button style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #dc3545;cursor: pointer;"><i class="fa fa-eye" aria-hidden="true"></i></button>
                                                    </a>
                                                    <button type="button" style="border: 0;font-size: 18px;padding: 6px 12px;margin-top: 10px;border-radius: 5px;color: #fff;background-color: #72afd2;cursor: pointer;" class="btn-download-document" value="{{ asset(order['d_payment_proof']) }}" data-filename="BuktiPotong">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                </div>
                                            {% endif %}

                                        </div>
                                    {% endif %}
                                </div>

                            <div id="tabPajak" class="tabcontent" style="{{set_display_pajak_tab}}">
                                {% set total_product_price = order['d_totalProductPrice'] %}
                                <form action="{{ path('user_ppktreasurer_save_detail') }}" method="POST">

                                    <div id="popup-payment-ppk" class="popup general" style="display: none;" title="payment-komplain">
                                        <div class="wh100">
                                            <div class="popup-wrapper">
                                                <div class="inner" style="width: 650px;">
                                                    <a href="javascript:void(0);" class="close-btn" onclick="$(this).parents('.popup').fadeOut();"></a>
                                                    <div class="popup-payment-komplain-content">
                                                        <h4>Perhatian</h4>
                                                        <p>Pastikan Metode dan Data Pajak Yang Anda Pilih Sudah Sesuai, Karena Data Yang Sudah Disimpan Tidak Bisa Diubah</p>
                                                        <div class="btn-wrapper">
                                                            <button type="submit" class="sBtn red">
                                                                Simpan
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {% set haveCategoryFreeTax = 0 %}
                                    {% for product in order['o_products'] %}
                                        {% if product['p_category'] in get_parameter('free_tax_for_category') and order['s_pkp'] == 0 %}
                                            {% set haveCategoryFreeTax = 1 %}
                                        {% endif %}
				                    {% endfor %}

                                    <input type="hidden" name="_csrf_token" value="{{ csrf_token(token_id) }}">
                                    <input type="hidden" name="_csrf_token_id" value="{{ token_id }}">
                                    <input type="hidden" name="order_id" value="{{ order['o_id'] }}">
                                    <div class="row">
                                        <div class="dc12">
                                            <h4>Pembayaran</h4>
                                        </div>
                                        <div class="dc12">
                                            <div class="input form-group">
                                                <label for=""><b>Metode Pemotongan Pajak</b></label>
                                                <select id="tax-types" name="tax_types" data-oldval="" data-havecategoryfreetax="{{haveCategoryFreeTax}}" required {% if app.user.subRole != 'TREASURER' or order['o_taxType'] is not empty %} disabled{% endif %}
                                                >
                                                    <option value="">Pilih Metode Pemotongan Pajak</option>
                                                    {% for key, option in get_parameter('tax_payment_types') %}
                                                        {# {% if key == 58 or (haveCategoryFreeTax == false and key == 59) %} #}
                                                            <option value="{{key}}" {{ key == order['o_taxType'] ? 'selected':'' }} data-description="{{option['description']}}">{{option['label']}}</option>
                                                        {# {% endif %} #}
                                                    {% endfor %}
                                                </select>
                                                <br>
                                                <label for="" id="label-keterangan-pembayaran" style="display: none;"><b>Keterangan :</b></label>
                                                <p style="text-align: justify;" id="desc-keterangan-pembayaran"></p>
                                            </div>
                                        </div>
                                        {% set dpp_pph = dpp_ppn_pph + order['o_shippingPrice'] %}
                                        {# {% set ppn_value = (dpp_pph * 11) / (100 + 11) %} #}
                                        {% set total_order = order['o_total'] + order['o_shippingPrice'] %}
                                        {# {% set real_shipping_cost = dpp_pph - (dpp_pph * 11) / (100 + 11)%} #}
                                        <div class="dc12 pph-pmk-58" {{ order['o_taxType'] != '58' ? 'style="display: none;"':'' }}>
                                            <table width="100%">
                                                <tr>
                                                    <td width="50%" style="text-align: right;">
                                                        <b>PPN</b>
                                                    </td>
                                                    <td>:</td>
                                                    {# {{ dump(order['o_total']|round, real_shipping_cost|round) }} #}
                                                    {% set ppn_58 = dpp_pph * (11 / 100) %}
                                                    {# {% set ppn_58 = ppn_value %} #}
                                                    <td width="49%">
                                                        <b>Rp. {{sub_total_ppn_price|round|number_format(2, ',', ',')}}</b>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%" style="text-align: right;">
                                                        <b>PPh (0,5%)</b>
                                                    </td>
                                                    <td>:</td>
                                                    {% set pph_58 =  (sub_total_nego_price + nego_shipping_price) * (0.5 / 100)   %}
                                                    {# {% set pph_58 = (order['o_total'] + real_shipping_cost) * (0.5 / 100) %} #}
                                                    <td width="49%">
                                                        <b>Rp. {{pph_58|round|number_format(2, ',', ',')}}</b>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%" style="text-align: right;">
                                                        <b>TOTAL YANG HARUS DIBAYAR</b>
                                                    </td>
                                                    <td>:</td>
                                                    {% set total_58 = order['o_total'] + order['o_shippingPrice'] %}
                                                    <td width="49%">
                                                        <b>Rp. {{total_58|number_format(2, ',', ',')}}</b>
                                                        {# <b>Rp. {{order_grand_total|number_format(2, ',', ',')}}</b> #}
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="dc10 pph-pmk-59" {{ order['o_taxType'] != '59' ? 'style="display: none;"':'' }}>
                                            
                                            <table width="100%">
                                                <tr>
                                                    <td width="50%">
                                                        <label for="">Tarif Pajak</label>
                                                    </td>
                                                    <td width="50%">
                                                        <label for="">Nominal</label>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <select id="ppn-choose" class="choose_ppn_pph" name="ppn_choose" data-index_primary="ppn" data-index_secondary="pph" {{ order['o_taxType'] is not empty ? 'disabled' : 'readonly' }}>
                                                                {% for key, option in get_parameter('ppn_choose_options') %}
                                                                    <option value="{{key}}" {{ order['o_is_other_ppn'] == true ? (key == 'lainnya' ? 'selected':'') : (order['o_treasurer_ppn'] == key ? 'selected':'') }} >{{option}}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="text" class="form-control" name="ppn" value="0" id="treasurer_nominal_ppn" {{ order['o_taxType'] is not empty ? 'disabled' : 'readonly' }}>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr id="other_ppn_div" style="{{order['o_is_other_ppn'] != true ? 'display:none' : ''}}">
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="text" class="form-control" name="other_ppn_name" id="other_ppn_name" value="{{order['o_is_other_ppn'] == true ? order['o_other_ppn_name'] : ''}}" placeholder="Pajak Lainnya" {{ order['o_taxType'] is not empty ? 'disabled' : '' }}>
                                                        </div>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="text" class="form-control other_ppn_pph_persentase" name="other_ppn_persentase" id="other_ppn_persentase" value="{{order['o_is_other_ppn'] == true ? order['o_treasurer_ppn'] : 0}}" placeholder="Persentase Pajak Lainnya" data-index_primary="ppn" data-index_secondary="pph" {{ order['o_taxType'] is not empty ? 'disabled' : '' }}>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="hidden" value="{{dpp_pph}}" id="dpp_ppn_pph">
                                                            <input type="hidden" value="{{total_order}}" id="total_order">
                                                            <input type="hidden" class="form-control pph-input-treasurer" data-dpp_pph="{{dpp_pph}}" name="pph" value="{{ order['o_treasurer_pph'] is not empty ? order['o_treasurer_pph']:'' }}">
                                                            <select id="pph-choose" class="choose_ppn_pph" name="pph_choose" data-index_primary="pph" data-index_secondary="ppn" {{ order['o_taxType'] is not empty ? 'disabled' : '' }}>
                                                                <option value="">Pilih PPH</option>
                                                                {% for key, option in get_parameter('pph_choose_options') %}
                                                                    <option value="{{key}}" {{ order['o_isOtherPph'] == true ? (key == 'lainnya' ? 'selected':'') : (order['o_treasurer_pph'] == key ? 'selected':'') }} >{{option}}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="text" class="form-control" id="treasurer_nominal_pph" value="0" {{ order['o_taxType'] is not empty ? 'disabled' : 'readonly' }}>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr id="other_pph_div" style="{{order['o_isOtherPph'] != true ? 'display:none' : ''}}">
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="text" class="form-control" name="other_pph_name" id="other_pph_name" value="{{order['o_isOtherPph'] == true ? order['o_otherPphName'] : ''}}" placeholder="Pajak Lainnya" {{ order['o_taxType'] is not empty ? 'disabled' : '' }}>
                                                        </div>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="text" class="form-control other_ppn_pph_persentase" name="other_pph_persentase" id="other_pph_persentase" value="{{order['o_isOtherPph'] == true ? order['o_treasurer_pph'] : 0}}" placeholder="Persentase Pajak Lainnya" data-index_primary="pph" data-index_secondary="ppn" {{ order['o_taxType'] is not empty ? 'disabled' : '' }}>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%" style="text-align: right;">
                                                        <b>TOTAL PAJAK</b>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="text" class="form-control" id="total_pajak" value="" {{ order['o_taxType'] is not empty ? 'disabled' : 'readonly' }}>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%" style="text-align: right;">
                                                        <b>TOTAL YANG HARUS DIBAYAR</b>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="input form-group">
                                                            <input type="text" class="form-control" id="total_bayar" value="" {{ order['o_taxType'] is not empty ? 'disabled' : 'readonly' }}>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="dc12 pph-pmk-59" {{ order['o_taxType'] != '59' ? 'style="display: none;"':'' }}>
                                            <div class="input form-group"> 
                                                <input type="hidden" id="treasurer_pph_nominal" name="pph_nominal" value="{{ order['o_treasurerPphNominal'] is not empty ? order['o_treasurerPphNominal']:'' }}">
                                                <input type="hidden" id="treasurer_ppn_nominal" name="ppn_nominal" value="{{ order['o_treasurer_ppn_nominal'] is not empty ? order['o_treasurer_ppn_nominal']:'' }}">
                                            </div>
                                        </div>
                                        {% if app.user.subRole == 'TREASURER' and  order['o_status'] == 'pending_payment' %}
                                            {% if all_rating == true %}
                                                {% if order['o_taxType'] is empty %}
                                                    <div class="dc12">
                                                        <button class="btn-search-ppk" id="btn-simpan-pajak" type="button">Simpan</button>
                                                    </div>
                                                {% endif %}
                                            {% else %}
                                                <div class="dc12">
                                                    <h6 style="color: #ffda6a;">Produk Belum di Rating Oleh PPK</h6>
                                                </div>
                                            {% endif %}
                                            {% if order['o_taxType'] is not empty %}
                                                {% set bolehTrx = true %}
                                                {% if haveBpd is not null and haveBpd.getStatus == 'PENDING' %}
                                                    {% if haveBpd.getExpiredIn|date('Y-m-d H:i:s', 'Asia/Makassar') >= 'now'|date('Y-m-d H:i:s', 'Asia/Makassar') %}
                                                        {% set bolehTrx = false %}
                                                    {% endif %}
                                                {% endif %}
                                                {% if bolehTrx %}
                                                        {# {{ dump(order|json_encode(constant('JSON_PRETTY_PRINT'))) }} #}
                                                    <div style="display: flex; flex-direction: column;" class="dc12">
                                                        <a href="#" type="button"><button style="width: 100%;" id="pop-up-si-aku" class="btn-ppk-red-border" type="button">Sinkronisasi SI-AKU</button></a>
                                                    </div>
                                                {% else %}
                                                    {# <div class="badges yellow2">
                                                        <span>
                                                            <i class="fas fa-clock"></i>
                                                            Mohon untuk selesaikan pembayaran pada Kartu Kredit Indonesia
                                                        </span>
                                                    </div>
                                                    <div class="dc12" style="margin-top: 15px">
                                                        <a href="{{ path('user_order_cc_payment', {'id': order['o_sharedId']}) }}" type="button"><button class="btn-ppk-red-border" type="button">Kartu Kredit Indonesia</button></a>
                                                    </div> #}
                                                {% endif %}
                                                
                                            {% endif %}
                                        {% endif %}
                                        {% if order['o_status'] == 'paid' and order['bn_requestId'] is not empty %}
                                            <div class="badges green">
                                                <span>
                                                    <i class="fas fa-check-circle"></i>
                                                    Telah dibayar menggunakan VA BNI dengan Request ID : {{order['bn_requestId']}}
                                                </span>
                                            </div>
                                        {% endif %}

                                        {% if order['o_status'] == 'paid' and haveBpd is not null and haveBpd.getStatus == 'SUCCESS' %}
                                            <div class="badges green">
                                                <span>
                                                    <i class="fas fa-clock"></i>
                                                    Telah dibayar menggunakan Kartu Kredit Indonesia 
                                                </span>
                                            </div>
                                            {# <div class="dc12">
                                                <a href="" class="btn-ppk-red-border" type="button">Refund BPD</a>
                                            </div> #}
                                        {% endif %}
                                        
                                        {# <div class="dc12"> #}
                                            {# {% if order['o_taxInvoiceFile'] is empty and order['o_isRequestFakturPajak'] != true %}
                                                <a target="_blank" class="btn-ppk-red-border pph-pmk-59" id="btn-request-faktur" data-id="{{order['o_id']}}" type="button">Request Faktur Pajak</a>
                                            {% endif %} #}
                                            {# <a href="https://kfcku.com/" target="_blank" class="btn-ppk-red-border pph-pmk-59" {{ order['o_taxType'] != '59' ? 'style="display: none;"':'' }} type="button">E - Billing</a> #}
                                        {# </div> #}

                                    

                                </form>
                                    </div>
                            </div>

                            <div id="tabKomplain" class="tabcontent" style="display: none;">
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Komplain</h4>
                                    </div>
                                    <div class="dc12" style="overflow-x: scroll;">
                                        {% if order['o_complaint']|length > 0 %}
                                            <table class="table_spk">
                                                <thead>
                                                    <tr>
                                                        <th>{{ 'label.complaint'|trans }}</th>
                                                        <th width="10%">Status</th>
                                                        <th width="15%">{{ 'label.updated'|trans }}</th>
                                                        {# <th width="10%">Action</th> #}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                {% for complaint in order['o_complaint'] %}
                                                    {% if complaint['oc_id'] is not empty %}
                                                        <tr>
                                                            <td>{{ complaint['oc_description'] }}</td>
                                                            <td>
                                                                {% if complaint['oc_isResolved'] %}
                                                                    {{'label.resolved'|trans}}
                                                                {% else %}
                                                                    {{'label.not_resolved'|trans}}
                                                                {% endif %}
                                                            </td>
                                                            <td>{{ complaint['oc_createdAt']|date('d-m-Y H:i:s') }}</td>
                                                            {# <td>
                                                                {% if complaint['oc_isResolved'] == false %}
                                                                    <a type="button" href="{{ path('admin_order_resolved', {'complaint_id': complaint['oc_id']}) }}" class="btn btn-info btn-sm">{{'label.resolved'|trans}}</a>
                                                                {% endif %}
                                                            </td> #}
                                                        </tr>
                                                    {% else %}
                                                        <tr>
                                                            <td colspan="3" class="text-center">Tidak Ada Komplain</td>
                                                        </tr>
                                                    {% endif %}
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div id="tabLog" class="tabcontent" style="display: none;">
                                <div class="row">
                                    <div class="dc12">
                                        <h4>Data Log</h4>
                                    </div>
                                    <div class="dc12" style="overflow-x: scroll;">
                                        {% if order_change_log|length > 0 %}
                                            <table class="table_spk">
                                                <thead>
                                                <tr>
                                                    <th width="15%">{{ 'label.username'|trans }}</th>
                                                    <th width="15%">{{ 'label.email'|trans }}</th>
                                                    <th width="10%">{{ 'label.role'|trans }}</th>
                                                    <th width="25%">{{ 'label.previous'|trans }}</th>
                                                    <th width="25%">{{ 'label.changes'|trans }}</th>
                                                    <th width="10%">{{ 'label.updated'|trans }}</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for log in order_change_log %}
                                                    <tr>
                                                        <td>{{ log['user']['username']|default }}</td>
                                                        <td>{{ log['user']['email']|default }}</td>
                                                        <td>{{ log['user']['role']|default }} {{log['user']['subRole'] is defined and log['user']['subRole'] is not empty ? '(' ~ log['user']['subRole'] ~ ')' : ''}}</td>

                                                        {% if log['changes']|length > 0 %}
                                                            {% set previous = '' %}
                                                            {% set new = '' %}
                                                            {% for key, item in log['changes'] %}
                                                                {% set prev_value = log['previousValues'][key] %}
                                                                {% set next_value = item %}
                                                                {% set label_log = key %}
                                                                {% if key == 'status' %}
                                                                    {% set prev_status = get_parameter('order_statuses')[log['previousValues'][key]]|trans %}
                                                                    {% set next_status = get_parameter('order_statuses')[item]|trans %}
                                                                    {% set prev_value = prev_status %}
                                                                    {% set next_value = next_status %}
                                                                    {% set label_log = get_parameter('label_log_order')[key]['label'] %}
                                                                {% else %}
                                                                    {% if get_parameter('label_log_order')[key] is defined %}
                                                                        {% set label_log = get_parameter('label_log_order')[key]['label'] %}
                                                                        {% if get_parameter('label_log_order')[key]['value'] is defined %}
                                                                            {% set label_array = get_parameter('label_log_order')[key]['value'] %}
                                                                            {% if prev_value is not empty %}
                                                                                {% set prev_value = label_array[prev_value|trans] %}
                                                                            {% endif %}
                                                                            {% if next_value %}
                                                                                {% set next_value = label_array[next_value|trans] %}
                                                                            {% endif %}
                                                                            
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endif %}
                                                                {% set previous = previous ~ label_log ~ ' => ' ~ prev_value ?? '' ~ '\n'%}
                                                                {% set new = new ~ label_log ~ ' => ' ~ next_value ~ '\n' %}
                                                            {% endfor %}
                                                            <td><pre>{{ previous }}</pre></td>
                                                            <td><pre>{{ new }}</pre></td>
                                                        {% else %}
                                                            <td></td>
                                                            <td></td>
                                                        {% endif %}

                                                        <td>{{ log['createdAt']|date('d-m-Y H:i:s') }}</td>
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                           <div id="tabShipping" class="tabcontent" style="{{set_display_shipping_tab}}">    
                                <div class="row">  
                                    <div class="dc12">
                                        <h4>Form Surat Perintah Pengiriman Parsial</h4>
                                    </div>
                                    <div class="dc12">
                                        <div class="dc12 tc12 center" style="margin: 0 auto;" >
                                            <form action="{{ path('user_ppktreasurer_shipping_partial_proccess') }}" id="form-spp" enctype="multipart/form-data" method="POST">
                                                <div id="parsial-form">
                                                    {# <h4>Form Surat Perintah Pengiriman</h4> #}
                                                    <div class="pr-card">
                                                            {% set product_list = data_order['o_products'] %}
                                                            {% set product_qty = data_order['o_products'][0]['op_quantity'] %}
                                                            {% set product_price = data_order['o_products'][0]['op_price'] %}
                                                            {% set product_total = product_qty * product_price %}
                                                            {% set date_order = order_date_day %}
                                                            {% set info = data_order %}
                                                        <table style="margin-bottom: 25px;">
                                                            <tr>
                                                                <td>Nomor</td>
                                                                <td>:</td>
                                                                <td>{{ data_order['o_invoice'] }}-{{ order_partials|length + 1 }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td>Tanggal</td>
                                                                <td>:</td>
                                                                <td>{{ 'now'|date('Y-m-d') }} </td>
                                                            </tr>
                                                        </table>
                                                        {{ csrf_field(token_id) }}
                                                        <input type="hidden" name="order_id" value="{{ data_order['o_id'] }}">
                                                        <table class="table_spk">
                                                            <thead>
                                                                <tr>
                                                                    <th>No.</th>
                                                                    <th>Uraian Barang / Jasa</th>
                                                                    <th>Jumlah (qty) Tersedia</th>
                                                                    <th>Jumlah (qty) Akan Dikirim</th>
                                                                    <th>Satuan</th>
                                                                    <th>Harga Satuan</th>
                                                                    <th>Total Harga</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% set initial_with_shipping = true %}
                                                                {% set total_ppn = 0 %}
                                                                {% set dpp_ppn_pph = 0 %}
                                                                {% set order_shipping_price = 0 %}
                                                                {% set sub_total_ppn_price = 0 %}
                                                                {% set order_grand_total = 0 %}
                                                                {% set sub_total_nego_price = 0 %}
                                                                {% set totalAvailableQty = 0 %}

                                                                {% for index, product in data_order['o_products'] %}
                                                                    {% set order_shipping_price = product['op_priceShippingNegotiation'] %}
                                                                    {% set ppn_product = product['op_withTax'] == true ? product['op_taxNominal'] : 0 %}
                                                                    {% set total_ppn = total_ppn + (ppn_product) %}
                                                                    {% set dpp_ppn_pph = dpp_ppn_pph + (product['op_withTax'] == true ? product['op_totalPrice'] : 0) %}
                                                                    {% for product_nego in data_order['o_negotiatedProducts'] %}
                                                                        {% if (product_nego['p_id'] == product['p_id']) and (product_nego['on_batch'] == nego_batch) %}
                                                                            {% set totalAvailableQty = totalAvailableQty + product['op_quantityToSend'] %}
                                                                            {% set nego_price = (product_nego['on_negotiatedPrice'] * product['op_quantity']) %}
                                                                            {% set sub_total_nego_price = sub_total_nego_price + (product_nego['on_negotiatedPrice'] * product['op_quantity']) %}
                                                                            
                                                                            {% if initial_with_shipping == true %}
                                                                                {% set sub_total_ppn_price = sub_total_ppn_price + ((product_nego['on_negotiatedPrice'] * (product_nego['on_taxValue']/100)) * product['op_quantity']) + product_nego['on_taxNominalShipping'] %}
                                                                            {% else %}
                                                                                {% set sub_total_ppn_price = sub_total_ppn_price + ((product_nego['on_negotiatedPrice'] * (product_nego['on_taxValue']/100)) * product['op_quantity']) %}
                                                                            {% endif %}
                                                                            {% set initial_with_shipping = false %}
                                                                            {% set nego_shipping = product_nego['on_negotiatedShippingPrice'] %}
                                                                            <tr>
                                                                                <td>{{ index+1 }}</td>
                                                                                <td>{{ product['p_name'] }}</td>
                                                                                <td style="text-align: center;">
                                                                                    <input type="hidden" name="order_products[{{ index }}][quantity]" value="{{ product['op_quantity'] }}">
                                                                                    {{ product['op_quantityToSend'] }}
                                                                                </td>
                                                                                <td>
                                                                                    <input type="hidden" name="order_products[{{ index }}][id]" value="{{ product['op_id'] }}">
                                                                                    <input type="hidden" name="order_products[{{ index }}][tax_nominal]" value="{{ product['op_taxNominal'] }}">
                                                                                    <input 
                                                                                        type="text" 
                                                                                        {{ product['op_quantityToSend'] == 0 ? 'disabled' : '' }} 
                                                                                        class="form-control qty-to-send" style="width: 100%; padding: 5px; border-radius: 5px; border: 1px solid #ccc;" 
                                                                                        name="order_products[{{ index }}][quantity_to_send]" 
                                                                                        min="0"
                                                                                        max="{{ product['op_quantityToSend'] == 0 ? 0 : product['op_quantityToSend'] }}" 
                                                                                        data-stock="{{ product['op_quantityToSend'] }}"
                                                                                        value="0"
                                                                                    >
                                                                                </td>
                                                                                <td>{{ product['p_unit']|default('Unit') }}</td>
                                                                                <td style="text-align: right;">
                                                                                        <input type="hidden" name="order_products[{{ index }}][negotiatedPrice]" value="{{ product_nego['on_negotiatedPrice'] }}">
                                                                                        <input type="hidden" name="order_products[{{ index }}][sub_ppn]" value="{{ sub_total_ppn_price }}">
                                                                                        <input type="hidden" name="order_products[{{ index }}][tax_value]" value="{{ product_nego['on_taxValue'] }}">
                                                                                        <input type="hidden" name="order_products[{{ index }}][negotiatedShippingPrice]" value="{{ product_nego['on_negotiatedShippingPrice'] }}">
                                                                                        <input type="hidden" name="order_products[{{ index }}][sub_total]" value="0">
                                                                                    {{ product_nego['on_negotiatedPrice']|number_format }}
                                                                                </td>
                                                                                <td style="text-align: right;" class="sub-total-harga">0</td>
                                                                            </tr>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                {% endfor %}
                                                                <tr>
                                                                    <td colspan="6" style="text-align: right;">Biaya Kirim (Rp)</td>
                                                                    <td style="text-align: right;" id="shipping-price">0</td>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="6" style="text-align: right;">Total PPN (Rp)</td>
                                                                    <td style="text-align: right;" id="total-ppn">0</td>
                                                                </tr>
                                                                <tr>
                                                                    {% set order_grand_total = sub_total_nego_price + nego_shipping + sub_total_ppn_price %}
                                                                    <td colspan="6" style="text-align: right;">Total (Rp)</td>
                                                                    <td style="text-align: right;" id="total-harga">0</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>

                                                        <br>
                                                        <hr>
                                                        <br>
                                                        <h4>Catatan Pengiriman</h4>
                                                        <table>
                                                            <tr>
                                                                <td>Nama Merchant</td>
                                                                <td>:</td>
                                                                <td>{{ data_order['s_name'] }}</td>
                                                            </tr>
                                                                <tr>
                                                                <td>Alamat Merchant</td>
                                                                <td>:</td>
                                                                <td>{{ data_order['s_address'] }}</td>
                                                            </tr>
                                                                <tr>
                                                                <td>Diharapkan Tanggal</td>
                                                                <td>:</td>
                                                                <td>
                                                                    <input {{ totalAvailableQty == 0 ? 'disabled' : '' }} type="date" class="form-control date-parsial" style="width: 100%; padding: 5px; border-radius: 5px; border: 1px solid #ccc;" id="sendAt" name="sendAt" required>
                                                                </td>
                                                                <td>Catatan</td>
                                                                <td>:</td>
                                                                <td>
                                                                    <input name="note" {{ totalAvailableQty == 0 ? 'disabled' : '' }} style="width: 100%; padding: 5px; border-radius: 5px; border: 1px solid #ccc;" type="textarea" class="form-control" >
                                                                </td>
                                                            </tr>
                                                                <tr>
                                                                <td>Alamat Pengiriman</td>
                                                                <td>:</td>
                                                                <td>{{ info['o_address'] }}</td>
                                                                <td>Catatan</td>
                                                                <td>:</td>
                                                                <td>
                                                                    <input name="address_notes" {{ totalAvailableQty == 0 ? 'disabled' : '' }} style="width: 100%; padding: 5px; border-radius: 5px; border: 1px solid #ccc;" type="textarea" class="form-control" >
                                                                </td>
                                                            </tr>
                                                                <tr>
                                                                <td>Pic Penerima</td>
                                                                <td>:</td>
                                                                <td>{{ info['o_unit_name'] }}</td>
                                                                <td>Catatan</td>
                                                                <td>:</td>
                                                                <td>
                                                                    <input name="unit_note" {{ totalAvailableQty == 0 ? 'disabled' : '' }} style="width: 100%; padding: 5px; border-radius: 5px; border: 1px solid #ccc;" type="textarea" class="form-control" >
                                                                </td>
                                                            </tr>
                                                                <tr>
                                                                <td>Telp Penerima</td>
                                                                <td>:</td>
                                                                <td>{{ info['o_unit_telp'] }}</td>
                                                            </tr>
                                                        </table>

                                                        <div style="display: flex; justify-content: end">
                                                            {% if is_granted('order.order_spp' , 'permission') and totalAvailableQty > 0 %}
                                                                <button type="button" class="btn-send-red" id="popup-approve-pengiriman-btn" style="padding: 12px">Ajukan Perintah Pengiriman</button>
                                                            {% endif %}
                                                        </div>
                                                        <br>

                                                        <hr>
                                                        <h4>Riwayat Surat Perintah Pengiriman</h4>
                                                        <div style="padding: 10px; overflow-x: scroll; width: 100%;">
                                                            <table class="styled-table" >
                                                                <thead>
                                                                    <tr>
                                                                        <th>No</th>
                                                                        <th>Nomor SPP</th>
                                                                        <th>Tanggal</th>
                                                                        <th>Uraian Barang/Jasa</th>
                                                                        <th>Jumlah (Qty) Tersisa</th>
                                                                        <th>Jumlah (Qty) Dikirim</th>
                                                                        <th>Satuan</th>
                                                                        <th>Harga Satuan (Rp)</th>
                                                                        <th>Total Harga (Rp)</th>
                                                                        <th>Biaya Kirim (Rp)</th>
                                                                        <th>Total PPN (Rp)</th>
                                                                        <th>Total (Rp)</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>

                                                                    {% set totalKirim = 0 %}
                                                                    {% set numbering = 0 %}
                                                                    {% set total_product_price = 0 %}
                                                                    {% set grand_total_ppn = 0 %}
                                                                    {% set grand_total_biaya_kirim = 0 %}
                                                                    {% set grand_total_price_product = 0 %}
                                                                    {% set grandTotalHarga = 0 %}
                                                                    {%  if order_partials|length == 0 %}
                                                                        <tr class="no-data">
                                                                            <td colspan="13" style="text-align: center;">Tidak ada data</td>
                                                                        </tr>
                                                                    {% else %}
                                                                        
                                                                        {% for key, item in order_partials %}

                                                                            {% set initial_with_shipping = true %}
                                                                            {% set sub_total_nego_price = 0 %}
                                                                            {% set sub_total_ppn_price = 0 %}
                                                                            {% set subTotalWithPpn = 0 %}

                                                                            {% for index, product in item['o_products'] %}
                                                                                {% set order_shipping_price = product['op_priceShippingNegotiation'] %}
                                                                                {% set ppn_product = product['op_withTax'] == true ? product['op_taxNominal'] : 0 %}
                                                                                {% set total_ppn = total_ppn + (ppn_product) %}
                                                                                {% set dpp_ppn_pph = dpp_ppn_pph + (product['op_withTax'] == true ? product['op_totalPrice'] : 0) %}
                                                                                {% for product_nego in item['o_negotiatedProducts'] %}
                                                                                    {% if (product_nego['p_id'] == product['p_id']) and (product_nego['on_batch'] == nego_batch) %}
                                                                                        {% set numbering = numbering + 1 %}

                                                                                        {% set nego_price = (product_nego['on_negotiatedPrice'] * product['op_quantity']) %}
                                                                                        {% set sub_total_nego_price = sub_total_nego_price + (product_nego['on_negotiatedPrice'] * product['op_quantity']) %}

                                                                                        {% if initial_with_shipping == true %}
                                                                                            {% set sub_total_ppn_price = sub_total_ppn_price + ((product_nego['on_negotiatedPrice'] * (product_nego['on_taxValue']/100)) * product['op_quantity']) + product_nego['on_taxNominalShipping'] %}
                                                                                        {% else %}
                                                                                            {% set sub_total_ppn_price = sub_total_ppn_price + ((product_nego['on_negotiatedPrice'] * (product_nego['on_taxValue']/100)) * product['op_quantity']) %}
                                                                                        {% endif %}
                                                                                        {% set initial_with_shipping = false %}
                                                                                        {% set nego_shipping = product_nego['on_negotiatedShippingPrice'] %}
                                                                                        {% set qtyTersedia = (product['op_quantityToSend'] == 0 ? 0 : product['op_quantityToSend']) - product['op_quantity'] %}
                                                                                        {% set totalKirim = totalKirim + product['op_quantity'] %}
                                                                                        {% set subTotalWithPpn = (sub_total_nego_price + sub_total_ppn_price + product_nego['on_negotiatedShippingPrice']) %}
                                                                                        {% set grandTotalHarga = grandTotalHarga + subTotalWithPpn %}
                                                                                        <tr>
                                                                                            <td>{{ numbering }}</td>
                                                                                            <td>{{ item['o_invoice'] }}</td>
                                                                                            <td>{{ item['o_createdAt']|date('d F Y') }}</td>
                                                                                            <td>{{ product['p_name'] }}</td>
                                                                                            <td>{{ qtyTersedia|number_format }}</td>
                                                                                            <td>{{ product['op_quantity'] }}</td>
                                                                                            <td>{{ product['p_unit']|default('Unit') }}</td>
                                                                                            <td>{{ product_nego['on_negotiatedPrice']|number_format }}</td>
                                                                                            <td>
                                                                                                {% set total_price_product = (product['op_quantity'] * product_nego['on_negotiatedPrice']) %}
                                                                                                {{ total_price_product|number_format }}
                                                                                                {% set grand_total_price_product = grand_total_price_product + total_price_product %}

                                                                                            </td>
                                                                                            <td>
                                                                                                {% set biaya_kirim = (product_nego['on_negotiatedShippingPrice'] /  item['o_products']|length) %}
                                                                                                {{ biaya_kirim|number_format }}
                                                                                                {% set grand_total_biaya_kirim = grand_total_biaya_kirim + biaya_kirim %}
                                                                                            </td>
                                                                                            <td>
                                                                                                {% set initial_with_shipping = true %}
                                                                                                {% set ppn_product = 0 %}
                                                                                                {% if initial_with_shipping == true %}
                                                                                                {% set ppn_product = ((product_nego['on_negotiatedPrice'] * (product_nego['on_taxValue']/100)) * product['op_quantity']) + (biaya_kirim  * (11/100)) %}
                                                                                                {{ ppn_product|round|number_format }}
                                                                                                {% else %}
                                                                                                {% set ppn_product = ((product_nego['on_negotiatedPrice'] * (product_nego['on_taxValue']/100)) * product['op_quantity']) %}
                                                                                                {{ ppn_product|round|number_format }}
                                                                                                {% endif %}
                                                                                                {% set initial_with_shipping = false %}
                                                                                                {% set grand_total_ppn = grand_total_ppn + ppn_product %}
                                                                                            </td>
                                                                                            <td>
                                                                                                {% set total_product = (total_price_product + ppn_product) %}
                                                                                                {% set total_product_price = total_product_price + total_product + biaya_kirim %}
                                                                                                {{ total_product|round|number_format }}
                                                                                            </td>
                                                                                        </tr>
                                                                                    {% endif %}
                                                                                {% endfor %}
                                                                            {% endfor %}
                                                                        {% endfor %}
                                                                    {% endif %}
                                                                </tbody>
                                                                <tfoot>
                                                                    <tr>
                                                                        <td colspan="5"><strong>TOTAL</strong></td>
                                                                        <td><strong>{{ totalKirim|number_format }}</strong></td>
                                                                        <td></td>
                                                                        <td></td>
                                                                        <td><strong>{{ grand_total_price_product|number_format }}</strong></td>
                                                                        <td><strong>{{ grand_total_biaya_kirim|number_format }}</strong></td>
                                                                        <td><strong>{{ grand_total_ppn|number_format }}</strong></td>
                                                                        <td><strong>{{ total_product_price|number_format }}</strong></td>
                                                                    </tr>
                                                                </tfoot>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            
                                            </form>
                                        </div>
                                                   
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    {# pop up ajukan pengiriman #}
    <div id="popup-approve-pengiriman" class="popup general" title="approve_pengiriman">
        <div class="wh100">
            <div class="popup-wrapper">
                <div class="inner">
                        <a href="javascript:void(0);" class="close-btn" onclick="$(this).parents('.popup').fadeOut();"></a>
                        <h3>Konfirmasi</h3>
                        <div style="width:100%; height:600px;">
                            <iframe id="iframe-viewdocspp" width="100%" height="600" frameborder="0"></iframe>
                        </div>
                        <p>Apakah anda yakin ingin menyetujui pengiriman?</p>
                        <div style="display: flex; align-items: center; justify-content: center; ">
                            <div class="btn-wrapper" style="margin-top: 0; margin-right: 15px;">
                                <input id="approve-pengiriman-btn" type="submit" class="sBtn red"
                                    value="Setuju Pengiriman">
                            </div>
                            <a href="javascript:void(0);" class="gBtn red"
                            onclick="$(this).parents('.popup').fadeOut();">
                                {{ 'button.close'|trans }}
                            </a>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div id="popup-approve-full-pengiriman" class="popup general" title="approve_full_pengiriman">
        <div class="wh100">
            <div class="popup-wrapper">
                <div class="inner">
                        <a href="javascript:void(0);" class="close-btn" onclick="$(this).parents('.popup').fadeOut();"></a>
                        <h3>Konfirmasi</h3>
                        <p>Apakah anda yakin ingin menyetujui pengiriman?</p>
                        <div style="display: flex; align-items: center; justify-content: center; ">

                            <form action="{{ path('user_ppktreasurer_shipping_partial_proccess') }}" id="form-full-send" enctype="multipart/form-data" method="POST">
                                {{ csrf_field(token_id) }}
                                <input type="hidden" name="order_id" value="{{ data_order['o_id'] }}">
                                <input type="hidden" name="type_send" value="full"></input>
                            </form>
                            <div class="btn-wrapper" style="margin-top: 0; margin-right: 15px;">
                                <input id="approve-full-pengiriman-btn" typ e="submit" class="sBtn red"
                                    value="Setuju Pengiriman">
                            </div>
                            <a href="javascript:void(0);" class="gBtn red"
                            onclick="$(this).parents('.popup').fadeOut();">
                                {{ 'button.close'|trans }}
                            </a>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <template id="product-review-form-template">
            <div class="input rating">
                <a href="javascript:void(0);" id="star-1" class="star rate-star" data-value="1"><i
                        class="fas fa-star"></i></a>
                <a href="javascript:void(0);" id="star-2" class="star rate-star" data-value="2"><i
                        class="fas fa-star"></i></a>
                <a href="javascript:void(0);" id="star-3" class="star rate-star" data-value="3"><i
                        class="fas fa-star"></i></a>
                <a href="javascript:void(0);" id="star-4" class="star rate-star" data-value="4"><i
                        class="fas fa-star"></i></a>
                <a href="javascript:void(0);" id="star-5" class="star rate-star" data-value="5"><i
                        class="fas fa-star"></i></a>
                <p id="rating-error" class="error"></p>
            </div>
            <div class="input">
                <textarea id="buyer-rate-review" class="no-resize" title=""
                          placeholder="{{ 'label.write_review_alt'|trans }}"
                          style="border: 1px solid black;"></textarea>
                <p id="review-error" class="error"></p>
            </div>
            <div class="input">
                <div class="pfl-pic">
                    <a href="javascript:void(0);" class="mask product-review-attachment">
                        <span class="fas fa-plus-circle product-review-attachment"></span>
                    </a>
                    <div class="pra-tools" style="display: none;">
                        <a href="javascript:void(0);" class="fas fa-trash-alt delete-pra"></a>
                    </div>
                    <img id="product-review-attachment-src" class="product-review-attachment"
                         src="{{ asset('dist/img/user.jpg') }}" alt="">
                </div>
                <p id="attachment-error" class="error"></p>
            </div>
            <div>
                <input id="buyer-rate-rating" type="hidden">
                <input id="buyer-rate-attachment" type="hidden">
                <input id="buyer-rate-pid" type="hidden" value="**pid**">
                <input id="buyer-rate-oid" type="hidden" value="**oid**">
            </div>
        </template>

        <div><input id="dz-pra-uploader" type="file" style="display: none;"></div>

        {% if order['oc_id'] is defined and order['oc_id'] is empty %}
            <div id="popup-order-complain" class="popup general" title="complain">
                <div class="wh100">
                    <div class="popup-wrapper">
                        <div class="inner">
                            <form id="buyer-order-complain-form"
                                  action="{{ path('user_order_complaint', {'id': order['o_id']}) }}" method="POST"
                                  accept-charset="UTF-8">
                                <a href="javascript:void(0);" class="close-btn"
                                   onclick="$(this).parents('.popup').fadeOut();"></a>
                                <h3 class="popup-order-complain-title">{{ 'label.order_complain'|trans }}</h3>
                                <div class="input">
                                    <textarea id="buyer-order-complain-description" name="description" class="no-resize"
                                              title="" placeholder="{{ 'label.message'|trans }}"
                                              style="border: 1px solid black;"></textarea>
                                    <p id="buyer-order-complain-description-error" class="error"></p>
                                </div>
                                <div class="btn-wrapper">
                                    {{ csrf_field('b2g_order_complain') }}
                                    <input id="popup-order-complain-btn" type="submit" class="sBtn red"
                                           value="{{ 'button.submit'|trans }}">
                                    <a href="javascript:void(0);" class="gBtn red"
                                       onclick="$(this).parents('.popup').fadeOut();">
                                        {{ 'button.close'|trans }}
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

    <div id="popup-approve-ppk" class="popup general" title="approve_ppk">
        <div class="wh100">
            <div class="popup-wrapper">
                <div class="inner">
                        <a href="javascript:void(0);" class="close-btn" onclick="$(this).parents('.popup').fadeOut();"></a>

                        <h3>Konfirmasi Pemesanan</h3>
                        <iframe src="{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'spk_non_ttd'}) }}" frameborder="0" style="width:100%;height:500px;"></iframe>
                        
                        <div style="display: flex; align-items: center; justify-content: center; ">
                            <button id="approve-ppk-direct-btn" style="margin-right: 15px;" type="submit" class="gBtn grey">
                                Pengiriman Langsung
                            </button>
                            <button id="approve-ppk-parsial-btn" type="submit" class="gBtn grey">
                                Pengiriman Parsial
                            </button>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div id="pop" class="popup general" title="cancel-order-ppk">
        <div class="wh100">
            <div class="popup-wrapper">
                <div class="inner">
                    <h3>Pengiriman Langsung</h3>
                    <a href="javascript:void(0);" class="close-btn" onclick="$(this).parents('.popup').fadeOut();"></a>
                    <p>Apakah anda yakin ingin membuat pengiriman langsung?</p>
                    <div class="row">
                        <div class="btn-wrapper">
                            <input id="confirm-direct-order-id" type="hidden" value="{{ data_order['o_id'] }}">
                            <input id="confirm-direct-order-state" type="hidden" value="direct">
                            <button id="confirm-direct-btn" type="submit" class="sBtn red">
                                Ya, Saya Yakin
                            </button>
                            <a href="javascript:void(0);" onclick="$(this).parents('.popup').fadeOut();" class="gBtn grey">
                                Kembali
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="popup-confirmation-direct-order-ppk" class="popup general" title="cancel-order-ppk">
        <div class="wh100">
            <div class="popup-wrapper">
                <div class="inner">
                    <h3>Pengiriman Langsung</h3>
                    <a href="javascript:void(0);" class="close-btn" onclick="$(this).parents('.popup').fadeOut();"></a>
                    <p>Apakah anda yakin ingin membuat pengiriman langsung?</p>
                    <div class="row">
                        <div class="btn-wrapper">
                            <input id="confirm-direct-order-id" type="hidden" value="{{ data_order['o_id'] }}">
                            <input id="confirm-direct-order-state" type="hidden" value="direct">
                            <button id="confirm-direct-btn" type="submit" class="sBtn red">
                                Ya, Saya Yakin
                            </button>
                            <a href="javascript:void(0);" onclick="$(this).parents('.popup').fadeOut();" class="gBtn grey">
                                Kembali
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="si-aku-popup" class="popup general" title="cancel-order-ppk">
        <div class="wh100">
            <div class="popup-wrapper">
                <div class="inner">
                    <h3>Sinkronkan SI-AKU</h3>
                    <a href="javascript:void(0);" class="close-btn" onclick="$(this).parents('.popup').fadeOut();"></a>
                    <p>Apakah anda yakin?</p>
                    <div class="row">
                        <div class="btn-wrapper">
                            <input id="confirm-parsial-order-id" type="hidden" value="{{ data_order['o_id'] }}">
                            <input id="confirm-parsial-order-state" type="hidden" value="parsial">
                            <button type="button" class="sBtn red">
                                Ya, Saya Yakin
                            </button>
                            <a href="javascript:void(0);" onclick="$(this).parents('.popup').fadeOut();" class="gBtn grey">
                                Kembali
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="popup-approve-pengiriman-merchant" class="popup general" title="approve_pengiriman_merchant">
        <div class="wh100">
            <div class="popup-wrapper">
                <div class="inner">
                        <a href="javascript:void(0);" class="close-btn" onclick="$(this).parents('.popup').fadeOut();"></a>
                        <h3>Konfirmasi</h3>
                        {% if order['o_master_id'] is not empty and order['o_type_order'] == 'partial'  %}
                            <div style="width:100%; height:600px;">
                                <iframe id="iframe-viewdoc" width="100%" height="600" src="{{ path('user_order_print', {'id': order['o_id'], 'type': 'surat-pengiriman-parsial'}) }}" frameborder="0"></iframe>
                            </div>
                        {% endif %}
                        <p>Apakah anda yakin ingin menyetujui pengiriman?</p>
                        <div style="display: flex; align-items: center; justify-content: center; ">
                            <div class="btn-wrapper" style="margin-top: 0; margin-right: 15px;">
                                <input id="approve-pengiriman-merchant-btn" type="submit" class="sBtn red"
                                    value="Setuju Pengiriman">
                            </div>
                            <a href="javascript:void(0);" class="gBtn red"
                            onclick="$(this).parents('.popup').fadeOut();">
                                {{ 'button.close'|trans }}
                            </a>
                        </div>
                </div>
            </div>
        </div>
    </div>
   
    <script>
        // Fungsi untuk mengompresi gambar dan mengonversi ke base64
        async function compressImageToBase64Quality(url, maxWidth, maxHeight,  usePNG = false, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.src = url;

                img.onload = () => {
                    // Tentukan ukuran gambar baru
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > maxWidth) {
                            height = Math.round((height * maxWidth) / width);
                            width = maxWidth;
                        }
                    } else {
                        if (height > maxHeight) {
                            width = Math.round((width * maxHeight) / height);
                            height = maxHeight;
                        }
                    }

                    // Buat canvas untuk menggambar gambar yang dikompresi
                    const canvas = document.createElement('canvas');
                    canvas.style.backgroundColor = 'transparent';
                    canvas.width = width;
                    canvas.height = height;

                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, width, height);

                    // Konversi canvas ke base64
                    let base64String = ""
                    if(usePNG){
                        base64String = canvas.toDataURL('image/png', quality);
                    }else {
                        base64String = canvas.toDataURL('image/jpeg', quality);
                    }
                    resolve(base64String);
                };

                img.onerror = () => resolve(null);
            });
        }

        // Fungsi untuk mengonversi URL gambar menjadi base64
        function convertImageToBase64(url) {
            return fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.onerror = () => reject("Error occurred while reading file");
                        reader.readAsDataURL(blob);
                    });
                });
        }
        $(function () {
            let shippedFiles = {{ shippedFiles|json_encode|raw }};
            let ppStamp = {{ pp_stamp|json_encode|raw }};
            let ppSignature = {{ pp_signature|json_encode|raw }};
            let ppkStamp = {{ ppk_stamp|json_encode|raw }};
            let ppkSignature = {{ ppk_signature|json_encode|raw }};
            let treasurerStamp = {{ treasurer_stamp|json_encode|raw }};
            let treasurerSignature = {{ treasurer_signature|json_encode|raw }};
            let sellerStamp = {{ seller_stamp|json_encode|raw }};
            let sellerSignature = {{ seller_signature|json_encode|raw }};

            $(document).ready(function() {
                var ppn = $('#ppn-choose').val() != 'lainnya' && $('#ppn-choose').val() != '' ? $('#ppn-choose').val() : $('#other_ppn_persentase').val();
                var pph = $('#pph-choose').val() != 'lainnya' && $('#pph-choose').val() != '' ? $('#pph-choose').val() : $('#other_pph_persentase').val();
                hitungTotalBayar('ppn', 'pph', ppn, $('#ppn-choose').val());
                hitungTotalBayar('pph', 'ppn', pph, $('#pph-choose').val());
                $('#desc-keterangan-pembayaran').html($('#tax-types option:selected').data('description'))
            });

            $(document).on('click', '.btn-viewdoc', function(e){
                var path =  $(this).data('path');
                $('#iframe-viewdoc').attr('src', path)
                $('#popup-viewdoc').show();
            });

            $(document).on('click', '.btn_unggah_other', function(e) {
                var input = $(this).data('input');
                $("#"+input).trigger('click');
                $("#"+input).change(function () {
                    $('.btn_unggah_other').addClass('hide');
                    $('.btn_unggah_success').removeClass('hide');
                    $('.btn_save_other').removeClass('hide');
                    if (input == 'other_document_file') {
                        $('#popup-other-document').show();
                    }
                });
            });

            $(document).on('click', '#btn-simpan-pajak', function(e) {
                $('#popup-payment-ppk').show();
                var option = $('#tax-types').val();
                console.log(option);
                if (option == 59) {
                    $('#btn_pajak_cc').show();
                } else {
                    $('#btn_pajak_cc').hide();
                }
            });

            $(document).on('click', '.btn-download-document', async function(e) {
                let buttonElem = e.currentTarget

                // set loading for targeted button
                setDownloading(buttonElem, true)
                
                // set disabled for all other button
                let otherButtons = document.getElementsByClassName('btn-download-document')
                setButtonDisabled(otherButtons, true)

                const data_type = $(this).data('type')
                // URL gambar
                const imageUrls = shippedFiles


                let context = {}
                context['type'] = data_type

                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''

                if(data_type == "bast"){
                    const base64ProductsImages = await Promise.all(imageUrls.map(url => compressImageToBase64Quality(`${BASE_URL}/sftp/file/uploads/${url}`, 800, 600)));
                    context['products'] = base64ProductsImages
                    context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                    context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''
                }else if (data_type == "spk"){
                    context['pp_stamp'] = ppStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppStamp}`,400, 400, true) : ''
                    context['pp_signature'] = ppSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppSignature}`,400, 400, true) : ''
                }else if (data_type == "performa_invoice"){
                    // performa invoice hanya perlu ttd & cap merchant; skip
                }else if (data_type == "receipt_ls"){
                    // perlu ppk & bendahara
                    context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                    context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''
                    context['treasurer_stamp'] = treasurerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${treasurerStamp}`,400, 400, true) : ''
                    context['treasurer_signature'] = treasurerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${treasurerSignature}`,400, 400, true) : ''

                }else if (data_type == "spk_new_ls"){
                    context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                    context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                    context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                    context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''

                }else if (data_type == "bapd_ls"){
                    const base64ProductsImages = await Promise.all(imageUrls.map(url => compressImageToBase64Quality(`${BASE_URL}/sftp/file/uploads/${url}`, 800, 600)));
                    context['products'] = base64ProductsImages
                    context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                    context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                    context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                    context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''


                }else if (data_type == "bast_ls"){
                    const base64ProductsImages = await Promise.all(imageUrls.map(url => compressImageToBase64Quality(`${BASE_URL}/sftp/file/uploads/${url}`, 800, 600)));
                    context['products'] = base64ProductsImages
                    context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                    context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                    context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                    context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''

                }
                                
                $(this).addClass('terdownload');                
                
                downloadWithLoading($(this).val(), $(this).attr('data-filename'), buttonElem, context);              
            });

            $(document).on('click', '#btn-request-faktur', function(e) {
                $.ajax({
                    url: `${BASE_URL}/user/ppk-treasurer/req-faktur/${$(this).data('id')}`,
                    type: 'GET',
                    success: function (result) {
                        if (result.request) {
                            showGeneralPopup(result.response);
                            $('#btn-request-faktur').addClass('hide');
                        }
                    },
                    error: function (result) {
                    }
                })
            });

            $(document).on('change', '.choose_ppn_pph', function(e) {
                var option = e.target.value;
                var primary = $(this).data('index_primary');
                var secondary = $(this).data('index_secondary');
                hitungTotalBayar(primary,secondary,option,0);
            });

            $(document).on('keyup', '.other_ppn_pph_persentase', function(e) {
                var other = $(this).val() != '' ? parseFloat($(this).val()):0;
                var primary = $(this).data('index_primary');
                var secondary = $(this).data('index_secondary');
                hitungTotalBayar(primary,secondary,other,'lainnya');
            });

            $(document).on('change', '#tax-types', function(e) {
                var oldVal = $('#tax-types').attr('data-oldval');
                $('#tax-types').attr('data-oldval', e.target.value);
                if (e.target.value != "") {
                    if ($('#tax-types').data('havecategoryfreetax') == 1 && e.target.value == 59) {
                        $('#tax-types').prop('selectedIndex', $('#tax-types option[value="'+oldVal+'"]').index()).selectric('refresh');
                        $('#tax-types').attr('data-oldval', oldVal);
                        showGeneralPopup('Mohon perhatian anda akan melakukan pembelian produk ber PPN pada penyedia non-PKP');
                        return false;
                    }
                    var option = $('#tax-types option[value="'+e.target.value+'"]');
                    $('#label-keterangan-pembayaran').show();
                    $('#desc-keterangan-pembayaran').html(option.data('description'))
                    if (e.target.value == 59) {
                        $('.pph-pmk-59').show();
                        $('.pph-pmk-58').hide();
                        $('#btn_pajak_cc').show();
                    } else {
                        $('.pph-pmk-59').hide();
                        $('.pph-pmk-58').show();
                        $('#btn_pajak_cc').hide();
                    }
                } else {
                    $('#label-keterangan-pembayaran').hide();
                    $('#desc-keterangan-pembayaran').html('')
                    $('.pph-pmk-59').hide();
                    $('.pph-pmk-58').hide();
                }
            });

            $(document).on('click', '.publish-review', function(e) {
                e.preventDefault();

                var id = $(this).attr('id');
                var content = $('#'+id+'-template').html();

                productReviewPublishFormShow(content);
            });

        });
        

        function hitungTotalBayar(primary, secondary, option, other) {
            if (option == 'lainnya' || other == 'lainnya') {
                $('#other_'+primary+'_div').show();
            } else {
                $('#other_'+primary+'_div').hide();
            }
            var persentase = option != "" && option != "lainnya" ? parseFloat(option):0;

            var dpp_pph           = $('#dpp_ppn_pph').val(); 
            var total_order       = $('#total_order').val(); 
            var secondary_nominal = $('#treasurer_'+secondary+'_nominal').val();
            var primary_nominal   = persentase != 0 ? Math.round(dpp_pph * (persentase/100)) : 0;
            var total_pajak       = Math.round(parseFloat(primary_nominal) + parseFloat(secondary_nominal));
            var total_bayar       = parseFloat(total_order);
            if (total_bayar > 2220000) {
                total_bayar  = Math.round(total_bayar - parseFloat(primary_nominal) - parseFloat(secondary_nominal))
            }
            $('#treasurer_'+primary+'_nominal').val(primary_nominal)
            $('#treasurer_nominal_'+primary).val(setToRp(primary_nominal));
            $('#total_pajak').val(setToRp(total_pajak));
            $('#total_bayar').val(setToRp(total_bayar));
            
        }

        function setToRp(number) {
            return number.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,  "$1,");// "$1."
        }

        function download(url, filename) {
            fetch(url).then(function (t) {
                return t.blob().then((b) => {
                    var a = document.createElement("a");
                    a.href = URL.createObjectURL(b);
                    a.setAttribute("download", filename);
                    a.click();
                });
            });
        }

        function setDownloading(buttonElem, isLoading) {
            let originalIcon = buttonElem.getElementsByClassName('fa-download')[0]
            let spinner = buttonElem.getElementsByClassName('spinner')[0]

            if(isLoading){
                buttonElem.setAttribute('disabled', true)
                originalIcon.classList.add('d-none')
                spinner.classList.remove('d-none')
            }else{
                buttonElem.removeAttribute('disabled')
                originalIcon.classList.remove('d-none')
                spinner.classList.add('d-none')
            }
        }

        function setButtonDisabled(buttons, isDisabled){
            if (isDisabled) {
                for(let button of buttons){
                    button.setAttribute('disabled', true)
                }
            }else{
                for(let button of buttons){
                    button.removeAttribute('disabled')
                }
            }
        }

        function downloadWithLoading(url, filename, buttonElem, context){
            setDownloading(buttonElem, true)
            fetch(url, {
                headers: {
                    'Content-Type': 'application/json'
                }, 
                method: 'POST', 
                body: JSON.stringify(context)
            }).then(function (t) {
                return t.blob().then((b) => {
                    var a = document.createElement("a");
                    a.href = URL.createObjectURL(b);
                    a.setAttribute("download", filename);
                    a.click();
                    setDownloading(buttonElem, false)

                    let otherButtons = document.getElementsByClassName('btn-download-document')
                    setButtonDisabled(otherButtons, false)
                });
            });
        }
    </script>

    <script type='text/javascript' src="https://cdn.jsdelivr.net/npm/inputmask@5.0.8/dist/jquery.inputmask.min.js"></script>
    <script>
        var umkm_category = parseFloat($("#store_umkm_category_percentage").val());
        {% if user_type == 'seller' %}
        $(function () {
            $('.cbox').colorbox();

            if ($('.pr-cbox').length) {
                $(document).on('click', '.pr-cbox', function (e) {
                    e.preventDefault();

                    $.colorbox({
                        href: $(this).attr('href'),
                        maxWidth: '90%',
                        initialWidth: '200px',
                        initialHeight: '200px',
                        speed: 700,
                        overlayClose: false,
                        rel: $(this).attr('rel')
                    });
                });
            }
        });
        {% elseif user_type == 'buyer' %}
        $('#approve-negotiation-budget-ceiling').inputmask('integer', {
            radixPoint: ',',
            groupSeparator: '.',
            digits: 0,
            autoGroup: true,
            prefix: '',
            rightAlign: false,
        });
        {% endif %}


        function formatIdCurrency(x) {
            return "Rp. " + x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function sumArray(total, num) {
            return total + num;
        }

        function getPPN(total_price, ppn = TAX_VALUE) {
            // return parseInt(total_price - total_price / (ppn + 1));
            return parseFloat(total_price - total_price / (ppn + 1)).toFixed(1);
        }

        function clean_value(masked_value, trig) {
            var value_numeric = masked_value.replace(/[^0-9]/g, '');
            return value_numeric.split(trig).join("");
        }

        function addPPN(total_price, ppn = TAX_VALUE, shipping = false) {
            if (shipping) {
                return parseFloat(total_price * (ppn + 1)).toFixed(1)
            }

            var check_pkp = '1';
            return check_pkp === '1' ? parseFloat(total_price * (ppn + 1)).toFixed(1) : parseFloat(total_price).toFixed(1)
        }

        var ppn_products = $('.ppn-price-one');
        var totalPpnProducts = $('#total-ppn-price');
        var subTotalPriceNego = $('#sub-total-price');
        var totalPriceNego = $('#total-price');
        var negotiatedPrice = $('.negotiated-price');
        var totalPriceOfGoods = $('#total-price-of-goods');
        var shipingCost = $('#shipping-cost');
        var shipingCostView = $('#shipping-cost-view');
        var shippingNegoCost = $('.nego-shipping');

        var sellerToNegotiate = $('#seller-to-negotiate');
        var sellerToApprove = $('#seller-to-approve');
        var buyerToNegotiate = $('#buyer-to-negotiate');
        var buyerToApprove = $('#buyer-to-approve');
        var negotiatedPriceOne = $('.negotiated-price-one');
        var negotiatedTime = $('.negotiated-time');

        function calculateTotalNegotiate(event) {
            hideOrShowNegotiationButton();
            calculateTotalPPN();
            setTimeout(function () {
                calculateTotalPriceNego();
            }, 300);
        }

        function calculateShipping() {
            setTimeout(function () {
                calculateTotalPriceNego();
            }, 100);
            setTimeout(function () {
                calculateTotalPPN();
            }, 300);
            setTimeout(function () {
                hideOrShowNegotiationButton();
            }, 500);
        }

        function calculateTotalPPN() {
            if (ppn_products.length && totalPpnProducts.length) {
                var totalProductPrice = 0;
                var total_ppn = 0;

                for (var i = 0; i < ppn_products.length; i++) {
                    var productId = ppn_products[i].name.split('_')[1];
                    var productSelector = document.getElementsByName('price_one_' + productId)[0];
                    var qtySelector = document.getElementsByName('quantity_' + productId)[0]

                    var quantity = parseInt(qtySelector.value);
                    var price = parseInt(productSelector.value);

                    totalProductPrice += (price * quantity);

                    if (productSelector.getAttribute('data-free-tax') !== "1") {
                        total_ppn += (price * quantity) * TAX_VALUE;
                    }
                }
                var ppn_shipping = getPPN(document.getElementById('shipping-cost').value);

                total_ppn += parseFloat(ppn_shipping);

                total_ppn = parseFloat(total_ppn).toFixed(1).replace(/\.0+$/, '');

                // var check_pkp = $('#is-pkp-trx').val() || '0';

                // if (check_pkp === '0') {
                //     total_ppn = parseFloat('0').toFixed(1).replace(/\.0+$/, '');
                // }
                document.getElementById('total-ppn-price').value = total_ppn;

                setTimeout(function () {
                    var ppnPrice = document.getElementById('total-ppn-price').value;
                    document.getElementById('total-price').value = parseFloat($('#total-price-of-goods').val()) +
                        parseFloat(ppnPrice) + parseFloat($('#shipping-cost-view').val());
                }, 300);
            }
        }

        function getBasePrice(price, ppn = TAX_VALUE) {
            return Math.round(price / (ppn + 1));
        }

        function calculateTotalPriceNego() {
            // debugger
            if (negotiatedPrice.length && totalPriceOfGoods.length && subTotalPriceNego.length && shipingCost.length && totalPpnProducts.length) {
                var total_price_nego = 0;
                var sub_total_without_tax = 0;
                var shipping_input = parseInt(document.getElementById('shipping-cost-view').value);
                
                /**
                 * @TODO add ppn to shipping price
                 */

                var check_pkp = '1';
                var shipping_price = parseInt(check_pkp === '1' ? parseFloat(shipping_input + (shipping_input * (11/100))).toFixed(1) : parseFloat(shipping_input).toFixed(1))
                var total_ppn = document.getElementById('total-ppn-price').value;
                for (var i = 0; i < negotiatedPrice.length; i++) {
                    var productId = negotiatedPrice[i].name.split('_')[1];
                    var productSelector = document.getElementsByName('price_one_' + productId)[0];
                    var quantity = parseInt(document.getElementsByName('quantity_' + productId)[0].value);
                    var price = parseInt(productSelector.value);
                    var ppn = (price * quantity) * umkm_category;
                    var freeTax = false;

                    if (productSelector.getAttribute('data-free-tax') === "1") {
                        ppn = 0;
                        freeTax = true;
                    }

                    var totalPrice = (price * quantity) + ppn;

                    var check_pkp = $('#is-pkp-trx').val() || '0';

                    sub_total_without_tax += (price * quantity)

                    total_price_nego = total_price_nego + parseFloat(totalPrice)

                    // if (check_pkp === '0') {
                    //     ppn = 0;
                    //     totalPrice = price * quantity;
                    // }
                    console.log(price,'fri');
                    document.getElementsByName('ppn_' + productId)[0].value = ppn;
                    document.getElementsByName('price_' + productId)[0].value = freeTax ? (price * quantity) : totalPrice;
                    document.getElementsByName('price_show_' + productId)[0].value = price * quantity;
                }

                var sub_total_with_shipping = sub_total_without_tax + shipping_input;

                document.getElementById('shipping-cost').value = shipping_price
                document.getElementById('total-price-of-goods').value = sub_total_without_tax;
                document.getElementById('sub-total-price').value = sub_total_with_shipping
                document.getElementById('total-price').value = sub_total_with_shipping;

                setTimeout(function () {
                    document.getElementById('total-price').value = parseInt($('#total-price-of-goods').val()) + parseFloat(total_ppn) + parseFloat($('#shipping-cost-view').val());
                }, 300);
            }
        }

        if (sellerToNegotiate.length) {
            console.log('SELLER NEGOTIATED');
            sellerToNegotiate.hide();
        }

        if (buyerToNegotiate.length) {
            console.log('BUYER NEGOTIATED');
            buyerToNegotiate.hide();
        }

        // Untuk case ketika tidak mengubah form negosiasi (masih sama dgn data sblmnya).
        // maka tombol negosiasi ulang di hide (mengatasi human error).
        function hideOrShowNegotiationButton() {
            calculateTotalPriceNego()

            var array1 = negotiatedPriceOne.map(function () {
                return $(this).attr('data-old-price');
            }).get();

            var array2 = negotiatedPriceOne.map(function () {
                return $(this).val();
            }).get();

            var array3 = negotiatedTime.map(function () {
                return $(this).attr('data-old-time');
            }).get();

            var array4 = negotiatedTime.map(function () {
                return $(this).val();
            }).get();

            var array5 = shippingNegoCost.map(function () {
                return parseFloat($(this).attr('data-old-shipping'));
            }).get();

            var array6 = shippingNegoCost.map(function () {
                return parseFloat($(this).val());
            }).get();

            console.log('ARRAY 1: ', array1);
            console.log('ARRAY 2: ', array2);
            console.log('ARRAY 3: ', array3);
            console.log('ARRAY 4: ', array4);
            console.log('ARRAY 5: ', array5);
            console.log('ARRAY 6: ', array6);
            console.log('ARRAY SAME: ', (JSON.stringify(array1) === JSON.stringify(array2)) && (JSON.stringify(array3) === JSON.stringify(array4)) && (JSON.stringify(array5) === JSON.stringify(array6)));

            if ((JSON.stringify(array1) === JSON.stringify(array2)) && (JSON.stringify(array3) === JSON.stringify(array4)) && (JSON.stringify(array5) === JSON.stringify(array6))) {
                if (sellerToNegotiate.length) {
                    sellerToNegotiate.hide();
                }

                if (buyerToNegotiate.length) {
                    buyerToNegotiate.hide();
                }

                if (sellerToApprove.length) {
                    sellerToApprove.show();
                }

                if (buyerToApprove.length) {
                    buyerToApprove.show();
                }
            } else {
                if (sellerToNegotiate.length) {
                    sellerToNegotiate.show();
                }

                if (buyerToNegotiate.length) {
                    buyerToNegotiate.show();
                }

                if (sellerToApprove.length) {
                    sellerToApprove.hide();
                }

                if (buyerToApprove.length) {
                    buyerToApprove.hide();
                }
            }
        }
    </script>

    <script>
        $('#btn-process-order').on('click', function () {

            const orderId = parseInt($('.order-id').attr('data-id'))

            const submit = {
                origin: sellerOrigin,
            };

            elementLoading.show()

            if (orderId > 0) {
                $.post(`${BASE_URL}/user/order/${orderId}/process`, $.extend(true, submit, TOKEN), function (response) {
                    if (response.status) {
                        window.location.reload();
                    } else {
                        console.log(response)
                        elementLoading.hide()
                        showGeneralPopup('Terjadi kesalahan pada sistem')
                    }
                })
            } else {
                showGeneralPopup(MSG_ERROR_500);
            }
        })

        $('.seller-pickup-order').on('click', function () {
            elementLoading.show()

            const orderId = parseInt($('.order-id').data('id'));

            if (orderId > 0) {
                $.get(`${BASE_URL}/user/order/pickup-order/${orderId}`)
                    .done(function (res) {
                        elementLoading.hide();
                        if (res.data.order_id) {
                            window.location.href = `${BASE_URL}/user/order/gosend/${res.data.order_id}`
                        } else {
                            console.log(res)
                            showGeneralPopup(MSG_ERROR_500)
                        }
                    })
            }
        })

        $('#popup-approve-ppk-btn').click(function(e) {
            e.preventDefault();

            $('#popup-approve-ppk').show();
        });

        $(`#approve-ppk-direct-btn`).click(function(e) {
            e.preventDefault();

            $('#popup-confirmation-direct-order-ppk').show();
        });
        $(`#approve-ppk-parsial-btn`).click(function(e) {
            e.preventDefault();

            $('#popup-confirmation-parsial-order-ppk').show();
        });

        $(`#confirm-direct-btn`).click(function(e) {
            e.preventDefault();

            $.ajax({
                url: "{{ path('order_confirmation_ppk') }}",
                method: 'POST',
                data: $.extend(true, {
                    'order_id': {{ data_order['o_id'] }},
                    'shipping_type' : 'direct'
                }, TOKEN),
                dataType: 'json',
                beforeSend: function() {
                    showLoading();
                },
                success: function(response) {
                    hideLoading();

                    if (response.status) {
                        window.location.reload();
                    } else {
                        showGeneralPopup(response.message);
                    }
                }
            });
        });
        $(`#confirm-parsial-btn`).click(function(e) {
            e.preventDefault();

            $.ajax({
                url: "{{ path('order_confirmation_ppk') }}",
                method: 'POST',
                data: $.extend(true, {
                    'order_id': {{ data_order['o_id'] }},
                    'shipping_type' : 'parsial'
                }, TOKEN),
                dataType: 'json',
                beforeSend: function() {
                    showLoading();
                },
                success: function(response) {
                    hideLoading();

                    if (response.status) {
                        window.location.reload()
                    } else {
                        showGeneralPopup(response.message);
                    }
                }
            });
        });

        function getFormSuratPerintahPengiriman() {
            const orderProducts = $("#form-spp input[name^='order_products']")
            const form = $("#form-spp input")

            let formData = {
                order_products: [],
            };

            let isValid = true;
            form.map((key, input) => {
                let inputName = $(input).attr("name"); // Ambil atribut name
                let inputValue = $(input).val(); // Ambil nilai input
                // console.log(inputName, inputValue)
                // Parsing name agar bisa disimpan sebagai objek JavaScript
                let namePattern = inputName.match(/order_products\[(\d+)\]\[(\w+)\]/);
                if (!namePattern && !['_csrf_token_id', '_csrf_token'].includes(inputName)) {
                    formData[inputName] = inputValue
                } else if (namePattern) {
                    let index = namePattern[1]; // Ambil indeks dalam array
                    let key = namePattern[2]; // Ambil key (negotiatedPrice, dll.)

                    if (!formData.order_products[index]) {
                        formData.order_products[index] = {}; // Buat objek untuk indeks tersebut
                    }
                    formData.order_products[index][key] = inputValue; // Simpan nilai input
                
                    if (key === "quantity_to_send") {
                        const maxStock = parseInt($(input).data("stock"));
                        const qty = parseInt(inputValue);

                        if (qty > maxStock) {
                            showGeneralPopup("Jumlah pengiriman melebihi jumlah stock pesanan yang ada.");
                            $(input).val(maxStock);
                            isValid = false;
                        } else if(qty < 0) {
                            showGeneralPopup("Jumlah pengiriman tidak boleh kurang dari 0.");
                            $(input).val(0);
                            isValid = false;
                        }
                    }

                }    
            });
    
            if (!isValid) {
                return false;
            }

            console.log(formData)
            return formData;
        }

        $('#popup-approve-pengiriman-btn').click(function(e) {
            e.preventDefault();

            let formData = getFormSuratPerintahPengiriman();

            let shippingPrice = 0;
            let totalQtyToSend = 0;
            let taxNominal = 0;
            let totalQty = 0;
            formData.order_products = formData.order_products.map((product) => {
                let quantity_to_send = parseInt(product.quantity_to_send) ? parseInt(product.quantity_to_send) : 0;
                shippingPrice = parseInt(product.negotiatedShippingPrice);
                taxNominal =  (parseFloat(product.tax_value) / 100);
                let sub_ppn = (product.negotiatedPrice * quantity_to_send) * taxNominal;

                let subTotal = quantity_to_send * parseFloat(product.negotiatedPrice);

                totalQtyToSend += quantity_to_send;
                totalQty += parseInt(product.quantity);
                
                return {
                    ...product,
                    sub_ppn: sub_ppn,
                    sub_total: subTotal ? subTotal : 0,
                }
            });

            const dateParsial = $('.date-parsial').val();
            if(totalQtyToSend == 0){
                showGeneralPopup("Jumlah pengiriman tidak boleh kosong.");
                return false;
            } else if(dateParsial == '') {
                showGeneralPopup("Tanggal pengiriman tidak boleh kosong.");
                return false;
            }


            formData.shipping_price = Math.round((totalQtyToSend / totalQty ) * shippingPrice);
            formData.tax_nominal_shipping = Math.round(formData.shipping_price * TAX_VALUE);

            const dataIframePdf = btoa(JSON.stringify(formData));

            $('#iframe-viewdocspp').attr('src' , "{{ path('user_order_print', {'id': data_order['o_id'], 'type': 'surat-pengiriman-parsial'}) }}" + "?data_preview=" + dataIframePdf);

            $('#popup-approve-pengiriman').show();
        });
        $('#approve-pengiriman-btn').click(function(e) {
            e.preventDefault();

            $('#popup-approve-pengiriman').hide();

            $('#form-spp')[0].submit();
            
        });

        $('#popup-approve-full-pengiriman-btn').click(function(e) {
            e.preventDefault();

            $('#popup-approve-full-pengiriman').show();
        });

        $('#approve-full-pengiriman-btn').click(function(e) {
            e.preventDefault();

            $('#popup-approve-full-pengiriman-btn').hide();

            $('#form-full-send').submit();

            
        });

        function appendToOrderProductsInput(index, propertyName , value) {
            const form = $("#form-spp input")
            let inputElement = $(`#form-spp input[name='order_products[${index}][${propertyName}]']`)
            inputElement = inputElement.length == 1 ? inputElement[0] : null;

            if(inputElement) {
                $(inputElement).val(value);
            }

            return inputElement;
            
        }

        $(document).on('input' , '.qty-to-send' , function() {
            this.value = this.value.replace(/[^0-9]/g, '');

            let qtyToSend = $(this).val();
            let nameAttr = $(this).attr('name');
            const match = nameAttr.match(/order_products\[(\d+)\]/);
            const index = match[1];

            qtyToSend = qtyToSend ? parseInt(qtyToSend) : 0;


            let formData = getFormSuratPerintahPengiriman();

            //hitung Sub total
            let shippingPrice = 0;
            let taxNominal = 0;
            let totalQtyToSend = 0;
            let totalQty = 0;
            let totalPpn = 0;
            let totalSubHarga= 0;


            formData.order_products = formData.order_products
            .map((product, key ) => {
                let quantity_to_send = parseInt(product.quantity_to_send) ? parseInt(product.quantity_to_send) : 0;
                
                //check qty yang dikirim tidak melebihi stok barang
                if(qtyToSend > product.quantity && key == index) {
                    qtyToSend = product.quantity;
                    $(this).val(product.quantity);
                    quantity_to_send = product.quantity;
                }

                taxNominal = (parseFloat(product.tax_value) / 100);

                shippingPrice = parseInt(product.negotiatedShippingPrice);
                let sub_ppn = (product.negotiatedPrice * quantity_to_send) * taxNominal;

                

                totalQtyToSend += quantity_to_send;
                totalQty += parseInt(product.quantity);
                totalPpn += parseInt(sub_ppn);

                let subTotal = quantity_to_send * parseFloat(product.negotiatedPrice);
                totalSubHarga += subTotal;
                return {
                    ...product,
                    sub_ppn: sub_ppn,
                    sub_total: subTotal ? subTotal : 0,
                }
            })

            const shippingPricePartial = Math.round((totalQtyToSend / totalQty ) * shippingPrice);

            totalPpn = Math.round(totalPpn + (shippingPricePartial * TAX_VALUE));

            const totalHarga = totalSubHarga + shippingPricePartial + totalPpn;
            const classSubTotalHarga = $("#form-spp .sub-total-harga")

            classSubTotalHarga.map(function(key, item) {
                $(this).html(formData.order_products[key].sub_total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."));
            })

            if(totalQtyToSend > 0) {
                $('#form-spp #total-ppn').html(totalPpn.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."));
                $('#form-spp #shipping-price').html(shippingPricePartial.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."));
                $('#form-spp #total-harga').html(totalHarga.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))
            } else {
                $('#form-spp #total-ppn').html('Rp. 0');
                $('#form-spp #shipping-price').html('Rp. 0');
                $('#form-spp #total-harga').html('Rp. 0')
            }
        })

        function formatRupiah(angka) {
            angka = Math.round(angka);
            return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        $(document).on('change' , 'input[name=type_send]' , function() {
            const parsialForm = $('#parsial-form');
            const fullForm = $('#full-form');
            const typeSend = $(this).val();

            if(typeSend == 'full') {
                fullForm.attr('style' , '');
                parsialForm.attr('style' , 'display: none');
            }else {
                fullForm.attr('style' , 'display: none');
                parsialForm.attr('style' , '');
            }
        })
    

        $(document).on('click', '#pop-up-si-aku', function() {
            // Show the pop-up for SI-AKU synchronization
            $('#si-aku-popup').fadeIn();
        });
    </script>
{% endblock %}