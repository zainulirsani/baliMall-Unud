{% extends '@__main__/admin/base/layouts/default.html.twig' %}

{% set nego_batch = 1 %}
{% set nego_is_approve = false %}
{% set nego_on_merchant_approve = false %}
{% set nego_on_customer_approve = false %}
{% if form_data['o_negotiatedProducts']|length > 0 %}
    {% for temp_nego_data in form_data['o_negotiatedProducts'] %}
        {% set nego_batch = temp_nego_data['on_batch'] %}
		{% set nego_is_approve = temp_nego_data['on_isApproved'] %}
		{% set nego_on_merchant_approve = temp_nego_data['on_merchantApproval'] %}
		{% set nego_on_buyer_approve = temp_nego_data['on_customerApproval'] %}
    {% endfor %}
{% endif %}

{% set trans_parameter = {'%invoice%': form_data['o_invoice']} %}
{% set page_header = page_title|trans(trans_parameter) %}
{% set index_route = 'admin_' ~ page_section ~ '_index' %}
{% set edit_route = 'admin_' ~ page_section ~ '_edit' %}
{% set roleParam = app.request.query.get('role') %}
{% set tax_value = form_data['o_products'][0]['op_taxValue'] %}
{% if form_data['o_isB2gTransaction'] %}
	{% if form_data['o_negotiationStatus'] == 'finish' or form_data['o_status'] == 'processed' or nego_is_approve == true %}
		{% set grand_total = form_data['o_total'] + form_data['o_shippingPrice'] %}
	{% else %}
        {% set set_ppn = form_data['s_pkp'] == 0 ? 0 : generate_tax(form_data['o_total'], tax_value) %}
		{% set grand_total = form_data['o_total'] + form_data['o_shippingPrice'] + set_ppn %}
{#        {% set grand_total = form_data['o_total'] + form_data['o_shippingPrice'] %}#}

{#        {% for product in form_data['o_products'] %}#}
{#            {% set grand_total = grand_total + product['op_taxNominal'] %}#}
{#        {% endfor %}#}
	{% endif %}
{% else %}
	{% set grand_total = form_data['o_total'] + form_data['o_shippingPrice'] %}

    {% for product in form_data['o_products'] %}
        {% set grand_total = grand_total + product['op_taxNominal'] %}
    {% endfor %}
{% endif %}

{% set amount_with_voucher = grand_total %}
{% set order_vouchers_list = order_vouchers(form_data['o_sharedId']) %}
{% set order_vouchers_lists = order_vouchers(form_data['o_sharedId'], 'no') %}
{% set negotiation_products = [] %}
{% if form_data['o_isB2gTransaction'] %}
	{% if form_data['o_negotiationStatus'] == 'finish' or form_data['o_status'] == 'processed' or nego_is_approve == true %}
		{% set order_total = form_data['o_total'] %}
	{% else %}
        {% set set_ppn = form_data['s_pkp'] == 0 ? 0 : generate_tax(form_data['o_total'], tax_value) %}
		{% set order_total = form_data['o_total'] + set_ppn %}
{#		{% set order_total = form_data['o_total'] %}#}

{#        {% for product in form_data['o_products'] %}#}
{#            {% set order_total = order_total + product['op_taxNominal'] %}#}
{#        {% endfor %}#}
	{% endif %}
{% else %}
	{% set order_total = form_data['o_total'] %}

    {% for product in form_data['o_products'] %}
        {% set order_total = order_total + product['op_taxNominal'] %}
    {% endfor %}
{% endif %}

{% set order_shipping = form_data['o_shippingPrice'] %}
{% set voucher_value = 0 %}
{% set ov_lists = [] %}

{% if order_vouchers_list|length > 0 %}
	{% set v_lists = [] %}
    {% set temp_voucher_shared = 0 %}
	{% for voucher_list in order_vouchers_lists %}
		{% if voucher_list['v_code'] not in v_lists %}
			{% set amount_with_voucher = amount_with_voucher - voucher_list['v_amount'] %}
			{% set v_lists = v_lists|merge([voucher_list['v_code']]) %}
            {% set temp_voucher_shared = temp_voucher_shared + voucher_list['v_amount'] %}
		{% endif %}

        {% if voucher_list['vul_orderId'] not in ov_lists %}
            {% set ov_lists = ov_lists|merge([voucher_list['vul_orderId']]) %}
        {% endif %}
	{% endfor %}

    {% if ov_lists|length > 1 %}
        {% set voucher_value = (temp_voucher_shared / ov_lists|length)|round(0, 'floor') %}
    {% else %}
        {% set voucher_value = temp_voucher_shared %}
    {% endif %}
{% endif %}

{% set status_list = get_parameter('order_statuses') %}
{% set negotiationLastApprovedBy = form_data['o_negotiatedProducts']|last %}

{% for product_nego in form_data['o_negotiatedProducts'] %}
	{% for key, product in form_data['o_products'] %}
		{% if product_nego['on_productId'] == product['p_id'] %}
			{% set product = product|merge({
                'on_price': product_nego['on_negotiatedPrice'],
                'on_batch': product_nego['on_batch'],
                'on_taxNominalPrice': product_nego['on_taxNominalPrice'],
                'on_taxNominalShipping': product_nego['on_taxNominalShipping'],
                'op_quantity': product['op_quantity']
            }) %}
			{% set negotiation_products = negotiation_products|merge([product]) %}
		{% endif %}
	{% endfor %}
{% endfor %}

{% set shared_voucher = form_data['o_sharedId'] is not empty and form_data['reduce_by_order_id'][form_data['o_id']] is defined %}

{% set delivery_detail = [] %}

{% if (form_data['o_products']|first)['op_deliveryDetails'] is not empty %}
    {% set tmp_delivery_detail = ((form_data['o_products']|first)['op_deliveryDetails'])|json_decode%}

    {% set partial = true %}

    {% for product in form_data['o_products'] %}
        {% if product['op_deliveryDetails'] is not empty %}
            {% set detail = (product['op_deliveryDetails']|json_decode) %}
            {% if (detail|last)['remaining'] == 0 and detail|length == 1 %}
                {% set partial = false %}
            {% endif %}
        {% endif %}
    {% endfor %}

    {% if tmp_delivery_detail|length >= 1 and partial == true %}
        {% set delivery_detail = tmp_delivery_detail %}
    {% endif%}
{% endif %}

{% block stylesheets %}

    <style>
        .spinner {
            animation: spin 2s infinite linear;
            -webkit-animation: spin2 2s infinite linear;
        }

        @keyframes spin {
            from { transform: scale(1) rotate(0deg); }
            to { transform: scale(1) rotate(360deg); }
        }

        @-webkit-keyframes spin2 {
            from { -webkit-transform: rotate(0deg); }
            to { -webkit-transform: rotate(360deg); }
        }

        .d-none {
            display: none;
        }
        
        .btn-download-document:disabled {
            cursor: not-allowed !important;
            pointer-events: all !important;
        }
    </style>
{% endblock %}

{% block content %}

	<div class="row">
		<div class="col-md-12">
			<div class="box box-primary">
				<div class="box-header with-border">
					<h3 class="box-title">{{ page_header }}</h3>
				</div>
				<div id="order-form" class="box-body">
					<div class="panel-body">
						<div class="nav-tabs-custom">
							<ul class="nav nav-tabs order-tabs">
								<li class="active order-tab-data">
									<a href="#tab-data" data-toggle="tab" data-tab="data">Data Order</a>
								</li>
                                <li class="order-tab-procurement">
										<a href="#tab-procurement" data-toggle="tab" data-tab="procurement">Data Pengadaan</a>
									</li>
								<li class="order-tab-products">
									<a href="#tab-products" data-toggle="tab" data-tab="products">Data Produk</a>
								</li>
								<li class="order-tab-voucher">
									<a href="#tab-voucher" data-toggle="tab" data-tab="voucher">{{ 'menu.voucher'|trans }}</a>
								</li>
								<li class="order-tab-shipped">
									<a href="#tab-shipped" data-toggle="tab" data-tab="shipped">Data Pengiriman</a>
								</li>
                                <li class="order-tab-pajak">
                                    <a href="#tab-pajak" data-toggle="tab" data-tab="pajak">Data Pajak</a>
                                </li>
								<li class="order-tab-payment">
									<a href="#tab-payment" data-toggle="tab" data-tab="payment">Data Pembayaran</a>
								</li>
                                {% if form_data['o_taxDocumentEmail'] is not empty %}
                                    <li class="order-tab-tax">
                                        <a href="#tab-tax" data-toggle="tab" data-tab="tax">{{ 'label.with_tax'|trans }}</a>
                                    </li>
                                {% endif %}
                                {% if form_data['o_isB2gTransaction'] == true %}
                                    <li class="order-tab-b2g">
                                        <a href="#tab-b2g" data-toggle="tab" data-tab="b2g">Data Dokumen</a>
                                    </li>
                                    <li class="order-tab-negotiation">
                                        <a href="#tab-negotiation" data-toggle="tab" data-tab="negotiation">Data Negosiasi</a>
                                    </li>
                                {% else %}
                                    <li class="order-tab-b2c">
                                        <a href="#tab-b2c" data-toggle="tab" data-tab="b2c">{{ 'label.buyer'|trans }}</a>
                                    </li>
                                {% endif %}
                                <li class="order-tab-complaint">
                                    <a href="#tab-complaint" data-toggle="tab" data-tab="complaint">Data Komplain</a>
                                </li>
                                <li class="order-tab-log">
                                    <a href="#tab-log" data-toggle="tab" data-tab="log">Data Log</a>
                                </li>
                                <li class="order-tab-rating">
                                    <a href="#tab-rating" data-toggle="tab" data-tab="rating">Data Rating</a>
                                </li>
							</ul>
							<div class="tab-content tab-order-content">
								<div id="tab-data" class="tab-pane fade in active">
									<div class="m-top-15"></div>
									<div class="form-group">
										<label for="input-invoice">{{ 'label.invoice'|trans }}</label>
										<input id="input-invoice" class="form-control" value="{{ form_data['o_invoice'] }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-store-name">{{ 'label.store'|trans }}</label>
										<input id="input-store-name" class="form-control" value="{{ form_data['s_name']|raw }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-buyer-name">{{ 'label.buyer_name'|trans }}</label>
										<input id="input-buyer-name" class="form-control" value="{{ form_data['o_name'] }}" readonly>
									</div>

                                    {% if form_data['o_workUnit'] is defined and form_data['o_workUnit'] is not empty %}
                                        <div class="form-group">
                                            <label for="input-satker-name">{{ 'label.work_unit'|trans }}</label>
                                            <input id="input-satker-name" class="form-control" value="{{ form_data['o_workUnit']['fullname'] }}" readonly>
                                        </div>
                                    {% endif %}

									<div class="form-group">
										<label for="input-buyer-phone">{{ 'label.phone'|trans }}</label>
										<input id="input-buyer-phone" class="form-control" value="{{ form_data['o_phone'] }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-status">{{ 'label.status'|trans }} Order</label>
										<input id="input-status" class="form-control" value="{{ status_list[form_data['o_status']]|trans }}" readonly>
									</div>
                                    <div class="form-group cancel_input" {% if form_data['o_status'] != 'cancel' %} style="display: none;" {% endif %}>
                                        <label for="input-dokumen-cancel">Cancel File</label>
                                        {% if form_data['o_cancel_file'] is not empty %}
                                            <figure>
                                                <a href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_cancel_file'] }) }}">
                                                    <img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">
                                                </a>
                                            </figure>
                                        {% endif %}
                                    </div>

                                    <div class="form-group cancel_input" {% if form_data['o_status'] != 'cancel' %} style="display: none;" {% endif %}>
                                        <label for="input-cancel-reason">Cancel Reason</label>
                                        <textarea id="input-cancel-reason" class="form-control" rows="3" name="cancel_reason" readonly>{{ form_data['o_cancel_reason'] }}</textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-dokumen-npwp">{{ 'label.tax_document'|trans }}</label>
                                        <input id="input-dokumen-npwp" class="form-control" value="{{ form_data['o_tax_document_npwp'] }}" readonly>
                                    </div>
                                    {% if form_data['o_statusChangeTime'] is not empty %}
                                    <div class="form-group">
                                        <label for="input-status-last-changed">{{ 'label.status_last_changed'|trans }}</label>
                                        <input id="input-status-last-changed" class="form-control" value="{{ form_data['o_statusChangeTime'] }}" readonly>
                                    </div>
                                    {% endif %}
									<div class="form-group">
										<label for="input-total">{{ 'label.total'|trans }}</label>
										<input id="input-total" class="form-control" value="{{ order_total|number_format }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-shipping-courier">Kurir Pengiriman</label>
										<input id="input-shipping-courier" class="form-control" value="{{ form_data['o_shippingCourier'] }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-shipping-service">Jenis Pengiriman</label>
										<input id="input-shipping-service" class="form-control" value="{{ form_data['o_shippingService'] }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-shipping-price">Harga Pengiriman</label>
										<input id="input-shipping-price" class="form-control" value="{{ order_shipping|number_format }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-tracking-code">Resi Pengiriman</label>
										<input id="input-tracking-code" class="form-control" value="{{ form_data['o_trackingCode'] }}" readonly>
									</div>
                                    {% if delivery_detail is not empty %}
                                        <div class="form-group">
                                            <label for="input-delivery-detail">Rincian Pengiriman</label>
                                            {% set text = '' %}

                                            {% for item in delivery_detail %}
                                                {% set text = text ~ 'Batch ' ~ item['batch'] ~ ' - Resi Pengiriman ' ~ item['tracking_code'] ~ ' - (' ~ (item['submitted_at']|date('d/m/Y - H:i')) ~ ')\n' %}
                                            {% endfor %}
                                            <textarea id="input-delivery-detail" class="form-control" rows="3" readonly>{{ text }}</textarea>
                                        </div>
                                    {% endif %}
									<div class="form-group">
										<label for="input-grand-total">Total Keseluruhan</label>
										<input id="input-grand-total" class="form-control" value="{{ grand_total|number_format }}" readonly>
									</div>
									{% if form_data['o_isB2gTransaction'] == false %}
										<div class="form-group">
											{% if shared_voucher %}
                                                {% set amount_with_voucher_value = (grand_total - form_data['reduce_by_order_id'][form_data['o_id']]) %}

                                                {% if amount_with_voucher_value < 0 %}
                                                    {% set amount_with_voucher_value = 0 %}
                                                {% endif %}

                                            {% else %}
                                                {% set amount_with_voucher_value = amount_with_voucher|number_format %}

                                                {% if amount_with_voucher < 0 %}
{#                                                    {% set amount_with_voucher = (amount_with_voucher * -1) %}#}
{#                                                    {% set amount_with_voucher_value = '(' ~ amount_with_voucher|number_format ~ ')' %}#}
                                                    {% set amount_with_voucher_value = 0 %}
                                                {% endif %}

                                                {% if voucher_value > 0 %}
                                                    {% set amount_with_voucher_value = (grand_total - voucher_value)|number_format %}

                                                    {% if amount_with_voucher < 0 %}
                                                        {% set amount_with_voucher_value = 0 %}
                                                    {% endif %}
                                                {% endif %}
                                            {% endif %}

											<label for="input-grand-total-with-voucher">Total Keseluruhan dengan Voucher</label>
											<input id="input-grand-total-with-voucher" class="form-control" value="{{ amount_with_voucher_value }}" readonly>
										</div>
									{% endif %}
                                    <div class="form-group">
                                        <label for="input-note">Catatan</label>
                                        <textarea id="input-note" class="form-control" rows="3" readonly>{{ form_data['o_note'] }}</textarea>
                                    </div>
									<div class="form-group">
										<label for="input-address">Alamat</label>
										<textarea id="input-address" class="form-control" rows="3" readonly>{{ form_data['o_address'] }}</textarea>
									</div>
									<div class="form-group">
										<label for="input-city">Kota</label>
										<input id="input-city" class="form-control" value="{{ form_data['o_city'] }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-province">Provinsi</label>
										<input id="input-province" class="form-control" value="{{ form_data['o_province'] }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-post-code">Kode Pos</label>
										<input id="input-post-code" class="form-control" value="{{ form_data['o_postCode'] }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-created-at">Dibuat Pada</label>
										<input id="input-created-at" class="form-control" value="{{ form_data['o_createdAt']|date('d F Y, H:i') }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-updated-at">Diubah Pada</label>
										<input id="input-updated-at" class="form-control" value="{{ form_data['o_updatedAt']|date('d F Y, H:i') }}" readonly>
									</div>
									{% if form_data['o_isB2gTransaction'] == false %}
										<div class="form-group">
											<label for="input-invoice-file">{{ 'label.invoice'|trans }}</label>
											<figure>
												<a href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'invoice'}) }}">
													<img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">
												</a>
											</figure>
										</div>

                                        {% if form_data['o_taxInvoiceFile'] is not empty %}
                                            <div class="form-group">
                                                <label for="input-tax-invoice-file">Faktur Pajak</label>
                                                <figure>
                                                    <a
                                                        href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_taxInvoiceFile'] }) }}">
                                                        <img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">
                                                    </a>
                                                </figure>
                                            </div>
                                        {% endif %}
									{% endif %}

                                    {% if form_data['o_status'] == 'cancel' %}
                                        <div class="form-group">
                                            <label for="input-reason_cancel-at">Alasan Cancel</label>
                                            <textarea id="input-reason_cancel-at" class="form-control" readonly>{{form_data['o_cancel_reason']|default()}}</textarea>
                                        </div>
                                    {% endif %}
                                    
								</div>


                                <div id="tab-shipped" class="tab-pane fade">
                                    <div class="m-top-15"></div>
                                    <h5>Metode Pengiriman : {% if form_data['o_shipped_method'] %}{{get_parameter('shipped_method_options')[form_data['o_shipped_method']|default('normal_shipped')] }} {% endif %}</h5>
                                    {% if form_data['o_shipped_method'] == 'self_courier' %}

                                        <label for="input-nama_penerima">Nama Penerima</label>
                                        <input id="input-nama_penerima" name="nama_penerima" class="form-control" value="{{form_data['o_self_courier_name']}}" readonly>

                                        <label for="input-posisi_jabatan">Posisi/Jabatan</label>
                                        <input id="input-posisi_jabatan" name="posisi_jabatan" class="form-control" value="{{form_data['o_self_courier_position']}}" readonly>

                                        <label for="input-no_hp_penerima">No HP</label>
                                        <input id="input-no_hp_penerima" name="no_hp_penerima" class="form-control" value="{{form_data['o_self_courier_telp']}}" readonly>

                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th width="70%">{{ 'label.images'|trans }}</th>
                                                    <th width="30%">{{ 'label.actions'|trans }}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for i in 0..2 %}
                                                    {% if form_data['o_shippedFiles'][i] is defined %}
                                                        {% set img_shipped = form_data['o_shippedFiles'][i]['os_filepath'] is not null ? 'uploads/' ~ form_data['o_shippedFiles'][i]['os_filepath'] : 'dist/img/no-image.png' %}
                                                    {% else %}
                                                        {% set img_shipped = 'dist/img/no-image.png' %}
                                                    {% endif %}
                                                    <tr>
                                                        <td>
                                                            <img src="{{ path('sftp_show_file', {'path': img_shipped}) }}" style="width: 200px;" />
                                                        </td>
                                                        <td class="py-0 align-middle">
                                                            {# <div class="btn-group btn-group-sm">
                                                                <input type="file" name="o_shippedFiles_{{i}}" accept="image/jpeg,image/gif,image/png" value="0">
                                                            </div> #}
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% else %}
                                        {% if form_data['o_state_img'] %}
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th width="70%">{{ 'label.images'|trans }}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% set img_shipped = 'uploads/' ~ form_data['o_state_img'] %}
                                                    {# {% else %}
                                                    {% set img_shipped = 'dist/img/no-image.png' %} #}
                                                    <tr>
                                                        <td>
                                                            <img src="{{ path('sftp_show_file', {'path': img_shipped}) }}" style="width: 200px;" />
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        {% endif %}
                                    {% endif %}
                                </div>

                                <div id="tab-procurement" class="tab-pane fade">
                                    <div class="m-top-15"></div>
                                    <div class="form-group">
                                        <label for="input-work_unit_name">Nama Satuan Kerja</label>
                                        <input id="input-work_unit_name" class="form-control" value="{{ form_data['o_work_unit_name']|default() }}" name="work_unit_name" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-institution_name">Nama Kementerian/Lembaga/Pemerintah Daerah</label>
                                        <input id="input-institution_name" class="form-control" value="{{ form_data['o_institution_name']|default() }}" name="institution_name" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-job_package_name">Nama Paket Pekerjaan</label>
                                        <input id="input-job_package_name" class="form-control" value="{{ form_data['o_jobPackageName']|default() }}" name="job_package_name" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-fiscal_year">Tahun Anggaran</label>
                                        <input id="input-fiscal_year" class="form-control" value="{{ form_data['o_fiscalYear']|default() }}" name="fiscal_year" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-rup">Kode RUP</label>
                                        <input id="input-rup" class="form-control" value="{{ form_data['o_rupCode']|default() }}" name="rup" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-source_of_fund">Sumber Dana</label>
                                        <input id="input-source_of_fund" class="form-control" value="{{ form_data['o_sourceOfFund']|default() }}" name="source_of_fund" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-budget_account">Kode Rekening Anggaran</label>
                                        <input id="input-budget_account" class="form-control" value="{{ form_data['o_budget_account']|default() }}" name="budget_account" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-budget_ceiling">Pagu Anggaran</label>
                                        <input id="input-budget_ceiling" class="form-control" value="{{ form_data['o_budgetCeiling']|default() }}" name="budget_ceiling" readonly>
                                    </div>
                                    {# <div class="form-group">
                                        <label for="input-budget_account">{{ 'label.payment_method'|trans }}</label>
                                        <select name="payment_method"  readonly>
                                            {% for key, option in get_parameter('ppk_method_options') %}
                                                <option value="{{key}}" {{ key == form_data['o_ppk_payment_method'] ? 'selected' :'' }}>{{option}}</option>
                                            {% endfor %}
                                        </select>
                                    </div> #}
                                    <div class="form-group">
                                        <label for="input-pic_name">Nama PIC</label>
                                        <input id="input-pic_name" class="form-control" value="{{ form_data['o_unit_name']|default() }}" name="pic_name" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-pic_telp">No Telp PIC</label>
                                        <input id="input-pic_telp" class="form-control" value="{{ form_data['o_unit_telp']|default() }}" name="pic_telp" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-pic_email">Email PIC</label>
                                        <input id="input-pic_email" class="form-control" value="{{ form_data['o_unit_email']|default() }}" name="pic_email" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-pic_unit">Unit PIC</label>
                                        <input id="input-pic_unit" class="form-control" value="{{ form_data['o_unit_pic']|default() }}" name="pic_unit" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-pic_address">Alamat PIC</label>
                                        <input id="input-pic_address" class="form-control" value="{{ form_data['o_unit_address']|default() }}" name="pic_address" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-ppk">PPK</label>
                                        <select name="ppk_id" disabled>
                                            {% for ppk in form_data['all_ppk_users'] %}
                                                {% set ppk_option = 'label.' ~ ppk['u_subRoleTypeAccount'] %}
                                                <option value="{{ppk['u_id']}}" {{ ppk['u_id'] == form_data['o_ppkId'] ? 'selected' :'' }}> {{ppk_option|trans}} - {{ppk['u_firstName'] ~ ' ' ~ ppk['u_lastName']}} ({{ppk['u_email']}})</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="input-treasurer">Bendahara</label>
                                        <select name="treasurer_id" disabled>
                                            {% for treasurer in form_data['all_treasurer_users'] %}
                                                {% set treasurer_option = 'label.' ~ treasurer['u_subRoleTypeAccount'] %}
                                                <option value="{{treasurer['u_id']}}" {{ treasurer['u_id'] == form_data['o_treasurerId'] ? 'selected' :'' }}> {{treasurer_option|trans}} - {{treasurer['u_firstName'] ~ ' ' ~ treasurer['u_lastName']}} ({{treasurer['u_email']}})</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                </div>
								<div id="tab-products" class="tab-pane fade">
									<div class="m-top-15"></div>
                                    {% set dpp_ppn_pph = 0 %}
                                    {% set order_shipping_price = 0 %}
									{% for product in form_data['o_products'] %}
                                        {% set order_shipping_price = product['op_priceShippingNegotiation'] %}
										{% set product_price = product['op_price'] %}
                                        {% set ppn_product = product['op_withTax'] == true ? product['op_taxNominal'] : 0 %}
										{% set sub_total = (product_price * product['op_quantity']) + ppn_product   %}
                                        {% set dpp_ppn_pph = dpp_ppn_pph + (product['op_withTax'] == true ? product['op_totalPrice'] : 0) %}

										<div class="col-md-3">
											<div class="box box-success">
												<div class="box-header with-border">
													<h3 class="box-title">{{ product['p_name'] }}</h3>
												</div>
												<div class="box-body">
													<p class="text-muted">
														<strong>Qty:</strong>
														{{ product['op_quantity'] }}<br>
														<strong>Harga Jual:</strong>
														{{ product_price|number_format }}<br>
														<strong>PPN:</strong>
														{{ ppn_product|number_format }}<br>
														<strong>Total:</strong>
														{{ sub_total|number_format }}
													</p>
													{% if form_data['o_isB2gTransaction'] == true %}
														{% set chat_room_id = form_data['o_chatRoomId'] %}
														{% if chat_room_id is empty %}
															{% set chat_room_id = order_chat_room(form_data['u_id'], form_data['s_ow_id'], form_data['o_id'], product['p_id']|to_int) %}
														{% endif %}
														{% if chat_room_id is not empty %}
															<p>
																<a href="javascript:void(0);" class="open-chat-history" data-room="{{ chat_room_id }}" data-initiator="{{ form_data['u_id'] }}">{{ 'label.chat_archive'|trans }}</a>
															</p>
														{% endif %}
													{% endif %}
												</div>
											</div>
										</div>
									{% endfor %}
								</div>
								<div id="tab-voucher" class="tab-pane fade">
									<div class="m-top-15"></div>
									{% if order_vouchers_list|length > 0 %}
										{% set v_lists = [] %}
										{% for voucher_list in order_vouchers_lists %}
											{% if voucher_list['v_code'] not in v_lists %}
												<div class="form-group">
													<label for="input-voucher-{{ loop.index }}">{{ 'label.code'|trans ~ ': ' ~ voucher_list['v_code'] }}</label>
													<input id="input-voucher-{{ loop.index }}" class="form-control" value="{{ voucher_list['v_amount']|number_format }}" readonly>
												</div>
												{% set v_lists = v_lists|merge([voucher_list['v_code']]) %}
											{% endif %}
										{% endfor %}

                                        {% if shared_voucher %}
                                            <div class="form-group">
                                                <label>Voucher Digunakan</label>
                                                <input class="form-control" value="{{ form_data['reduce_by_order_id'][form_data['o_id']]|number_format }}" readonly>
                                            </div>
                                        {% endif %}
									{% endif %}
								</div>
								<div id="tab-payment" class="tab-pane fade">
									<div class="m-top-15"></div>
									<div class="form-group">
										<label for="input-payment-type">Tipe Pembayaran</label>
										<input id="input-payment-type" class="form-control" value="{{ form_data['op_type'] }}" readonly>
									</div>
                                    {% if form_data['op_type'] == 'doku' %}
                                        <div class="form-group">
                                            <label for="input-doku-invoice">{{ 'label.doku_invoice'|trans }}</label>
                                            <input id="input-doku-invoice" class="form-control" value="{{ form_data['o_dokuInvoiceNumber'] }}" readonly>
                                        </div>
                                    {% endif %}
									<div class="form-group">
										{% set order_paid_nominal = form_data['op_nominal']|default(0) %}

                                        {% if shared_voucher %}
                                            {% set order_paid_nominal = (grand_total - form_data['reduce_by_order_id'][form_data['o_id']]) %}
                                        {% else %}
                                            {% if amount_with_voucher > 0 %}
                                                {% set order_paid_nominal = amount_with_voucher %}
                                            {% endif %}
                                            {% if voucher_value > 0 %}
                                                {% set order_paid_nominal = grand_total - voucher_value %}
                                            {% endif %}
                                        {% endif %}

										<label for="input-nominal">{{ 'label.nominal'|trans }}</label>
										<input id="input-nominal" class="form-control" value="{{ order_paid_nominal > 0 ? order_paid_nominal|round|number_format : '' }}" readonly>
									</div>
									<div class="form-group">
										<label for="input-bank-name">Nama Bank</label>
										<input id="input-bank-name" class="form-control" value="{{ form_data['op_bankName'] }}" readonly>
									</div>
									{#<div class="form-group">
                                        <label for="input-bank-account-name">{{ 'label.bank_account_name'|trans }}</label>
                                        <input id="input-bank-account-name" class="form-control" value="{{ form_data['op_bankAccountName'] }}" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-bank-account-number">{{ 'label.bank_account_number'|trans }}</label>
                                        <input id="input-bank-account-number" class="form-control" value="{{ form_data['op_bankAccountNumber'] }}" readonly>
                                    </div>#}
									<div class="form-group">
										<label for="input-payment-message">Pesan</label>
										<textarea id="input-payment-message" class="form-control" rows="3" readonly>{{ form_data['op_message'] }}</textarea>
									</div>
									<div class="form-group">
										{% if form_data['op_attachment'] is not empty %}
											<figure>
                                                {% if form_data['op_type'] == 'doku' %}
                                                    <a href="{{ form_data['op_attachment'] }}" title="{{ 'button.download'|trans }}" target="_blank">
                                                        <img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">
                                                    </a>
                                                {% else %}
                                                    {% if '.pdf' in form_data['op_attachment'] %}
                                                        <a href="{{path('sftp_show_file', {'path': form_data['op_attachment'] }) }}" title="{{ 'button.download'|trans }}" target="_blank">
                                                            <img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">
                                                        </a>
                                                    {% else %}
                                                        <a href="{{path('sftp_show_file', {'path': form_data['op_attachment'] }) }}" title="{{ 'button.view'|trans }}" class="cbox-gallery">
                                                            <img class="img-responsive" src="{{path('sftp_show_file', {'path': form_data['op_attachment'] }) }}" alt="">
                                                        </a>
                                                    {% endif %}
                                                {% endif %}
											</figure>
										{% endif %}
									</div>
									<div class="form-group">
										{% set order_paid_at = form_data['op_createdAt']|default() %}
										<label for="input-paid-at">Terbayar</label>
										<input id="input-paid-at" class="form-control" value="{{ order_paid_at is not empty ? order_paid_at|date('d F Y, H:i') : '' }}" readonly>
									</div>
								</div>
                                <div id="tab-pajak" class="tab-pane fade">
                                    <div class="m-top-15"></div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label for="">Metode Pemotongan Pajak</label>
                                                <select id="tax-types" name="tax_types" class="form-control" disabled>
                                                    <option value="">Pilih Metode Pemotongan Pajak</option>
                                                    {% for key, option in get_parameter('tax_payment_types') %}
                                                        {% if (form_data['s_pkp'] == false and key == 58) or form_data['s_pkp'] == true %}
                                                            <option value="{{key}}" {{ key == form_data['o_taxType'] ? 'selected':'' }} data-description="{{option['description']}}">{{option['label']}}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label for="" id="label-keterangan-pembayaran" style="display: none;">Keterangan :</label>
                                                <p style="text-align: justify;" id="desc-keterangan-pembayaran"></p>
                                            </div>
                                        </div>
                                        {% set dpp_pph = dpp_ppn_pph + order_shipping_price %}
                                        {% set total_order = form_data['o_total'] + form_data['o_shippingPrice'] %}
                                        <div class="col-lg-12 pph-pmk-58" {{ form_data['o_taxType'] != '58' ? 'style="display: none;"':'' }}>
                                            <table width="100%">
                                                <tr>
                                                    <td width="50%" style="text-align: right;">
                                                        <b>PPN</b>
                                                    </td>
                                                    <td>:</td>
                                                    {% set ppn_58 = dpp_pph * (11 / 100) %}
                                                    <td width="49%">
                                                    {# {% set ppn_price = sub_total_ppn_price >= 2000000 ? sub_total_ppn_price : 0 %} #}
                                                        <b>Rp. {{ppn_58|number_format(2, ',', ',')}}</b>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%" style="text-align: right;">
                                                        <b>PPh (0,5%)</b>
                                                    </td>
                                                    <td>:</td>
                                                    {% set pph_58 = dpp_pph * (0.5 / 100) %}
                                                    <td width="49%">
                                                        <b>Rp. {{pph_58|number_format(2, ',', ',')}}</b>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%" style="text-align: right;">
                                                        <b>TOTAL YANG HARUS DIBAYAR</b>
                                                    </td>
                                                    <td>:</td>
                                                    {% set total_58 = form_data['o_total'] + form_data['o_shippingPrice'] %}
                                                    <td width="49%">
                                                        {# <b>Rp. {{total_58|number_format(2, ',', ',')}}</b> #}
                                                        <b>Rp. {{grand_total|number_format(2, ',', ',')}}</b>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="col-lg-12 pph-pmk-59" {{ form_data['o_taxType'] != '59' ? 'style="display: none;"':'' }}>
                                            <table width="100%" cellpadding="10px" cellspacing="0">
                                                <tr>
                                                    <td width="50%">
                                                        <label for="">Tarif Pajak</label>
                                                    </td>
                                                    <td width="50%">
                                                        <label for="">Nominal</label>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <select id="ppn-choose" class="choose_ppn_pph" name="ppn_choose" data-index_primary="ppn" data-index_secondary="pph" disabled>
                                                                {% for key, option in get_parameter('ppn_choose_options') %}
                                                                    <option value="{{key}}" {{ form_data['o_is_other_ppn'] == true ? (key == 'lainnya' ? 'selected':'') : (form_data['o_treasurer_ppn'] == key ? 'selected':'') }} >{{option}}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="text" class="form-control" name="ppn" value="0" id="treasurer_nominal_ppn" disabled>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr id="other_ppn_div" style="{{form_data['o_is_other_ppn'] != true ? 'display:none' : ''}}">
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="text" class="form-control" name="other_ppn_name" id="other_ppn_name" value="{{form_data['o_is_other_ppn'] == true ? form_data['o_other_ppn_name'] : ''}}" placeholder="Pajak Lainnya" disabled>
                                                        </div>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="text" class="form-control other_ppn_pph_persentase" name="other_ppn_persentase" id="other_ppn_persentase" value="{{form_data['o_is_other_ppn'] == true ? form_data['o_treasurer_ppn'] : 0}}" placeholder="Persentase Pajak Lainnya" data-index_primary="ppn" data-index_secondary="pph" disabled>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="hidden" value="{{dpp_pph}}" id="dpp_ppn_pph">
                                                            <input type="hidden" value="{{total_order}}" id="total_order">
                                                            <input type="hidden" class="form-control pph-input-treasurer" data-dpp_pph="{{dpp_pph}}" name="pph" value="{{ form_data['o_treasurer_pph'] is not empty ? form_data['o_treasurer_pph']:'' }}">
                                                            <select id="pph-choose" class="choose_ppn_pph" name="pph_choose" data-index_primary="pph" data-index_secondary="ppn" disabled>
                                                                <option value="">Pilih PPH</option>
                                                                {% for key, option in get_parameter('pph_choose_options') %}
                                                                    <option value="{{key}}" {{ form_data['o_isOtherPph'] == true ? (key == 'lainnya' ? 'selected':'') : (form_data['o_treasurer_pph'] == key ? 'selected':'') }} >{{option}}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="text" class="form-control" id="treasurer_nominal_pph" value="0" disabled>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr id="other_pph_div" style="{{form_data['o_isOtherPph'] != true ? 'display:none' : ''}}">
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="text" class="form-control" name="other_pph_name" id="other_pph_name" value="{{form_data['o_isOtherPph'] == true ? form_data['o_otherPphName'] : ''}}" placeholder="Pajak Lainnya">
                                                        </div>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="text" class="form-control other_ppn_pph_persentase" name="other_pph_persentase" id="other_pph_persentase" value="{{form_data['o_isOtherPph'] == true ? form_data['o_treasurer_pph'] : 0}}" placeholder="Persentase Pajak Lainnya" data-index_primary="pph" data-index_secondary="ppn">
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%" style="text-align: right;padding-right: 10px;">
                                                        <label>TOTAL PAJAK</label>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="text" class="form-control" id="total_pajak" value="" disabled>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="50%" style="text-align: right;padding-right: 10px;">
                                                        <label>TOTAL YANG HARUS DIBAYAR</label>
                                                    </td>
                                                    <td width="50%">
                                                        <div class="form-group">
                                                            <input type="text" class="form-control" id="total_bayar" value="" disabled>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="dc12 pph-pmk-59" {{ form_data['o_taxType'] != '59' ? 'style="display: none;"':'' }}>
                                            <div class="input form-group"> 
                                                <input type="hidden" id="treasurer_pph_nominal" name="pph_nominal" value="{{ form_data['o_treasurerPphNominal'] is not empty ? form_data['o_treasurerPphNominal']:'' }}">
                                                <input type="hidden" id="treasurer_ppn_nominal" name="ppn_nominal" value="{{ form_data['o_treasurer_ppn_nominal'] is not empty ? form_data['o_treasurer_ppn_nominal']:'' }}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="tab-tax" class="tab-pane fade">
                                    <div class="m-top-15"></div>
                                    {% if form_data['o_taxDocumentEmail'] is not empty %}
                                        <div class="form-group">
                                            <label for="input-tax-email">{{ 'label.email'|trans }}</label>
                                            <input id="input-tax-email" class="form-control" value="{{ form_data['o_taxDocumentEmail'] }}" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label for="input-tax-phone">{{ 'label.phone'|trans }}</label>
                                            <input id="input-tax-phone" class="form-control" value="{{ form_data['o_taxDocumentPhone'] }}" readonly>
                                        </div>
                                        <div class="form-group">
                                            <figure>
                                                <a href="{{path('sftp_show_file', {'path': form_data['o_taxDocumentFile']}) }}" class="cbox-gallery">
                                                    <img class="img-responsive" src="{{path('sftp_show_file', {'path': form_data['o_taxDocumentFile']}) }}" alt="">
                                                </a>
                                            </figure>
                                        </div>
                                    {% endif %}
                                </div>
                                {% if form_data['o_isB2gTransaction'] == true %}
                                    <div id="tab-tax" class="tab-pane fade">
                                        <div class="m-top-15"></div>
                                        {% if form_data['o_taxDocumentEmail'] is not empty %}
                                            <div class="form-group">
                                                <label for="input-tax-email">{{ 'label.email'|trans }}</label>
                                                <input id="input-tax-email" class="form-control" value="{{ form_data['o_taxDocumentEmail'] }}" readonly>
                                            </div>
                                        <div class="form-group">
                                            <label for="input-tax-phone">{{ 'label.phone'|trans }}</label>
                                            <input id="input-tax-phone" class="form-control" value="{{ form_data['o_taxDocumentPhone'] }}" readonly>
                                        </div>
                                        <div class="form-group">
                                            <figure>
                                                <a href="{{path('sftp_show_file', {'path': form_data['o_taxDocumentFile']}) }}" class="cbox-gallery">
                                                    <img class="img-responsive" src="{{path('sftp_show_file', {'path': form_data['o_taxDocumentFile']}) }}" alt="">
                                                </a>
                                            </figure>
                                        </div>
                                        {% endif %}
                                    </div>

                                    <div id="tab-b2g" class="tab-pane fade">
                                        <div class="m-top-15"></div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="callout callout-info">
                                                    <h4>{{ 'message.info.government_document_template_info'|trans }}</h4>
                                                    <p>{{ 'message.info.government_document_template'|trans }}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            {% if form_data['o_status'] != 'pending' and form_data['o_status'] != 'confirmed' %}
                                                {% if grand_total <= 50000000 %}
                                                    <div class="col-md-2">
                                                        <center>
                                                            <label>Tanda Terima</label>
                                                            <figure>
                                                                {# href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bast'}) }}" #}
                                                                <a>
                                                                    <i class="fa fa-print" style="font-size: 120px;"></i>
                                                                </a>
                                                            </figure>
                                                        </center>
                                                        <center>
                                                    <button data-type="bast" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bast'}) }}" data-filename="Bast">
                                                        <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                    <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'bast'}) }}">
                                                        <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                    </a>
                                                        </center>
                                                    </div>
                                                {% endif %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label>Label</label>
                                                        <figure>
                                                            {#  href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'label'}) }}" #}
                                                            <a>
                                                                <i class="fa fa-print" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                    <center>
                                                   <button data-type="label" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'label'}) }}" data-filename="Label">
                                                        <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                   <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'label'}) }}">
                                                       <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                   </a>
                                                    </center>
                                                </div>
                                                <div class="col-md-2">
                                                    <center>
                                                        <label>Performa Invoice</label>
                                                        <figure>
                                                            {# href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'invoice'}) }}" #}
                                                            <a>
                                                                <i class="fa fa-print" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                    <center>
                                                   <button data-type="performa_invoice" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'performa_invoice'}) }}" data-filename="Performa Invoice">
                                                        <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                   <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'performa_invoice'}) }}">
                                                       <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                   </a>
                                                    </center>
                                                </div>
                                                <div class="col-md-2">
                                                    <center>
                                                        <label>Kwitansi</label>
                                                        <figure>
                                                            {# href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'receipt'}) }}" #}
                                                            <a>
                                                                <i class="fa fa-print" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                    <center>
                                                   <button data-type="receipt_ls" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'receipt_ls'}) }}" data-filename="Kwitansi">
                                                        <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                   <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'receipt_ls'}) }}">
                                                       <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                   </a>
                                                    </center>
                                                </div>
                                                <div class="col-md-2">
                                                    <center>
                                                        <label>Surat Pesanan</label>
                                                        <figure>
                                                            {#  href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'spk'}) }}" #}
                                                            <a>
                                                                <i class="fa fa-print" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                    <center>
                                                   <button data-type="spk" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'spk'}) }}" data-filename="Surat Pesanan">
                                                        <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                        <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                    </button>
                                                   <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'spk'}) }}">
                                                       <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                   </a>
                                                    </center>
                                                </div>


                                                {% if grand_total > get_parameter('limit_trx_50') %}
                                                    <div class="col-md-2">
                                                        <center>
                                                            <label>BAPD</label>
                                                            <figure>
                                                                {# <a href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bapd'}) }}"> #}
                                                                <a>
                                                                    <i class="fa fa-print" style="font-size: 120px;"></i>
                                                                </a>
                                                            </figure>
                                                        </center>
                                                        <center>
                                                            {# <a href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bapd'}) }}">
                                                                <button class="btn btn-danger"><i class="fa fa-file-pdf-o" aria-hidden="true"></i></button>
                                                            </a> #}
                                                            {# <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'invoice'}) }}">
                                                                <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                            </a> #}
                                                            <button data-type="bapd" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bapd'}) }}" data-filename="BAPD">
                                                                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                                <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                            </button>
                                                        </center>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <center>
                                                            <label>BAST</label>
                                                            <figure>
                                                                {# <a href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bapd'}) }}"> #}
                                                                <a>
                                                                    <i class="fa fa-print" style="font-size: 120px;"></i>
                                                                </a>
                                                            </figure>
                                                        </center>
                                                        <center>
                                                            {# <a href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bast_ls'}) }}">
                                                                <button class="btn btn-danger"><i class="fa fa-file-pdf-o" aria-hidden="true"></i></button>
                                                            </a> #}
                                                            {# <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'invoice'}) }}">
                                                                <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                            </a> #}
                                                            <button data-type="bast_ls" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bast_ls'}) }}" data-filename="BAST">
                                                                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                                <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                            </button>
                                                        </center>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <center>
                                                            <label>SPK</label>
                                                            <figure>
                                                                {# <a href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'bapd'}) }}"> #}
                                                                <a>
                                                                    <i class="fa fa-print" style="font-size: 120px;"></i>
                                                                </a>
                                                            </figure>
                                                        </center>
                                                        <center>
                                                            {# <a href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'spk_new'}) }}">
                                                                <button class="btn btn-danger"><i class="fa fa-file-pdf-o" aria-hidden="true"></i></button>
                                                            </a> #}
                                                            {# <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'invoice'}) }}">
                                                                <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                            </a> #}
                                                            <button data-type="spk_new" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'spk_new'}) }}" data-filename="SPK">
                                                                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                                <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                            </button>
                                                        </center>
                                                    </div>
                                                {% endif %}

                                                {% if form_data['o_status'] == 'paid' and form_data['o_taxType'] == '58' %}
                                                    <div class="col-md-2">
                                                        <center>
                                                            <label>{{ 'label.surat_tagihan'|trans }}</label>
                                                            <figure>
                                                                {# href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'invoice'}) }}" #}
                                                                <a>
                                                                    <i class="fa fa-print" style="font-size: 120px;"></i>
                                                                </a>
                                                            </figure>
                                                        </center>
                                                            <center>
                                                                <button data-type="invoice" type="button" class="btn btn-danger btn-download-document" value="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'invoice'}) }}" data-filename="Invoice">
                                                                    <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                                                    <i class="fa fa-spinner spinner d-none" aria-hidden="true"></i>
                                                                </button>
                                                                <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'invoice'}) }}">
                                                                    <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                                </a>
                                                            </center>
                                                    </div>
                                                {% endif %}

                                                {% if form_data['o_other_document'] is not empty %}
                                                    <div class="col-md-2">
                                                        <center>                                                            
                                                            <label>{{ form_data['o_other_document_name'] is not empty ? form_data['o_other_document_name'] : 'Dokumen lainnya' }}</label>
                                                            <figure>
                                                                <a>
                                                                    <i class="fa fa-print" style="font-size: 120px;"></i>
                                                                </a>
                                                            </figure>
                                                        </center>
                                                        <center>
                                                            <a href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_other_document'] }) }}">
                                                                <button class="btn btn-danger"><i class="fa fa-file-pdf-o" aria-hidden="true"></i></button>
                                                            </a>
                                                        </center>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                        {% if form_data['o_bastFile'] is not empty or form_data['o_taxInvoiceFile'] is not empty or form_data['o_invoiceFile'] is not empty or form_data['o_receiptFile'] is not empty or form_data['o_workOrderLetterFile'] is not empty or form_data['o_deliveryPaperFile'] is not empty %}
                                            <hr>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="callout callout-info">
                                                        <h4>{{ 'message.info.government_document_info'|trans }}</h4>
                                                        <p>{{ 'message.info.government_document'|trans }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="row">
                                            {% if form_data['o_bastFile'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="input-bast-file">{{ 'label.bast'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_bastFile']}) }}">
                                                                {#<img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">#}
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}
                                            {% if form_data['o_taxInvoiceFile'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="input-tax-invoice-file">{{ 'label.tax_invoice'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_taxInvoiceFile']}) }}">
                                                                {#<img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">#}
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}
                                            {% if form_data['o_invoiceFile'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="input-tax-invoice-file">{{ 'label.invoice'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_invoiceFile']}) }}">
                                                                {#<img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">#}
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}
                                            {% if form_data['o_receiptFile'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="input-receipt-file">{{ 'label.receipt'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_receiptFile']}) }}" title="{{ 'button.download'|trans }}" target="_blank">
                                                                {#<img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">#}
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}
                                            {% if form_data['o_workOrderLetterFile'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="input-work-order-letter-file">{{ 'label.work_order_letter'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_workOrderLetterFile']}) }}" title="{{ 'button.download'|trans }}" target="_blank">
                                                                {#<img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">#}
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}
                                            {% if form_data['o_deliveryPaperFile'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="input-delivery-paper-file">{{ 'label.delivery_paper'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_deliveryPaperFile']}) }}">
                                                                {#<img class="img-responsive" src="{{ site_url('dist/img/doc-placeholder.jpg') }}" alt="" style="width: 120px;">#}
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}
                                            {% if form_data['o_withholdingTaxSlipFile'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="input-withholding-file">{{ 'label.withholding_tax'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_withholdingTaxSlipFile']}) }}">
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}
                                            {% if form_data['o_spk_letter'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="spk-letter-file">{{ 'label.spk_letter'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_spk_letter']}) }}">
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}

                                            {% if form_data['o_handover_letter'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="handover_letter-file">{{ 'label.spk-letter'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_handover_letter']}) }}">
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}

                                            {% if form_data['o_handover_certificate'] is not empty %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label for="handover-certificate-file">{{ 'label.spk-certificate'|trans }}</label>
                                                        <figure>
                                                            <a
                                                                href="{{ path('sftp_show_file', {'path': 'uploads/' ~ form_data['o_handover_certificate']}) }}">
                                                                <i class="fa fa-file" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                </div>
                                            {% endif %}
                                        </div>
                                        {# {% if form_data['oc_id'] is defined and form_data['oc_id'] is not empty %}
                                            <div class="form-group">
                                                <label for="input-complain-description">{{ 'label.order_complain'|trans }}</label>
                                                <input id="input-complain-description" class="form-control" value="{{ form_data['oc_description']|default() }}" readonly>
                                            </div>
                                        {% endif %}
                                        {% if form_data['oc_isResolved'] is defined and form_data['oc_isResolved'] == true %}
                                            <div class="form-group">
                                                <label for="input-complain-resolved-at">{{ 'label.resolved_at'|trans }}</label>
                                                <input id="input-complain-resolved-at" class="form-control" value="{{ form_data['oc_isResolved']|date('d F Y, H:i') }}" readonly>
                                            </div>
                                        {% endif %} #}
                                    </div>


                                    <div id="tab-negotiation" class="tab-pane fade">
                                        {% if form_data['o_negotiationStatus'] != 'none' %}

                                            {% if form_data['o_negotiationStatus'] != 'finish' %}
                                                {% if negotiationLastApprovedBy['on_submittedAs'] == 'buyer' and negotiationLastApprovedBy['on_merchantApproval'] == false %}
                                                    {% set nego_on = 'label.seller' %}
                                                {% else %}
                                                    {% set nego_on = 'label.buyer' %}
                                                {% endif%}

                                                <h4>Status Negosiasi: Negosiasi pada: {{ nego_on|trans }}</h4>

                                                {% if negotiationLastApprovedBy['on_merchantApproval'] == true or negotiationLastApprovedBy['on_customerApproval'] == true %}
                                                    {% if negotiationLastApprovedBy['on_merchantApproval'] == true %}
                                                        {% set approvedBy = 'label.seller' %}
                                                    {% elseif negotiationLastApprovedBy['on_customerApproval'] == true %}
                                                        {% set approvedBy = 'label.buyer' %}
                                                    {% endif %}
                                                    <h4>{{ 'label.approved_by'|trans }}: {{ approvedBy|trans }}</h4>
                                                {% endif %}
                                            {% else %}
                                                <h4>Status Negosiasi: {{ form_data['o_negotiationStatus'] }}</h4>
                                            {% endif %}

                                            {% set preserved_batch = [] %}
                                            {% set total_ppn = 0 %}
                                            {% set total_price_nego = 0 %}
                                            {% for product_nego in form_data['o_negotiatedProducts'] %}
                                                {% if product_nego['on_batch'] not in preserved_batch %}
                                                    {% set submitted_as = 'label.' ~ product_nego['on_submittedAs'] %}
                                                    {% set total_ppn_temp = 0 %}
                                                    {% set total_price_nego_temp = 0 %}
                                                    <div class="col-md-12">
                                                        <div class="box box-success">
                                                            <div class="box-header with-border">
                                                                <h3 class="box-title">
                                                                    {{ 'label.batch'|trans ~ ' ' ~ product_nego['on_batch'] ~ ' (' ~ submitted_as|trans ~ ')' }}
                                                                    -
                                                                    {{ product_nego['on_createdAt']|date('d F Y H:i') }}
                                                                    {{ product_nego['on_isApproved'] ? '[APPROVED]' : '' }}
                                                                </h3>
                                                            </div>
                                                            <div class="box-body">

                                                                <table class="table table-bordered">
                                                                    <tr>
                                                                        <td colspan="3"><b>Waktu Eksekusi</b></td>
                                                                        <td>{{ product_nego['on_executionTime'] }}
                                                                            Hari</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="3"><b>Catatan</b></td>
                                                                        <td>
                                                                            {{ product_nego['on_note'] }}</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="4" style="text-align: center; background-color: #ecf0f1;"><b>HARGA NEGOSIASI PRODUK</b></td>
                                                                    </tr>
                                                                    {% set total_price_nego_temp = 0 %}
                                                                    {% set ppn_nego_shipping_price = 0 %}
                                                                    <tr>
                                                                        <td style="background-color: #ecf0f1;">Nama Produk</td>
                                                                        <td style="background-color: #ecf0f1;">Harga Negosiasi </td>
                                                                        <td style="background-color: #ecf0f1;">Qty</td>
                                                                        <td style="background-color: #ecf0f1;">Total Harga Produk</td>
                                                                    </tr>
                                                                    {% for product in negotiation_products %}
                                                                        {% if product['on_batch'] == product_nego['on_batch'] %}
                                                                            <tr>
                                                                                <td>{{ product['p_name'] }}</td>
                                                                                <td>Rp.{{ product['on_price']|number_format }}</td>
                                                                                <td>{{ product['op_quantity'] }}</td>
                                                                                <td>Rp.{{ (product['on_price'] * product['op_quantity']) |number_format }}</td>
                                                                            </tr>
                                                                            {% set ppn_nego_shipping_price = product['on_taxNominalShipping'] %}
                                                                            {% set total_ppn_temp = total_ppn_temp + (product['on_taxNominalPrice'] * product['op_quantity']) %}
                                                                            {% set total_price_nego_temp = total_price_nego_temp + (product['on_price'] * product['op_quantity']) %}
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                    <tr>
                                                                        <td colspan="4" style="text-align: center; background-color: #ecf0f1;"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="3">
                                                                            <b>Negosiasi Harga Pengiriman</b>
                                                                        </td>
                                                                        <td><b>Rp.
                                                                            {{ product_nego['on_negotiatedShippingPrice']|number_format }}</b></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="3">
                                                                            <b>SUB TOTAL</b>
                                                                        </td>
                                                                        <td>
                                                                            <b>Rp.
                                                                                {{ (total_price_nego_temp + product_nego['on_negotiatedShippingPrice'])|number_format }}</b>
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="3">
                                                                            <b>SUB TOTAL PPN</b>
                                                                        </td>
                                                                        <td><b>Rp.
                                                                            {{ (total_ppn_temp + ppn_nego_shipping_price )|number_format }}</b></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="3" style="background-color: #7bed9f;">
                                                                            <b>TOTAL HARGA</b>
                                                                        </td>
                                                                        <td style="background-color: #7bed9f;">
                                                                            <b>Rp.
                                                                                {{ (total_price_nego_temp + product_nego['on_negotiatedShippingPrice'] + total_ppn_temp + ppn_nego_shipping_price)|number_format }}</b>
                                                                        </td>
                                                                    </tr>

                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% set preserved_batch = preserved_batch|merge([product_nego['on_batch']]) %}
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <div id="tab-b2c" class="tab-pane fade">
                                        <div class="m-top-15"></div>
                                        <div class="row">
                                            {% if form_data['o_status'] != 'pending' %}
                                                <div class="col-md-2">
                                                    <center>
                                                        <label>{{ 'label.invoice'|trans }}</label>
                                                        <figure>
                                                            {# href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'invoice'}) }}" #}
                                                            <a>
                                                                <i class="fa fa-print" style="font-size: 120px;"></i>
                                                            </a>
                                                        </figure>
                                                    </center>
                                                    <center>
                                                   <a href="{{ path('admin_order_print', {'id': form_data['o_id'], 'type': 'invoice'}) }}">
                                                       <button class="btn btn-danger"><i class="fa fa-file-pdf-o" aria-hidden="true"></i></button>
                                                   </a>
                                                   <a href="{{ path('admin_order_printword', {'id': form_data['o_id'], 'type': 'invoice'}) }}">
                                                       <button class="btn btn-primary"><i class="fa fa-file-word-o" aria-hidden="true"></i></button>
                                                   </a>
                                                    </center>
                                                </div>

                                            {% endif %}
                                        </div>
                                    </div>
                                {% endif %}
                                <div id="tab-complaint" class="tab-pane fade">
                                        <div class="m-top-15"></div>
                                        {% if form_data['o_complaint']|length > 0 %}
                                            <div class="box-body table-responsive no-padding">
                                                <table class="table">
                                                    <thead>
                                                    <tr>
                                                        <th>{{ 'label.complaint'|trans }}</th>
                                                        <th width="10%">Status</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for complaint in form_data['o_complaint'] %}
                                                        {% if complaint['oc_id'] is not empty %}
                                                            <tr>
                                                                <td>{{ complaint['oc_description'] }}</td>
                                                                <td>
                                                                    {% if complaint['oc_isResolved'] %}
                                                                        {{'label.resolved'|trans}}
                                                                    {% else %}
                                                                        {{'label.not_resolved'|trans}}
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                        {% else %}
                                                            <tr>
                                                                <td colspan="2" class="text-center">Tidak Ada Komplain</td>
                                                            </tr>
                                                        {% endif %}
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        {% endif %}
                                    </div>

                                <div id="tab-rating" class="tab-pane fade">
                                    <div class="m-top-15"></div>
                                    <div class="box-body table-responsive no-padding">
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th width="30%">{{ 'label.products'|trans }}</th>
                                                <th width="55%">{{ 'label.reviews'|trans }}</th>
                                                <th width="15%">{{ 'label.rate'|trans }}</th>
                                                <th></th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for product in form_data['o_products'] %}
                                            {% set data_review = product_review(form_data['o_id']|to_int, product['p_id']|to_int, form_data['o_ppkId']|to_int) %}
                                                <tr>
                                                    <td>{{ product['p_name'] }}</td>
                                                    {% if data_review['pr_id'] is not defined %}
                                                        <td colspan="2">{{ 'label.no_rating'|trans }}</td>
                                                    {% else %}
                                                        <td>{{ data_review['pr_review'] }}</td>
                                                        <td>
                                                            {% for rate in 1..5 %}
                                                                {% set color_star = rate <= data_review['pr_rating'] ? 'color: red;' : 'color: black;' %}
                                                                <i class="fa fa-star" style="{{color_star}}"></i>
                                                            {% endfor %}
                                                        </td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="tab-log" class="tab-pane fade">
                                    <div class="m-top-15"></div>
                                    {% if form_data['order_change_log']|length > 0 %}
                                        <div class="box-body table-responsive no-padding">
                                            <table class="table">
                                                <thead>
                                                <tr>
                                                    <th width="15%">{{ 'label.username'|trans }}</th>
                                                    <th width="15%">{{ 'label.email'|trans }}</th>
                                                    <th width="10%">{{ 'label.role'|trans }}</th>
                                                    <th width="25%">{{ 'label.previous'|trans }}</th>
                                                    <th width="25%">{{ 'label.changes'|trans }}</th>
                                                    <th width="10%">{{ 'label.updated'|trans }}</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for log in form_data['order_change_log'] %}
                                                    <tr>
                                                        <td>{{ log['user']['username']|default }}</td>
                                                        <td>{{ log['user']['email']|default }}</td>
                                                        <td>{{ log['user']['role']|default }}</td>

                                                        {% if log['changes']|length > 0 %}
                                                            {% set previous = '' %}
                                                            {% set new = '' %}
                                                            {% for key, item in log['changes'] %}
                                                                {% set previous = previous ~ key ~ ' => ' ~ log['previousValues'][key] ?? '' ~ '\n'%}
                                                                {% set new = new ~ key ~ ' => ' ~ item ~ '\n' %}
                                                            {% endfor %}
                                                            <td><pre>{{ previous }}</pre></td>
                                                            <td><pre>{{ new }}</pre></td>
                                                        {% else %}
                                                            <td></td>
                                                            <td></td>
                                                        {% endif %}

                                                        <td>{{ log['createdAt']|date('d-m-Y H:i:s') }}</td>
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% endif %}
                                </div>
							</div>
						</div>
					</div>
				</div>
				<div class="box-footer">
					<div id="button-tab-data" class="button-tabs-order" style="display: inline;">
						<button type="button" class="btn btn-primary btn-tab-step" data-current="data" data-step="procurement">
							{{ 'button.next'|trans }}
						</button>
					</div>
                    <div id="button-tab-procurement" class="button-tabs-order hidden" style="display: inline;">
                        <button type="button" class="btn btn-primary btn-tab-step" data-current="procurement" data-step="data">
                            {{ 'button.previous'|trans }}
                        </button>
                        <button type="button" class="btn btn-primary btn-tab-step" data-current="procurement" data-step="products">
                            {{ 'button.next'|trans }}
                        </button>
                    </div>
					<div id="button-tab-products" class="button-tabs-order hidden" style="display: inline;">
						<button type="button" class="btn btn-primary btn-tab-step" data-current="products" data-step="procurement">
							{{ 'button.previous'|trans }}
						</button>
						<button type="button" class="btn btn-primary btn-tab-step" data-current="products" data-step="voucher">
							{{ 'button.next'|trans }}
						</button>
					</div>
					<div id="button-tab-voucher" class="button-tabs-order hidden" style="display: inline;">
						<button type="button" class="btn btn-primary btn-tab-step" data-current="voucher" data-step="products">
							{{ 'button.previous'|trans }}
						</button>
						<button type="button" class="btn btn-primary btn-tab-step" data-current="voucher" data-step="shipped">
							{{ 'button.next'|trans }}
						</button>
					</div>
                    <div id="button-tab-shipped" class="button-tabs-order hidden" style="display: inline;">
                        <button type="button" class="btn btn-primary btn-tab-step" data-current="shipped" data-step="voucher">
                            {{ 'button.previous'|trans }}
                        </button>
                        <button type="button" class="btn btn-primary btn-tab-step" data-current="shipped" data-step="payment">
                            {{ 'button.next'|trans }}
                        </button>
                    </div>
					<div id="button-tab-log" class="button-tabs-order hidden" style="display: inline;">
						<button type="button" class="btn btn-primary btn-tab-step" data-current="voucher" data-step="negotiation">
							{{ 'button.previous'|trans }}
						</button>
					</div>
                    <div id="button-tab-pajak" class="button-tabs-order hidden" style="display: inline;">
                        <button type="button" class="btn btn-primary btn-tab-step" data-current="pajak" data-step="shipped">
                            {{ 'button.previous'|trans }}
                        </button>
                        <button type="button" class="btn btn-primary btn-tab-step" data-current="pajak" data-step="payment">
                            {{ 'button.next'|trans }}
                        </button>
                    </div>
					{% if form_data['o_isB2gTransaction'] == true %}
						{% if form_data['o_isB2gTransaction'] == true %}
                            <div id="button-tab-payment" class="button-tabs-order hidden" style="display: inline;">
                                <button type="button" class="btn btn-primary btn-tab-step" data-current="payment" data-step="pajak">
                                    {{ 'button.previous'|trans }}
                                </button>
                                <button type="button" class="btn btn-primary btn-tab-step" data-current="payment" data-step="tax">
                                    {{ 'button.next'|trans }}
                                </button>
                            </div>
							<div id="button-tab-tax" class="button-tabs-order hidden" style="display: inline;">
								<button type="button" class="btn btn-primary btn-tab-step" data-current="tax" data-step="payment">
									{{ 'button.previous'|trans }}
								</button>
								<button type="button" class="btn btn-primary btn-tab-step" data-current="tax" data-step="b2g">
									{{ 'button.next'|trans }}
								</button>
							</div>
							<div id="button-tab-b2g" class="button-tabs-order hidden" style="display: inline;">
								<button type="button" class="btn btn-primary btn-tab-step" data-current="b2g" data-step="tax">
									{{ 'button.previous'|trans }}
								</button>
								<button type="button" class="btn btn-primary btn-tab-step" data-current="b2g" data-step="negotiation">
									{{ 'button.next'|trans }}
								</button>
							</div>
							<div id="button-tab-negotiation" class="button-tabs-order hidden" style="display: inline;">
								<button type="button" class="btn btn-primary btn-tab-step" data-current="negotiation" data-step="b2g">
									{{ 'button.previous'|trans }}
								</button>
                                <button type="button" class="btn btn-primary btn-tab-step" data-current="negotiation" data-step="log">
                                    {{ 'button.next'|trans }}
                                </button>
								{#<a href="{{ path(edit_route, {'id': form_data['o_id']}) }}" class="btn btn-primary">{{ 'button.edit'|trans }}</a>#}
							</div>
						{% else %}
							<div id="button-tab-payment" class="button-tabs-order hidden" style="display: inline;">
								<button type="button" class="btn btn-primary btn-tab-step" data-current="payment" data-step="voucher">
									{{ 'button.previous'|trans }}
								</button>
								<button type="button" class="btn btn-primary btn-tab-step" data-current="payment" data-step="tax">
									{{ 'button.next'|trans }}
								</button>
							</div>
							<div id="button-tab-tax" class="button-tabs-order hidden" style="display: inline;">
								<button type="button" class="btn btn-primary btn-tab-step" data-current="tax" data-step="payment">
									{{ 'button.previous'|trans }}
								</button>
								<a href="{{ path(edit_route, {'id': form_data['o_id']}) }}" class="btn btn-primary">{{ 'button.edit'|trans }}</a>
							</div>
						{% endif %}
					{% else %}
						<div id="button-tab-payment" class="button-tabs-order hidden" style="display: inline;">
							<button type="button" class="btn btn-primary btn-tab-step" data-current="payment" data-step="voucher">
								{{ 'button.previous'|trans }}
							</button>

                            {% if form_data['o_taxDocumentEmail'] is not empty %}
                                <button type="button" class="btn btn-primary btn-tab-step" data-current="payment" data-step="tax">
                                    {{ 'button.next'|trans }}
                                </button>
                                <button type="button" class="btn btn-primary btn-tab-step" data-current="payment" data-step="log">
                                    {{ 'button.next'|trans }}
                                </button>
                            {% else %}
                                <button type="button" class="btn btn-primary btn-tab-step" data-current="payment" data-step="log">
                                    {{ 'button.next'|trans }}
                                </button>
                            {% endif %}

							{#<a href="{{ path(edit_route, {'id': form_data['o_id']}) }}" class="btn btn-primary">{{ 'button.edit'|trans }}</a>#}
						</div>

                        {% if form_data['o_taxDocumentEmail'] is not empty %}
                             <div id="button-tab-tax" class="button-tabs-order hidden" style="display: inline;">
                                 <button type="button" class="btn btn-primary btn-tab-step" data-current="tax" data-step="payment">
                                     {{ 'button.previous'|trans }}
                                 </button>
                                 {#<a href="{{ path(edit_route, {'id': form_data['o_id']}) }}" class="btn btn-primary">{{ 'button.edit'|trans }}</a>#}
                             </div>
                         {% endif %}
                    {% endif %}
					<div style="display: inline;">
						<a href="{{ path(index_route, {'role': roleParam}) }}" class="btn btn-default">{{ 'button.cancel'|trans }}</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	{% if form_data['o_isB2gTransaction'] == true %}
		<div class="modal fade" id="modal-order-chat" tabindex="-1" role="dialog" aria-labelledby="modal-order-chat-label" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title">{{ 'label.chat_archive'|trans }}</h4>
					</div>
					<div id="modal-order-chat-content" class="modal-body"></div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">{{ 'button.close'|trans }}</button>
					</div>
				</div>
			</div>
		</div>
	{% endif %}
    <script>
        let shippedFiles = {{ form_data['shippedFiles']|json_encode|raw }};
        let ppStamp = {{ form_data['pp_stamp']|json_encode|raw }};
        let ppSignature = {{ form_data['pp_signature']|json_encode|raw }};
        let ppkStamp = {{ form_data['ppk_stamp']|json_encode|raw }};
        let ppkSignature = {{ form_data['ppk_signature']|json_encode|raw }};
        let treasurerStamp = {{ form_data['treasurer_stamp']|json_encode|raw }};
        let treasurerSignature = {{ form_data['treasurer_signature']|json_encode|raw }};
        let sellerStamp = {{ form_data['seller_stamp']|json_encode|raw }};
        let sellerSignature = {{ form_data['seller_signature']|json_encode|raw }};
        
        $(document).ready(function() {
            var ppn = $('#ppn-choose').val() != 'lainnya' && $('#ppn-choose').val() != '' ? $('#ppn-choose').val() : $('#other_ppn_persentase').val();
            var pph = $('#pph-choose').val() != 'lainnya' && $('#pph-choose').val() != '' ? $('#pph-choose').val() : $('#other_pph_persentase').val();
            hitungTotalBayar('ppn', 'pph', ppn, $('#ppn-choose').val());
            hitungTotalBayar('pph', 'ppn', pph, $('#pph-choose').val());
            $('#desc-keterangan-pembayaran').html($('#tax-types option:selected').data('description'))
        });

        // Fungsi untuk mengompresi gambar dan mengonversi ke base64
        async function compressImageToBase64Quality(url, maxWidth, maxHeight,  usePNG = false, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.src = url;

                img.onload = () => {
                    // Tentukan ukuran gambar baru
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > maxWidth) {
                            height = Math.round((height * maxWidth) / width);
                            width = maxWidth;
                        }
                    } else {
                        if (height > maxHeight) {
                            width = Math.round((width * maxHeight) / height);
                            height = maxHeight;
                        }
                    }

                    // Buat canvas untuk menggambar gambar yang dikompresi
                    const canvas = document.createElement('canvas');
                    canvas.style.backgroundColor = 'transparent';
                    canvas.width = width;
                    canvas.height = height;

                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, width, height);

                    // Konversi canvas ke base64
                    let base64String = ""
                    if(usePNG){
                        base64String = canvas.toDataURL('image/png', quality);
                    }else {
                        base64String = canvas.toDataURL('image/jpeg', quality);
                    }
                    resolve(base64String);
                };

                img.onerror = () => resolve(null);
            });
        }

        // Fungsi untuk mengonversi URL gambar menjadi base64
        function convertImageToBase64(url) {
            return fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.onerror = () => reject("Error occurred while reading file");
                        reader.readAsDataURL(blob);
                    });
                });
        }

        $(document).on('click', '.btn-download-document', async function(e){

            let buttonElem = e.currentTarget

            // set loading for targeted button
            setDownloading(buttonElem, true)
            
            // set disabled for all other button
            let otherButtons = document.getElementsByClassName('btn-download-document')
            setButtonDisabled(otherButtons, true)

            const data_type = $(this).data('type')
            // URL gambar
            const imageUrls = shippedFiles


            let context = {}
            context['type'] = data_type

            

            if(data_type == "bast"){
                const base64ProductsImages = await Promise.all(imageUrls.map(url => compressImageToBase64Quality(`${BASE_URL}/sftp/file/uploads/${url}`, 800, 600)));
                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                context['products'] = base64ProductsImages
                context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''
            }else if (data_type == "spk"){
                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                context['pp_stamp'] = ppStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppStamp}`,400, 400, true) : ''
                context['pp_signature'] = ppSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppSignature}`,400, 400, true) : ''
            }else if (data_type == "performa_invoice"){
                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                // performa invoice hanya perlu ttd & cap merchant; skip
            }else if(data_type == "invoice"){
                // invoice tidak perlu data, skip
            }else if (data_type == "receipt_ls"){
                // perlu ppk & bendahara
                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''
                context['treasurer_stamp'] = treasurerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${treasurerStamp}`,400, 400, true) : ''
                context['treasurer_signature'] = treasurerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${treasurerSignature}`,400, 400, true) : ''

            }else if (data_type == "bapd"){
                const base64ProductsImages = await Promise.all(imageUrls.map(url => compressImageToBase64Quality(`${BASE_URL}/sftp/file/uploads/${url}`, 800, 600)));
                context['products'] = base64ProductsImages
                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''

            }
            else if (data_type == "bast_ls"){
                const base64ProductsImages = await Promise.all(imageUrls.map(url => compressImageToBase64Quality(`${BASE_URL}/sftp/file/uploads/${url}`, 800, 600)));
                context['products'] = base64ProductsImages
                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''

            }else if (data_type == "spk_new"){
                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''

            }else if (data_type == "bapd_ls"){
                const base64ProductsImages = await Promise.all(imageUrls.map(url => compressImageToBase64Quality(`${BASE_URL}/sftp/file/uploads/${url}`, 800, 600)));
                context['products'] = base64ProductsImages
                context['seller_stamp'] = sellerStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerStamp}`,400, 400, true) : ''
                context['seller_signature'] = sellerSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${sellerSignature}`,400, 400, true) : ''
                context['ppk_stamp'] = ppkStamp? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkStamp}`,400, 400, true) : ''
                context['ppk_signature'] = ppkSignature? await compressImageToBase64Quality(`${BASE_URL}/sftp/file/${ppkSignature}`,400, 400, true) : ''
            }

            console.log(context)
                            
            $(this).addClass('terdownload');                
            
            downloadWithLoading($(this).val(), $(this).attr('data-filename'), buttonElem, context);       
        })

        function setDownloading(buttonElem, isLoading) {
            let originalIcon = buttonElem.getElementsByClassName('fa-file-pdf-o')[0]
            let spinner = buttonElem.getElementsByClassName('spinner')[0]

            if(isLoading){
                buttonElem.setAttribute('disabled', true)
                originalIcon.classList.add('d-none')
                spinner.classList.remove('d-none')
            }else{
                buttonElem.removeAttribute('disabled')
                originalIcon.classList.remove('d-none')
                spinner.classList.add('d-none')
            }
        }

        function setButtonDisabled(buttons, isDisabled){
            if (isDisabled) {
                for(let button of buttons){
                    button.setAttribute('disabled', true)
                }
            }else{
                for(let button of buttons){
                    button.removeAttribute('disabled')
                }
            }
        }

        function downloadWithLoading(url, filename, buttonElem, context){
            setDownloading(buttonElem, true)
            fetch(url, {
                headers: {
                    'Content-Type': 'application/json'
                }, 
                method: 'POST', 
                body: JSON.stringify(context)
            }).then(function (t) {
                return t.blob().then((b) => {
                    var a = document.createElement("a");
                    a.href = URL.createObjectURL(b);
                    a.setAttribute("download", filename);
                    a.click();
                    setDownloading(buttonElem, false)

                    let otherButtons = document.getElementsByClassName('btn-download-document')
                    setButtonDisabled(otherButtons, false)
                });
            });
        }

        

        $(document).on('change', '.choose_ppn_pph', function(e) {
            var option = e.target.value;
            var primary = $(this).data('index_primary');
            var secondary = $(this).data('index_secondary');
            hitungTotalBayar(primary,secondary,option,0);
        });

        $(document).on('keyup', '.other_ppn_pph_persentase', function(e) {
            var other = $(this).val() != '' ? parseFloat($(this).val()):0;
            var primary = $(this).data('index_primary');
            var secondary = $(this).data('index_secondary');
            hitungTotalBayar(primary,secondary,other,'lainnya');
        });

        $(document).on('change', '#tax-types', function(e) {
            if (e.target.value != "") {
                var option = $('#tax-types option[value="'+e.target.value+'"]');
                $('#label-keterangan-pembayaran').show();
                $('#desc-keterangan-pembayaran').html(option.data('description'))
                if (e.target.value == 59) {
                    $('.pph-pmk-59').show();
                    $('.pph-pmk-58').hide();
                    $('#btn_pajak_cc').show();
                } else {
                    $('.pph-pmk-59').hide();
                    $('.pph-pmk-58').show();
                    $('#btn_pajak_cc').hide();
                }
            } else {
                $('#label-keterangan-pembayaran').hide();
                $('#desc-keterangan-pembayaran').html('')
                $('.pph-pmk-59').hide();
                $('.pph-pmk-58').hide();
            }
        });

        function hitungTotalBayar(primary, secondary, option, other) {
            if (option == 'lainnya' || other == 'lainnya') {
                $('#other_'+primary+'_div').show();
            } else {
                $('#other_'+primary+'_div').hide();
            }
            var persentase = option != "" && option != "lainnya" ? parseFloat(option):0;
            var dpp_pph           = $('#dpp_ppn_pph').val(); 
            var total_order       = $('#total_order').val(); 
            var secondary_nominal = $('#treasurer_'+secondary+'_nominal').val();
            var primary_nominal   = persentase != 0 ? Math.round(dpp_pph * (persentase/100)) : 0;
            var total_pajak       = Math.round(parseFloat(primary_nominal) + parseFloat(secondary_nominal));
            var total_bayar       = parseFloat(total_order);
            if (total_bayar > 2220000) {
                total_bayar  = Math.round(total_bayar - parseFloat(primary_nominal) - parseFloat(secondary_nominal))
            }
            $('#treasurer_'+primary+'_nominal').val(primary_nominal)
            $('#treasurer_nominal_'+primary).val(setToRp(primary_nominal));
            $('#total_pajak').val(setToRp(total_pajak));
            $('#total_bayar').val(setToRp(total_bayar));
            
        }

        function setToRp(number) {
            return number.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,  "$1,");// "$1."
        }
    </script>
{% endblock %}
